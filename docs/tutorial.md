# Workflow101ï¼šAI Agent å·¥ä½œæµç¼–æŽ’å®žæˆ˜

> workflowå¹¶ä¸å¤æ‚ï¼Œå°±æ˜¯agenté—´åä½œç½¢äº†ï¼Œåˆ«è¢«é‚£äº›èŠ±é‡Œèƒ¡å“¨çš„æœ¯è¯­å“åˆ°äº†
> æœ¬æ•™ç¨‹å¸Œæœ›æ‰€æœ‰åŒå­¦éƒ½èƒ½ç†Ÿç»ƒä½¿ç”¨aiï¼Œèƒ½åˆ›å»ºé€‚åˆè‡ªå·±ã€é€‚åˆéƒ¨é—¨çš„agentã€workflow

> PS: ä¸€ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆè·ç¦»â€œäººäººç”¨AIâ€å‘æ–‡è¿‡åŽ»äº†è¿™ä¹ˆä¹…ï¼Œå…¬å¸å†…éƒ¨éƒ½æ²¡æœ‰èƒ½å¤Ÿæ–¹ä¾¿ä½¿ç”¨çš„æ¨¡åž‹ï¼Ÿ

## è¿™æ˜¯ä»€ä¹ˆï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªé¡¹ç›®é©±åŠ¨çš„æ•™ç¨‹ã€‚æˆ‘ä»¬ä¼šä»Žé›¶å¼€å§‹ï¼Œç”¨ Claude Code æž„å»ºä¸€ä¸ªçœŸå®žçš„ **Code Review Automator** â€”â€” ä¸€ä¸ªèƒ½è‡ªåŠ¨åˆ†æž git diffã€å¹¶è¡Œè°ƒåº¦å¤šä¸ªå®¡æŸ¥ agentã€ç”Ÿæˆç»“æž„åŒ–æŠ¥å‘Šçš„ CLI å·¥å…·ã€‚

## æˆ‘ä»¬è¦æž„å»ºä»€ä¹ˆï¼Ÿ

```
$ review-bot review --diff HEAD~1
```

ä¸€è¡Œå‘½ä»¤ï¼ŒèƒŒåŽå‘ç”Ÿçš„äº‹ï¼š

1. è§£æž git diffï¼Œç†è§£"æ”¹äº†ä»€ä¹ˆ"
2. åŒæ—¶æ´¾å‡º 4 ä¸ªä¸“ä¸šå®¡æŸ¥ agentï¼ˆå®‰å…¨ / æ€§èƒ½ / é£Žæ ¼ / é€»è¾‘ï¼‰
3. æ”¶é›†æ‰€æœ‰å®¡æŸ¥ç»“æžœï¼Œç”Ÿæˆä¸€ä»½ç»“æž„åŒ–æŠ¥å‘Š
4. è¿˜èƒ½åœ¨ git commit æ—¶è‡ªåŠ¨è§¦å‘

å¬èµ·æ¥ä¸å¤æ‚ï¼Ÿä½†è¦æŠŠå®ƒåšå¥½ï¼Œä½ ä¼šç”¨åˆ° Claude Code å‡ ä¹Žæ‰€æœ‰çš„ç¼–æŽ’èƒ½åŠ›ã€‚

![pic1](assets/Gemini_Generated_Image_auddihauddihaudd.png)


## é€‚åˆè°ï¼Ÿ

- åˆšæŽ¥è§¦ Claude Codeï¼Œæƒ³å¿«é€Ÿä¸Šæ‰‹çš„å¼€å‘è€…
- å·²ç»åœ¨ç”¨ï¼Œä½†è¿˜åœç•™åœ¨"ä¸€é—®ä¸€ç­”"æ¨¡å¼çš„äºº
- æƒ³çœ‹çœ‹ AI Agent ç¼–æŽ’åœ¨å®žé™…é¡¹ç›®ä¸­æ€Žä¹ˆè½åœ°çš„äºº

## å…ˆçœ‹å…¨æ™¯ï¼šè¿™äº›æ¦‚å¿µä»€ä¹ˆå…³ç³»ï¼Ÿ

æ•™ç¨‹é‡Œä¼šåå¤å‡ºçŽ°è¿™äº›æœ¯è¯­ã€‚åˆ«æ€¥ç€è®°ï¼Œå…ˆå»ºç«‹ä¸€ä¸ªç›´è§‰â€”â€”å®ƒä»¬å„è‡ªæ˜¯ä»€ä¹ˆï¼Œæ€Žä¹ˆé…åˆã€‚

| æ¦‚å¿µ | ä¸€å¥è¯ | ç±»æ¯” |
|------|--------|------|
| Agent | èƒ½è‡ªä¸»å®Œæˆä»»åŠ¡çš„ AI å®žä½“ | å‘˜å·¥ |
| Subagent | è¢«ä¸» Agent æ´¾å‡ºåŽ»å¹²æ´»çš„å­ Agent | å‘˜å·¥æ´¾å‡ºçš„å¤–åŒ… |
| CLAUDE.md | é¡¹ç›®çº§æŒ‡ä»¤ï¼ŒAgent æ¯æ¬¡å¯¹è¯éƒ½ä¼šè¯» | å‘˜å·¥æ‰‹å†Œ |
| Skill | å¯å¤ç”¨çš„ prompt æ¨¡æ¿ï¼Œç”¨ `/name` è§¦å‘ | æ ‡å‡†ä½œä¸šæµç¨‹ï¼ˆSOPï¼‰ |
| Hook | äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨åŒ–ï¼Œå·¥å…·è°ƒç”¨å‰åŽè‡ªåŠ¨æ‰§è¡Œ | é—¨ç¦ç³»ç»Ÿ |
| Workflow | æŠŠä»¥ä¸Šæ‰€æœ‰ä¸œè¥¿ç¼–æŽ’èµ·æ¥ååŒå·¥ä½œ | é¡¹ç›®ç®¡ç†æµç¨‹ |

å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼š

```
ä½ ï¼ˆå¼€å‘è€…ï¼‰
 â”‚
 â”œâ”€ è¾“å…¥ /review-bot HEAD~1
 â”‚     â”‚
 â”‚     â–¼
 â”‚  skills/review-bot/SKILL.mdï¼ˆSkill: å®šä¹‰å®¡æŸ¥æ­¥éª¤ï¼‰
 â”‚     â”‚
 â”‚     â–¼
 â”‚  ä¸» Agent â—„â”€â”€ CLAUDE.mdï¼ˆé¡¹ç›®çº¦å®šï¼‰
 â”‚     â”‚     â—„â”€â”€ skills/SKILL.mdï¼ˆé¢†åŸŸçŸ¥è¯†ï¼Œè‡ªåŠ¨ç”Ÿæ•ˆï¼‰
 â”‚     â”‚
 â”‚     â”œâ”€â”€â†’ Subagent: å®‰å…¨å®¡æŸ¥
 â”‚     â”œâ”€â”€â†’ Subagent: æ€§èƒ½å®¡æŸ¥
 â”‚     â”œâ”€â”€â†’ Subagent: é£Žæ ¼å®¡æŸ¥
 â”‚     â””â”€â”€â†’ Subagent: é€»è¾‘å®¡æŸ¥
 â”‚                â”‚
 â”‚                â–¼
 â”‚           æ±‡æ€» â†’ å®¡æŸ¥æŠ¥å‘Š
 â”‚
 â””â”€ git commit â†’ Hookï¼ˆsettings.jsonï¼‰â†’ è‡ªåŠ¨è§¦å‘å®¡æŸ¥
```

å¯¹åº”åˆ°æ–‡ä»¶ç³»ç»Ÿï¼š

```
review-bot/
â”œâ”€â”€ CLAUDE.md                    # Agent çš„"å‘˜å·¥æ‰‹å†Œ"
â””â”€â”€ .claude/
    â”œâ”€â”€ commands/                # Skill: ä½ è§¦å‘çš„ SOP
    â”‚   â””â”€â”€ review.md           #   /review-bot â†’ å¹¶è¡Œå®¡æŸ¥+ç”ŸæˆæŠ¥å‘Š
    â”œâ”€â”€ skills/                  # é¢†åŸŸçŸ¥è¯†: Claude è‡ªåŠ¨åº”ç”¨
    â”‚   â””â”€â”€ code-standards/
    â”‚       â””â”€â”€ SKILL.md        #   ä»£ç è§„èŒƒã€å®‰å…¨è§„åˆ™
    â”œâ”€â”€ agents/                  # Subagent: ä¸“å®¶è§’è‰²å®šä¹‰
    â”‚   â”œâ”€â”€ security-reviewer.md
    â”‚   â””â”€â”€ ...
    â””â”€â”€ settings.json            # Hook: commit åŽè‡ªåŠ¨è§¦å‘å®¡æŸ¥
```

ä¸€å¥è¯æ€»ç»“ï¼š**Skill å®šä¹‰"åšä»€ä¹ˆ"ï¼ŒAgent è´Ÿè´£"æ€Žä¹ˆåš"ï¼ŒCLAUDE.md è§„å®š"æŒ‰ä»€ä¹ˆè§„çŸ©åš"ï¼ŒHook å†³å®š"ä»€ä¹ˆæ—¶å€™è‡ªåŠ¨åš"ã€‚**

## æ•™ç¨‹ç»“æž„

æ¯ç« ä¸‰æ®µå¼ï¼š**è®¾è®¡æ€ç»´**ï¼ˆä¸ºä»€ä¹ˆè¿™æ ·åšï¼‰â†’ **å®žæ“å¤çŽ°**ï¼ˆè·Ÿç€åšï¼‰â†’ **æç‚¼æ¨¡æ¿**ï¼ˆå¸¦èµ°å¤ç”¨ï¼‰

| ç« èŠ‚ | ä½ åœ¨æž„å»ºä»€ä¹ˆ | å­¦åˆ°çš„ç¼–æŽ’æ¨¡å¼ |
|------|-------------|---------------|
| Ch0: å·¥å…·é€‰åž‹ | äº†è§£ AI Coding Agent å…¨æ™¯ | â€” |
| Ch1: éœ€æ±‚åˆ†æž | ç”¨ AI è§„åˆ’æ•´ä¸ªé¡¹ç›® | Plan Agent |
| Ch2: æ­å»ºè„šæ‰‹æž¶ | CLI æ¡†æž¶ + CLAUDE.md | Sequential Workflow |
| Ch3: è§£æž Git Diff | Git diff è§£æžæ¨¡å— | Explore Agent |
| Ch4: Agent è®¾è®¡ | 4 ä¸ªä¸“ä¸šå®¡æŸ¥ agent | Agent Design |
| Ch5: Fan-out/Fan-in | 4 agent åŒæ—¶å·¥ä½œ | Parallel + Fan-out/Fan-in |
| Ch6: ç»“æžœèšåˆ | ç»“æž„åŒ–å®¡æŸ¥æŠ¥å‘Š | Result Aggregation |
| Ch7: Hooks ä¸Ž Skills | Hook è‡ªåŠ¨è§¦å‘å®¡æŸ¥ | Hooks + Skills |
| Ch8: æµ‹è¯•é©±åŠ¨ | æµ‹è¯•ä¸Ž CI é›†æˆ | Test Workflow |
| Ch9: å…­ç§ç¼–æŽ’æ¨¡å¼ | å¯å¤ç”¨ workflow æ¨¡æ¿ | Pattern Summary |
| é™„å½•: è¯¾åŽä½œä¸š | 4 ä¸ª Workflow å®žæˆ˜ | ç»¼åˆå®žæˆ˜ |

## æŠ€æœ¯æ ˆ

- Python 3.10+
- [typer](https://typer.tiangolo.com/) â€” CLI æ¡†æž¶
- [Claude Code](https://docs.anthropic.com/en/docs/claude-code) â€” AI ç¼–æŽ’å¼•æ“Ž
- Git â€” å˜æ›´åˆ†æžæ•°æ®æº

## å‰ç½®è¦æ±‚

- macOS / Linux / Windows WSL
- Node.js 18+ï¼ˆå®‰è£… Claude Code ç”¨ï¼‰
- Python 3.10+ï¼ˆæž„å»ºé¡¹ç›®ç”¨ï¼‰
- Anthropic API key æˆ– Claude Pro/Max è®¢é˜…
- åŸºæœ¬çš„å‘½ä»¤è¡Œå’Œ Git æ“ä½œèƒ½åŠ›

---

## ç›®å½•

- [å…ˆçœ‹å…¨æ™¯ï¼šè¿™äº›æ¦‚å¿µä»€ä¹ˆå…³ç³»ï¼Ÿ](#_4)
- [Ch0: å·¥å…·é€‰åž‹ â€” Claude Codeã€Cursorã€Copilot æ€Žä¹ˆé€‰](#ch0-claude-codecursorcopilot)
  - [0.1 ä»€ä¹ˆæ˜¯ AI Coding Agentï¼Ÿ](#01-ai-coding-agent)
  - [0.2 ä¸»æµ AI Coding Agent ä¸€è§ˆ](#02-ai-coding-agent)
  - [0.3 AI æ—¶ä»£çš„å¼€å‘æ¨¡å¼](#03-ai)
  - [0.4 æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ](#04)
  - [0.5 Claude Code å¿«é€Ÿå®‰è£…](#05-claude-code)
- [Ch1: éœ€æ±‚åˆ†æž â€” ç”¨ Plan Agent æƒ³æ¸…æ¥šå†åŠ¨æ‰‹](#ch1-plan-agent)
  - [1.2 è®¾è®¡æ€ç»´ï¼šä¸ºä»€ä¹ˆè¦ç”¨ AI åšè§„åˆ’ï¼Ÿ](#12-ai)
  - [1.3 å®žæ“å¤çŽ°ï¼šè§„åˆ’ Code Review Automator](#13-code-review-automator)
  - [1.4 æç‚¼æ¨¡æ¿ï¼šAI è¾…åŠ©è§„åˆ’çš„é€šç”¨æµç¨‹](#14-ai)
  - [1.5 è§„åˆ’çš„å¸¸è§è¯¯åŒº](#15)
- [Ch2: æ­å»ºè„šæ‰‹æž¶ â€” CLAUDE.md + CLI ä¸€æ­¥åˆ°ä½](#ch2-claudemd-cli)
  - [2.2 è®¾è®¡æ€ç»´ï¼šCLAUDE.md çš„ä¸‰å±‚é…ç½®](#22-claudemd)
  - [2.3 å®žæ“å¤çŽ°ï¼šæ­å»º Review Bot è„šæ‰‹æž¶](#23-review-bot)
  - [2.4 è®¾è®¡æ€ç»´ï¼šé¡ºåºå·¥ä½œæµ](#24-sequential-workflow)
  - [2.5 è®¾è®¡æ€ç»´ï¼šä¸Šä¸‹æ–‡ç®¡ç†](#25)
  - [2.6 æç‚¼æ¨¡æ¿ï¼šCLAUDE.md é…ç½®æ¨¡æ¿](#26-claudemd)
- [Ch3: è§£æž Git Diff â€” ç”¨ Explore Agent è¯»æ‡‚å˜æ›´](#ch3-git-diff-explore-agent)
  - [3.2 è®¾è®¡æ€ç»´ï¼šExplore Agent æ˜¯ä»€ä¹ˆï¼Ÿ](#32-explore-agent)
  - [3.3 å®žæ“å¤çŽ°ï¼šå®žçŽ° Git Diff è§£æž](#33-git-diff)
  - [3.4 æç‚¼æ¨¡æ¿ï¼šExplore Agent ä½¿ç”¨æ¨¡å¼](#34-explore-agent)
- [Ch4: Agent è®¾è®¡ â€” å®‰å…¨ã€æ€§èƒ½ã€é£Žæ ¼ã€é€»è¾‘å››ä¸ªä¸“å®¶](#ch4-agent)
  - [4.2 è®¾è®¡æ€ç»´ï¼šAgent = è§’è‰² + èƒ½åŠ› + çº¦æŸ](#42-agent)
  - [4.3 å®žæ“å¤çŽ°ï¼šå®šä¹‰å››ä¸ªå®¡æŸ¥ Agent](#43-agent)
  - [4.4 æ£€æŸ¥æ¸…å•ç²¾åº¦ vs. LLM æ³›åŒ–èƒ½åŠ›](#44-vs-llm)
  - [4.5 æç‚¼æ¨¡æ¿ï¼šAgent Prompt è®¾è®¡æ¨¡æ¿](#45-agent-prompt)
- [Ch5: Fan-out/Fan-in â€” å››ä¸ª Agent åŒæ—¶å¼€å·¥](#ch5-fan-outfan-in-agent)
  - [5.2 è®¾è®¡æ€ç»´ï¼šClaude Code çš„å¹¶è¡Œæ‰§è¡Œæœºåˆ¶](#52-claude-code)
  - [5.3 å®žæ“å¤çŽ°ï¼šå®žçŽ°å¹¶è¡Œå®¡æŸ¥è°ƒåº¦](#53)
  - [5.4 æç‚¼æ¨¡æ¿ï¼šFan-out / Fan-in æ¨¡å¼](#54-fan-out-fan-in)
- [Ch6: ç»“æžœèšåˆ â€” æŠŠæ•£è£…ç»“æžœå˜æˆä¸€ä»½æ­£ç»æŠ¥å‘Š](#ch6)
  - [6.2 è®¾è®¡æ€ç»´ï¼šç»“æžœèšåˆçš„ä¸‰ä¸ªå±‚æ¬¡](#62)
  - [6.3 å®žæ“å¤çŽ°ï¼šå®žçŽ°æŠ¥å‘Šç”Ÿæˆå™¨](#63)
  - [6.4 æç‚¼æ¨¡æ¿ï¼šç»“æžœèšåˆæ¨¡å¼](#64)
- [Ch7: Hooks ä¸Ž Skills â€” commit æ—¶è‡ªåŠ¨è§¦å‘å®¡æŸ¥](#ch7-hooks-skills-commit)
  - [7.2 è®¾è®¡æ€ç»´ï¼šHooks æ˜¯ä»€ä¹ˆï¼Ÿ](#72-hooks)
  - [7.3 å®žæ“å¤çŽ°ï¼šé…ç½®è‡ªåŠ¨å®¡æŸ¥æµæ°´çº¿](#73)
  - [7.4 æç‚¼æ¨¡æ¿ï¼šè‡ªåŠ¨åŒ–æµæ°´çº¿æ¨¡å¼](#74)
- [Ch8: æµ‹è¯•é©±åŠ¨ â€” è°æ¥å®¡æŸ¥å®¡æŸ¥è€…ï¼Ÿ](#ch8)
  - [8.2 è®¾è®¡æ€ç»´ï¼šéªŒè¯ä¼˜å…ˆ](#82)
  - [8.3 è®¾è®¡æ€ç»´ï¼šæµ‹è¯•ç­–ç•¥](#83)
  - [8.4 å®žæ“å¤çŽ°ï¼šä¸º Review Bot æ·»åŠ æµ‹è¯•](#84-review-bot)
  - [8.5 æç‚¼æ¨¡æ¿ï¼šæµ‹è¯•å·¥ä½œæµæ¨¡å¼](#85)
- [Ch9: å…­ç§ç¼–æŽ’æ¨¡å¼ â€” ä»Žä¸€ä¸ªé¡¹ç›®åˆ°ä¸€å¥—æ–¹æ³•è®º](#ch9)
  - [9.2 æ¨¡å¼æ€»ç»“](#92)
  - [9.3 æ¨¡å¼ç»„åˆï¼šReview Bot çš„å®Œæ•´ç¼–æŽ’](#93-review-bot)
- [é™„å½•: è¯¾åŽä½œä¸š â€” Workflow å®žæˆ˜](#workflow)
  - [ä½œä¸š 1ï¼šDevelop Workflow](#1develop-workflow)
  - [ä½œä¸š 2ï¼šTest Workflow](#2test-workflow)
  - [ä½œä¸š 3ï¼šSecurity Audit Workflow](#3security-audit-workflow)
  - [ä½œä¸š 4ï¼šCompliance Test Workflow](#4compliance-test-workflow)

---

# Ch0: å·¥å…·é€‰åž‹ â€” Claude Codeã€Cursorã€Copilot æ€Žä¹ˆé€‰

> åœ¨åŠ¨æ‰‹ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªæ±Ÿæ¹–é‡Œéƒ½æœ‰è°ã€‚

**æœ¯è¯­**

- CLIï¼ˆCommand Line Interfaceï¼Œå‘½ä»¤è¡Œç•Œé¢ï¼‰
- LLMï¼ˆLarge Language Modelï¼Œå¤§è¯­è¨€æ¨¡åž‹ï¼‰
- MCPï¼ˆModel Context Protocolï¼Œæ¨¡åž‹ä¸Šä¸‹æ–‡åè®®ï¼‰
- TUIï¼ˆTerminal User Interfaceï¼Œç»ˆç«¯ç”¨æˆ·ç•Œé¢ï¼‰
- LSPï¼ˆLanguage Server Protocolï¼Œè¯­è¨€æœåŠ¡å™¨åè®®ï¼‰
- APIï¼ˆApplication Programming Interfaceï¼Œåº”ç”¨ç¼–ç¨‹æŽ¥å£ï¼‰
- TDDï¼ˆTest-Driven Developmentï¼Œæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰
- PRDï¼ˆProduct Requirements Documentï¼Œäº§å“éœ€æ±‚æ–‡æ¡£ï¼‰
- SDDï¼ˆSpec-Driven Developmentï¼Œè§„æ ¼é©±åŠ¨å¼€å‘ï¼‰
- CRUDï¼ˆCreate/Read/Update/Deleteï¼Œå¢žåˆ æ”¹æŸ¥ï¼‰

## åœºæ™¯å¼•å…¥

ä½ åˆšå¬è¯´"AI å†™ä»£ç "è¿™ä»¶äº‹ï¼Œæ‰“å¼€æœç´¢å¼•æ“Žä¸€æŸ¥â€”â€”å¥½å®¶ä¼™ï¼ŒClaude Codeã€Codex CLIã€Gemini CLIã€OpenCodeï¼Œè¿˜æœ‰ä¸€å †å« Something-Claw çš„ä¸œè¥¿ã€‚æ¯ä¸ªéƒ½è¯´è‡ªå·±èƒ½å¸®ä½ å†™ä»£ç ï¼Œæ¯ä¸ªçœ‹èµ·æ¥éƒ½å·®ä¸å¤šã€‚

åˆ«æ…Œã€‚è¿™ä¸€ç« å¸®ä½ ç†æ¸…æ¥šï¼šè¿™äº›å·¥å…·æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä¸ºä»€ä¹ˆé€‰ Claude Code æ¥æž„å»ºè¿™ä¸ªæ•™ç¨‹çš„é¡¹ç›®ã€‚

---

## 0.1 ä»€ä¹ˆæ˜¯ AI Coding Agentï¼Ÿ

å…ˆæžæ¸…æ¥šä¸€ä¸ªæ¦‚å¿µï¼šAI Coding Agent â‰  ChatGPT èŠå¤©æ¡†é‡Œå†™ä»£ç ã€‚

**èŠå¤©å¼ AI**ï¼šä½ é—®å®ƒä¸€ä¸ªé—®é¢˜ï¼Œå®ƒç»™ä½ ä¸€æ®µä»£ç ï¼Œä½ å¤åˆ¶ç²˜è´´åˆ°ç¼–è¾‘å™¨é‡Œã€‚ä¸€æ¥ä¸€å›žï¼Œåƒå‘å¾®ä¿¡ã€‚

**AI Coding Agent**ï¼šå®ƒèƒ½ç›´æŽ¥æ“ä½œä½ çš„æ–‡ä»¶ç³»ç»Ÿâ€”â€”è¯»ä»£ç ã€æ”¹ä»£ç ã€è·‘å‘½ä»¤ã€è£…ä¾èµ–ã€‚ä½ ç»™å®ƒä¸€ä¸ªä»»åŠ¡ï¼Œå®ƒè‡ªå·±è§„åˆ’æ­¥éª¤ã€è‡ªå·±æ‰§è¡Œã€é‡åˆ°é—®é¢˜è‡ªå·±è°ƒæ•´ã€‚åƒä¸€ä¸ªååœ¨ä½ æ—è¾¹çš„ç¨‹åºå‘˜ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªèŠå¤©çª—å£ã€‚

å…³é”®åŒºåˆ«åœ¨äºŽ **è‡ªä¸»æ€§**ï¼šAgent èƒ½è‡ªå·±å†³å®šä¸‹ä¸€æ­¥åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯ç­‰ä½ ä¸€æ­¥æ­¥æŒ‡æŒ¥ã€‚

```
èŠå¤©å¼ AI:  ä½ è¯´ â†’ AI å›žå¤ â†’ ä½ å¤åˆ¶ â†’ ä½ ç²˜è´´ â†’ ä½ è¿è¡Œ â†’ å‡ºé”™ â†’ ä½ å†é—®
AI Agent:   ä½ è¯´ â†’ Agent è¯»ä»£ç  â†’ Agent æ”¹ä»£ç  â†’ Agent è·‘æµ‹è¯• â†’ Agent ä¿® bug â†’ æžå®š
```

---

## 0.2 ä¸»æµ AI Coding Agent ä¸€è§ˆ

> æ•°æ®æˆªè‡³ 2026 å¹´ 2 æœˆã€‚ç‰ˆæœ¬å·å’ŒåŠŸèƒ½çŠ¶æ€ä¼šéšæ—¶é—´å˜åŒ–ï¼Œä»¥å„å·¥å…·å®˜æ–¹æ–‡æ¡£ä¸ºå‡†ã€‚

### 0.2.1 æ€»è§ˆ

| å·¥å…· | å‡ºå“æ–¹ | å½¢æ€ | åº•å±‚æ¨¡åž‹ | æ ¸å¿ƒå–ç‚¹ |
|------|--------|------|----------|----------|
| **Claude Code** | Anthropic | CLI (v2.1.x) | Claude Opus 4.6 | Agent ç¼–æŽ’æœ€å®Œæ•´ï¼ˆsubagent å¹¶è¡Œã€Hooksã€Skillsï¼‰ |
| **Codex CLI** | OpenAI | CLI (v0.101.x) + æ¡Œé¢ç«¯ + IDE | GPT-5.3-Codex | æ²™ç®±éš”ç¦»ï¼ˆDocker + approval modesï¼‰ |
| **Gemini CLI** | Google | CLI (v0.27+) | Gemini 3 Flash / Pro | è¶…é•¿ä¸Šä¸‹æ–‡ï¼ˆPro 2M / Flash 1M tokenï¼‰ |
| **OpenCode** | SST (å¼€æº) | CLI (v1.2.x) + æ¡Œé¢ç«¯ + IDE | 75+ åŽç«¯å¯é€‰ | æ¨¡åž‹æ— å…³ + LSP æ·±åº¦é›†æˆ |
| **Aider** | ç¤¾åŒº (å¼€æº) | CLI (v0.86.x) | å¤šæ¨¡åž‹å¯é€‰ | æ·±åº¦ Git é›†æˆ + Repo Map |

### 0.2.2 ç¼–æŽ’èƒ½åŠ›å¯¹æ¯”

è¿™å¼ è¡¨æ˜¯é€‰åž‹çš„å…³é”®â€”â€”æœ¬æ•™ç¨‹æ•™çš„å°±æ˜¯è¿™äº›èƒ½åŠ›ï¼š

| èƒ½åŠ› | Claude Code | Codex CLI | Gemini CLI | OpenCode | Aider |
|------|:-----------:|:---------:|:----------:|:--------:|:-----:|
| Subagent å¹¶è¡Œ | âœ… åŽŸç”Ÿ | âœ… Codex App | âš ï¸ å®žéªŒæ€§ | âœ… åŽŸç”Ÿ | âŒ |
| Hooks è‡ªåŠ¨åŒ– | âœ… | âŒ | âœ… | âœ… | âŒ |
| Skills è‡ªå®šä¹‰å‘½ä»¤ | âœ… | âœ… | âœ… | âœ… | âŒ |
| MCP åè®® | âœ… 3000+ æœåŠ¡ | âœ… | âœ… | âœ… | âš ï¸ AiderDesk |
| æ²™ç®±éš”ç¦» | âŒ | âœ… | âœ… | âŒ | âŒ |
| é¡¹ç›®é…ç½®æ–‡ä»¶ | CLAUDE.md | AGENTS.md | GEMINI.md | AGENTS.md | .aider.conf.yml |

### 0.2.3 å„å·¥å…·é€Ÿå†™

**å•†ä¸šäº§å“**

- **Claude Code** â€” é€šè¿‡ Task tool æ´¾å‡º `Explore`ï¼ˆåªè¯»ï¼‰/ `Plan`ï¼ˆæ–¹æ¡ˆï¼‰/ `general-purpose`ï¼ˆé€šç”¨ï¼‰ä¸‰ç±» subagentï¼Œæ”¯æŒåŒä¸€æ¶ˆæ¯å†…å¤š agent å¹¶è¡Œã€‚MCP å·²æŽ¥å…¥ 3000+ å¤–éƒ¨æœåŠ¡ã€‚CLAUDE.md æ”¯æŒå…¨å±€ â†’ é¡¹ç›® â†’ ç›®å½•ä¸‰å±‚è¦†ç›–ã€‚Opus 4.6 æ”¯æŒ 1M token ä¸Šä¸‹æ–‡ï¼ˆbetaï¼‰ã€‚**æœ¬æ•™ç¨‹çš„ä¸»è§’ã€‚**
- **Codex CLI** â€” GPT-5.3-Codex æ¯”å‰ä»£å¿« 25%ã€‚ä¸‰æ¡£è‡ªåŠ¨åŒ–ï¼šsuggest / auto-edit / full-autoã€‚Codex Appï¼ˆ2026 å¹´ 2 æœˆå‘å¸ƒï¼‰æ”¯æŒå¤š agent å¹¶è¡Œã€Git worktree éš”ç¦»ã€‚MCP æ—¢èƒ½å½“ client ä¹Ÿèƒ½å½“ serverã€‚
- **Gemini CLI** â€” Gemini 3 Pro çš„ 2M token ä¸Šä¸‹æ–‡çª—å£æ˜¯ç›®å‰æœ€å¤§çš„ã€‚è‡ªå®šä¹‰å‘½ä»¤ï¼ˆ`.toml`ï¼‰å’Œ Hooks å·²ç¨³å®šï¼›subagent ä»ä¸ºå®žéªŒæ€§åŠŸèƒ½ï¼ˆéœ€æ‰‹åŠ¨å¼€å¯ `experimental.enableAgents`ï¼Œå¹¶è¡Œæ‰§è¡Œå°šæœªå®žçŽ°ï¼‰ã€‚å…è´¹é¢åº¦å……è£•ï¼ˆæ¯å¤©æœ€å¤š 1000 æ¬¡è¯·æ±‚ï¼‰ã€‚

**å¼€æºé¡¹ç›®**

- **OpenCode** â€” SST å›¢é˜Ÿç»´æŠ¤ï¼ˆä»“åº“ sst/opencodeï¼Œæ—©æœŸ opencode-ai/opencode å·²å½’æ¡£ï¼‰ã€‚Go ç¼–å†™ï¼ŒBubble Tea TUI ç•Œé¢ã€‚æ·±åº¦é›†æˆ LSPï¼Œèƒ½åƒç¼–è¯‘å™¨ä¸€æ ·ç†è§£ä»£ç ç»“æž„ã€‚å†…ç½® General + Explore ä¸¤ç±» subagentï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡Œï¼›ä¹Ÿæ”¯æŒé€šè¿‡ `.opencode/agents/*.md` è‡ªå®šä¹‰ agentã€‚Skillsï¼ˆ`SKILL.md`ï¼‰å’Œ Hooksï¼ˆæ’ä»¶ä½“ç³»ï¼‰å‡å·²ç¨³å®šã€‚é¡¹ç›®æŒ‡ä»¤æ–‡ä»¶ä¸º `AGENTS.md`ã€‚é™¤ CLI å¤–å·²æŽ¨å‡ºæ¡Œé¢ç«¯å’Œ IDE æ‰©å±•ï¼ˆVS Codeã€Cursorï¼‰ã€‚
- **Aider** â€” è€ç‰Œ AI pair programming å·¥å…·ã€‚æ¯æ¬¡ä¿®æ”¹è‡ªåŠ¨ commitï¼Œ`/undo` ä¸€é”®å›žæ»šã€‚ç‹¬åˆ› Repo Mapï¼ˆåŸºäºŽ tree-sitterï¼‰è®© LLM çœ‹åˆ°æ•´ä¸ªä»“åº“çš„å‡½æ•°ç­¾åã€‚ä¸æ”¯æŒåŽŸç”Ÿ subagent å’Œ hooksã€‚

**ä¸ªäºº AI Agent**ï¼ˆä¸åªæ˜¯ç¼–ç¨‹å·¥å…·ï¼‰

- **OpenClaw** â€” 180K+ GitHub Starsï¼Œèƒ½è‡ªä¸»æ‰§è¡Œæ—¥å¸¸ä»»åŠ¡ï¼ˆé‚®ç®±ã€æ¶ˆæ¯ã€é¢„è®¢ï¼‰ï¼Œæ”¯æŒ WhatsApp / Telegramã€‚åŸºäºŽ Claude æ¨¡åž‹ã€‚âš ï¸ æ›¾æ›å‡ºä¸¥é‡ CVEï¼Œåˆ›å§‹äººå·²åŠ å…¥ OpenAIã€‚
- **NanoClaw** â€” OpenClaw è½»é‡æ›¿ä»£ï¼ˆ12K+ Starsï¼‰ï¼Œå®¹å™¨çº§éš”ç¦»ï¼ˆApple Containers / Dockerï¼‰ï¼ŒåŸºäºŽ Claude Agent SDKã€‚
- **NanoBot** â€” MCP Agent æ¡†æž¶ï¼ŒYAML/JSON å®šä¹‰ agentï¼Œé€šè¿‡ MCP åè®®æš´éœ²ä¸º Serverã€‚

### 0.2.4 ä¸ºä»€ä¹ˆé€‰ Claude Codeï¼Ÿ

ä¸æ˜¯å› ä¸ºå®ƒ"æœ€å¥½"â€”â€”æ¯ä¸ªå·¥å…·éƒ½æœ‰è‡ªå·±çš„ç”œåŒºã€‚é€‰å®ƒæ˜¯å› ä¸ºå®ƒçš„ **agent ç¼–æŽ’èƒ½åŠ›æœ€å®Œæ•´**ï¼šåŽŸç”Ÿæ”¯æŒ subagentã€å¹¶è¡Œæ‰§è¡Œã€hooksã€skillsã€MCPã€‚è¿™äº›æ­£æ˜¯è¿™ä¸ªæ•™ç¨‹è¦æ•™çš„ä¸œè¥¿ã€‚ç”¨å…¶ä»–å·¥å…·ï¼Œä½ å¾—è‡ªå·±æ­å¾ˆå¤šåŸºç¡€è®¾æ–½ï¼›ç”¨ Claude Codeï¼Œè¿™äº›éƒ½æ˜¯å¼€ç®±å³ç”¨çš„ã€‚

### 0.2.5 æƒ³ç”¨ OpenCode æ›¿ä»£ï¼Ÿ

å¦‚æžœä½ æ›´å€¾å‘å¼€æºæ–¹æ¡ˆï¼ŒOpenCode æ˜¯æœ€æŽ¥è¿‘çš„æ›¿ä»£å“ã€‚å®ƒæ”¯æŒ MCPã€Hooksã€å¤šæ¨¡åž‹åŽç«¯ï¼Œè€Œä¸”å…è´¹ã€‚ä½†æ¦‚å¿µä½“ç³»å’Œ Claude Code ä¸å®Œå…¨å¯¹é½ï¼Œè¿ç§»æ—¶éœ€è¦æ³¨æ„æ˜ å°„å…³ç³»ï¼š

| Claude Code æ¦‚å¿µ | OpenCode å¯¹åº” | å·®å¼‚è¯´æ˜Ž |
|------------------|--------------|---------|
| CLAUDE.md | AGENTS.md | åŠŸèƒ½ç±»ä¼¼ï¼Œéƒ½æ˜¯é¡¹ç›®çº§æŒ‡ä»¤æ–‡ä»¶ |
| Skillsï¼ˆ`.claude/skills/*/SKILL.md`ï¼‰ | Skillsï¼ˆ`.opencode/skills/*/SKILL.md`ï¼‰ | ä¸¤è€…æ ¼å¼å·²è¶‹åŒï¼šéƒ½ç”¨ç›®å½• + SKILL.md + YAML frontmatter |
| Agentsï¼ˆ`.claude/agents/*.md`ï¼‰ | Agentsï¼ˆ`.opencode/agents/*.md`ï¼‰ | ä¸¤è€…éƒ½æ”¯æŒ Markdown å®šä¹‰è‡ªå®šä¹‰ agentï¼Œæ ¼å¼ç•¥æœ‰ä¸åŒï¼ˆYAML frontmatterï¼‰ |
| Hooksï¼ˆ`.claude/settings.json`ï¼‰ | Pluginsï¼ˆ`opencode.json`ï¼‰ | OpenCode ç”¨ JS/TS æ’ä»¶ä½“ç³»å®žçŽ° hooksï¼Œæ¯” JSON é…ç½®æ›´çµæ´» |
| Task toolï¼ˆSubagent å¹¶è¡Œï¼‰ | åŽŸç”Ÿ subagent | å†…ç½® General subagent æ”¯æŒå¹¶è¡Œæ‰§è¡Œ |
| MCP | MCP | ä¸¤è€…éƒ½å®Œæ•´æ”¯æŒï¼Œé…ç½®æ–¹å¼ä¸åŒ |
| Plan Modeï¼ˆShift+Tabï¼‰ | æ— ç›´æŽ¥å¯¹åº” | å¯é€šè¿‡ prompt æŒ‡ä»¤æ¨¡æ‹Ÿï¼ˆ"åªåˆ†æžä¸ä¿®æ”¹"ï¼‰ |

å®žé™…è¿ç§»ç­–ç•¥ï¼š

- **Python å·¥å…·å±‚**ï¼ˆdiff è§£æžã€æŠ¥å‘Šç”Ÿæˆï¼‰ï¼šé›¶ä¿®æ”¹ï¼Œè·Ÿ AI å·¥å…·æ— å…³
- **ç¼–æŽ’å±‚**ï¼ˆSkill æ–‡ä»¶ï¼‰ï¼šæ”¹å†™ä¸º prompt æ¨¡æ¿æˆ– shell è„šæœ¬ï¼Œæ‰‹åŠ¨è°ƒåº¦ agent
- **Agent å±‚**ï¼ˆè§’è‰²å®šä¹‰ï¼‰ï¼šå°† `.md` ä¸­çš„ prompt ç›´æŽ¥ç²˜è´´åˆ° OpenCode å¯¹è¯ä¸­ä½¿ç”¨

> ðŸ’¡ **Tip**: æœ¬æ•™ç¨‹çš„ Python ä»£ç å’Œæž¶æž„æ€æƒ³æ˜¯é€šç”¨çš„ï¼Œä¸ç»‘å®šä»»ä½•ç‰¹å®šå·¥å…·ã€‚å³ä½¿ä½ ç”¨ Aiderã€Gemini CLI ç”šè‡³çº¯ API è°ƒç”¨ï¼Œæ ¸å¿ƒçš„ fan-out/fan-in æ¨¡å¼å’Œ agent è®¾è®¡åŽŸåˆ™éƒ½é€‚ç”¨ã€‚å·¥å…·åªæ˜¯è½½ä½“ï¼Œç¼–æŽ’æ€ç»´æ‰æ˜¯é‡ç‚¹ã€‚

---

## 0.3 AI æ—¶ä»£çš„å¼€å‘æ¨¡å¼

å·¥å…·é€‰å¥½äº†ï¼Œä½†æ€Žä¹ˆç”¨ï¼ŸAI Coding Agent çš„å‡ºçŽ°å‚¬ç”Ÿäº†ä¸€æ‰¹æ–°çš„å¼€å‘æ¨¡å¼ã€‚æœ‰äº›æ˜¯å…¨æ–°çš„ï¼Œæœ‰äº›æ˜¯ç»å…¸æ–¹æ³•è®ºçš„ AI å¢žå¼ºç‰ˆã€‚

### 0.3.1 Vibe Codingï¼ˆæ°›å›´ç¼–ç¨‹ï¼‰

2025 å¹´ 2 æœˆï¼ŒAndrej Karpathyï¼ˆOpenAI è”åˆåˆ›å§‹äººã€å‰ Tesla AI è´Ÿè´£äººï¼‰å‘äº†ä¸€æ¡æŽ¨æ–‡ï¼Œåˆ›é€ äº†è¿™ä¸ªè¯ï¼š

> "fully give in to the vibes, embrace exponentials, and forget that the code even exists"

ç®€å•è¯´å°±æ˜¯ï¼šç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦ä»€ä¹ˆï¼ŒAI ç”Ÿæˆä»£ç ï¼Œä½ ä¸ç”¨çœ‹æ‡‚æ¯ä¸€è¡Œï¼Œåªè¦ç»“æžœèƒ½è·‘å°±è¡Œã€‚ä¸æ–­è¿­ä»£ï¼Œç›´åˆ°æ»¡æ„ã€‚

```
ä½ : "å¸®æˆ‘åšä¸€ä¸ªå¾…åŠžäº‹é¡¹ App"
AI: [ç”Ÿæˆ 200 è¡Œä»£ç ]
ä½ : "åŠ ä¸ªæ·±è‰²æ¨¡å¼"
AI: [ä¿®æ”¹ä»£ç ]
ä½ : "ä¸é”™ï¼Œéƒ¨ç½²å§"
```

**ä¼˜ç‚¹**: ä¸Šæ‰‹æžå¿«ï¼Œé€‚åˆåŽŸåž‹éªŒè¯å’Œä¸ªäººé¡¹ç›®ã€‚
**é£Žé™©**: ä»£ç è´¨é‡ä¸å¯æŽ§ï¼Œå®‰å…¨éšæ‚£å¤šï¼Œä¸é€‚åˆç”Ÿäº§çŽ¯å¢ƒã€‚ä½ å¯èƒ½è¿žè‡ªå·±çš„ä»£ç åšäº†ä»€ä¹ˆéƒ½ä¸çŸ¥é“ã€‚

**é€‚ç”¨åœºæ™¯**: å¿«é€ŸåŽŸåž‹ã€hackathonã€ä¸ªäººå°å·¥å…·ã€‚

### 0.3.2 TDD with AIï¼ˆAI è¾…åŠ©æµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰

ç»å…¸ TDD çš„æµç¨‹æ˜¯ Red â†’ Green â†’ Refactorï¼šå…ˆå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ï¼Œå†å†™æœ€å°‘çš„ä»£ç è®©å®ƒé€šè¿‡ï¼Œæœ€åŽé‡æž„ã€‚

AI Agent è®©è¿™ä¸ªå¾ªçŽ¯å˜å¾—æ›´é«˜æ•ˆï¼š

```
1. ä½ å†™æµ‹è¯•ï¼ˆæˆ–è®© AI å¸®ä½ å†™ï¼‰
2. AI Agent å†™ä»£ç è®©æµ‹è¯•é€šè¿‡
3. æµ‹è¯•å¤±è´¥ â†’ Agent è‡ªåŠ¨åˆ†æžé”™è¯¯ â†’ ä¿®å¤ â†’ é‡è·‘
4. å…¨éƒ¨é€šè¿‡ â†’ é‡æž„
```

åœ¨ Claude Code ä¸­ï¼Œä½ å¯ä»¥ç”¨ Hook å®žçŽ°è‡ªåŠ¨åŒ– TDD å¾ªçŽ¯â€”â€”æ¯æ¬¡ä»£ç ä¿®æ”¹åŽè‡ªåŠ¨è·‘æµ‹è¯•ï¼Œå¤±è´¥äº† agent è‡ªåŠ¨ä¿®å¤ã€‚è¿™å°±æ˜¯ Ch8 ä¼šè¯¦ç»†è®²çš„å†…å®¹ã€‚

**æ ¸å¿ƒä»·å€¼**: æµ‹è¯•æ˜¯"å®‰å…¨ç½‘"ã€‚æœ‰äº†æµ‹è¯•ï¼Œä½ å¯ä»¥æ”¾å¿ƒè®© AI å¤§åˆ€é˜”æ–§åœ°æ”¹ä»£ç ï¼Œå› ä¸ºæµ‹è¯•ä¼šå‘Šè¯‰ä½ æœ‰æ²¡æœ‰æ”¹åä¸œè¥¿ã€‚

**é€‚ç”¨åœºæ™¯**: ä»»ä½•éœ€è¦ä»£ç è´¨é‡ä¿éšœçš„é¡¹ç›®ï¼Œå°¤å…¶æ˜¯å¤šäººåä½œå’Œé•¿æœŸç»´æŠ¤çš„é¡¹ç›®ã€‚

### 0.3.3 Spec-Driven Developmentï¼ˆè§„æ ¼é©±åŠ¨å¼€å‘ï¼‰

Vibe Coding çš„åé¢ã€‚æ ¸å¿ƒæ€æƒ³ï¼š**å…ˆå†™è¯¦ç»†çš„è§„æ ¼è¯´æ˜Žï¼ˆSpecï¼‰ï¼Œå†è®© AI æŒ‰è§„æ ¼å®žçŽ°**ã€‚

```
1. äººç±»å†™ Specï¼ˆéœ€æ±‚æ–‡æ¡£ã€æŽ¥å£å®šä¹‰ã€éªŒæ”¶æ ‡å‡†ï¼‰
2. AI è¯»å– Specï¼Œç†è§£æ„å›¾
3. AI æŒ‰ Spec é€æ­¥å®žçŽ°
4. ç”¨ Spec ä¸­çš„éªŒæ”¶æ ‡å‡†éªŒè¯ç»“æžœ
```

Spec å¯ä»¥æ˜¯ Markdown æ–‡æ¡£ã€JSON Schemaã€ç”šè‡³æ˜¯ CLAUDE.md ä¸­çš„è§„åˆ™ã€‚å…³é”®æ˜¯ï¼š**Spec æ˜¯ single source of truth**ï¼ŒAI çš„æ‰€æœ‰è¡Œä¸ºéƒ½ä»¥ Spec ä¸ºå‡†ã€‚

**ä¼˜ç‚¹**: ç»“æžœå¯é¢„æµ‹ï¼Œè´¨é‡å¯æŽ§ï¼Œé€‚åˆå›¢é˜Ÿåä½œã€‚
**ä»£ä»·**: å‰æœŸéœ€è¦èŠ±æ—¶é—´å†™ Specï¼Œä½†è¿™ä¸ªæ—¶é—´ä¼šåœ¨åŽé¢çœå›žæ¥ã€‚

**é€‚ç”¨åœºæ™¯**: å›¢é˜Ÿé¡¹ç›®ã€ç”Ÿäº§çŽ¯å¢ƒã€éœ€è¦å¯å®¡è®¡æ€§çš„åœºæ™¯ã€‚

### 0.3.4 Ralph Loopï¼ˆè‡ªä¸»å¾ªçŽ¯å¼€å‘ï¼‰

Ralphï¼ˆå¾—åäºŽã€Šè¾›æ™®æ£®ä¸€å®¶ã€‹çš„ Ralph Wiggumï¼‰æ˜¯ä¸€ç§è®© AI Agent **è‡ªä¸»å¾ªçŽ¯è¿è¡Œç›´åˆ°ä»»åŠ¡å®Œæˆ**çš„æ¨¡å¼ã€‚

å·¥ä½œåŽŸç†ï¼š

```
1. äººç±»å†™ PRDï¼ˆäº§å“éœ€æ±‚æ–‡æ¡£ï¼‰ï¼Œæ‹†æˆ checklist
2. Agent å¯åŠ¨ï¼Œè¯»å– PRD
3. Agent é€‰ä¸€ä¸ªæœªå®Œæˆçš„ä»»åŠ¡ â†’ å®žçŽ° â†’ æµ‹è¯• â†’ æäº¤
4. Agent åœæ­¢ï¼ˆä¸Šä¸‹æ–‡ç”¨å®Œæˆ–ä¸»åŠ¨é€€å‡ºï¼‰
5. è‡ªåŠ¨é‡å¯ï¼Œå¸¦ç€å…¨æ–°ä¸Šä¸‹æ–‡ç»§ç»­ä¸‹ä¸€ä¸ªä»»åŠ¡
6. é‡å¤ 3-5ï¼Œç›´åˆ° checklist å…¨éƒ¨å®Œæˆ
```

å…³é”®è®¾è®¡ï¼š**æ–‡ä»¶ç³»ç»Ÿå°±æ˜¯è®°å¿†**ã€‚æ¯æ¬¡é‡å¯æ—¶ agent çš„ä¸Šä¸‹æ–‡æ˜¯å…¨æ–°çš„ï¼Œä½†ä»£ç åº“ã€PRD æ–‡ä»¶ã€è¿›åº¦è®°å½•éƒ½åœ¨ç£ç›˜ä¸Šã€‚Agent é€šè¿‡è¯»å–è¿™äº›æ–‡ä»¶æ¥æ¢å¤çŠ¶æ€ã€‚

```
while not all_tasks_done:
    agent = start_fresh_agent()
    agent.read("prd.json")        # è¯»å–éœ€æ±‚
    agent.read("progress.md")     # è¯»å–è¿›åº¦
    task = agent.pick_next_task() # é€‰æ‹©ä¸‹ä¸€ä¸ªä»»åŠ¡
    agent.implement(task)         # å®žçŽ°
    agent.test(task)              # æµ‹è¯•
    agent.commit(task)            # æäº¤
    agent.update("progress.md")  # æ›´æ–°è¿›åº¦
```

**ä¼˜ç‚¹**: èƒ½å¤„ç†å¤§åž‹é¡¹ç›®ï¼Œä¸å—ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ï¼Œå¯ä»¥"è¿‡å¤œè¿è¡Œ"ã€‚
**é£Žé™©**: éœ€è¦æ¸…æ™°çš„ PRD å’ŒéªŒæ”¶æ ‡å‡†ï¼Œå¦åˆ™ agent ä¼šåœ¨é”™è¯¯æ–¹å‘ä¸Šè¶Šè·‘è¶Šè¿œã€‚

**é€‚ç”¨åœºæ™¯**: åŠŸèƒ½æ˜Žç¡®çš„ä¸­å¤§åž‹é¡¹ç›®ã€æ‰¹é‡ CRUD å¼€å‘ã€å¤œé—´è‡ªåŠ¨åŒ–æž„å»ºã€‚

### 0.3.5 Plan-then-Codeï¼ˆå…ˆè§„åˆ’åŽç¼–ç ï¼‰

Claude Code çš„ Plan Mode å°±æ˜¯è¿™ç§æ¨¡å¼çš„å…¸åž‹å®žçŽ°ï¼š

```
1. è¿›å…¥ Plan Modeï¼ˆåªè¯»ï¼Œä¸èƒ½æ”¹ä»£ç ï¼‰
2. Agent æŽ¢ç´¢ä»£ç åº“ï¼Œç†è§£çŽ°çŠ¶
3. Agent åˆ¶å®šå®žæ–½æ–¹æ¡ˆ
4. äººç±»å®¡æ ¸æ–¹æ¡ˆï¼Œæå‡ºä¿®æ”¹
5. æ–¹æ¡ˆç¡®è®¤åŽï¼Œé€€å‡º Plan Mode
6. Agent æŒ‰æ–¹æ¡ˆæ‰§è¡Œ
```

å’Œ Spec-Driven çš„åŒºåˆ«ï¼šSpec-Driven æ˜¯äººå†™è§„æ ¼ã€AI æ‰§è¡Œï¼ŒPlan-then-Code æ˜¯ **AI å†™æ–¹æ¡ˆã€äººå®¡æ ¸**ã€‚æ›´é€‚åˆä½ å¯¹ä»£ç åº“ä¸å¤Ÿç†Ÿæ‚‰ã€éœ€è¦ AI å¸®ä½ åˆ†æžçš„åœºæ™¯ã€‚

**é€‚ç”¨åœºæ™¯**: æŽ¥æ‰‹æ–°é¡¹ç›®ã€å¤æ‚é‡æž„ã€ä¸ç¡®å®šæœ€ä½³æ–¹æ¡ˆæ—¶ã€‚

### 0.3.6 æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | è°ä¸»å¯¼ | å‰æœŸæŠ•å…¥ | è´¨é‡å¯æŽ§æ€§ | é€‚åˆåœºæ™¯ |
|------|--------|---------|-----------|---------|
| Vibe Coding | AI | æžä½Ž | ä½Ž | åŽŸåž‹ã€ä¸ªäººé¡¹ç›® |
| TDD with AI | äºº+AI | ä¸­ | é«˜ | éœ€è¦è´¨é‡ä¿éšœçš„é¡¹ç›® |
| Spec-Driven | äºº | é«˜ | é«˜ | å›¢é˜Ÿã€ç”Ÿäº§çŽ¯å¢ƒ |
| Ralph Loop | AI | é«˜ï¼ˆå†™ PRDï¼‰ | ä¸­ | æ‰¹é‡å¼€å‘ã€å¤œé—´æž„å»º |
| Plan-then-Code | AI+äºº | ä½Ž | ä¸­ | æŽ¢ç´¢æ€§ä»»åŠ¡ã€é‡æž„ |

> ðŸ’¡ **è¿™äº›æ¨¡å¼ä¸æ˜¯äº’æ–¥çš„ã€‚** å®žé™…é¡¹ç›®ä¸­ä½ å¾€å¾€ä¼šæ··åˆä½¿ç”¨ï¼šå…ˆç”¨ Plan-then-Code ç†è§£çŽ°çŠ¶ï¼Œå†ç”¨ Spec-Driven å®šä¹‰éœ€æ±‚ï¼Œå¼€å‘æ—¶ç”¨ TDD ä¿éšœè´¨é‡ï¼Œç®€å•çš„éƒ¨åˆ†ç›´æŽ¥ Vibe Codingã€‚Review Bot æ•™ç¨‹å°±æ˜¯è¿™ç§æ··åˆæ¨¡å¼çš„å®žè·µã€‚

---

## 0.4 æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ

åœ¨æ­£å¼å¼€å§‹æž„å»ºé¡¹ç›®ä¹‹å‰ï¼Œæœ‰å‡ ä¸ªæ¦‚å¿µéœ€è¦å…ˆå¯¹é½ã€‚ä¸ç”¨æ­»è®°ï¼ŒåŽé¢æ¯ç« ç”¨åˆ°æ—¶ä¼šåå¤å¼ºåŒ–ã€‚

### 0.4.1 Agent

ä¸€ä¸ªèƒ½è‡ªä¸»å®Œæˆä»»åŠ¡çš„ AI å®žä½“ã€‚ä¸‰è¦ç´ ï¼š

- **è§’è‰²**ï¼ˆRoleï¼‰ï¼šå®ƒæ˜¯è°ï¼Ÿå®‰å…¨å®¡æŸ¥ä¸“å®¶ï¼Ÿæ€§èƒ½ä¼˜åŒ–å¸ˆï¼Ÿ
- **èƒ½åŠ›**ï¼ˆCapabilityï¼‰ï¼šå®ƒèƒ½ç”¨ä»€ä¹ˆå·¥å…·ï¼Ÿèƒ½è¯»æ–‡ä»¶ï¼Ÿèƒ½è·‘å‘½ä»¤ï¼Ÿ
- **çº¦æŸ**ï¼ˆConstraintï¼‰ï¼šå®ƒä¸èƒ½åšä»€ä¹ˆï¼Ÿä¸èƒ½åˆ æ–‡ä»¶ï¼Ÿåªèƒ½çœ‹ä¸èƒ½æ”¹ï¼Ÿ

æ‰“ä¸ªæ¯”æ–¹ï¼šAgent å°±åƒå…¬å¸é‡Œçš„å‘˜å·¥ã€‚ä½ ä¸ä¼šè®©å‰å°åŽ»å†™ä»£ç ï¼Œä¹Ÿä¸ä¼šè®©ç¨‹åºå‘˜åŽ»è°ˆå®¢æˆ·ã€‚æ¯ä¸ªäººæœ‰è‡ªå·±çš„èŒè´£èŒƒå›´ã€‚

### 0.4.2 Subagent

ä¸» Agent æ´¾å‡ºåŽ»æ‰§è¡Œç‰¹å®šå­ä»»åŠ¡çš„"ä¸‹å±ž"ã€‚åœ¨ Claude Code ä¸­ï¼Œé€šè¿‡ `Task` tool åˆ›å»ºã€‚

å…³é”®ç‰¹æ€§ï¼š**ä¸Šä¸‹æ–‡éš”ç¦»**ã€‚Subagent æœ‰è‡ªå·±ç‹¬ç«‹çš„å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œä¸ä¼šæ±¡æŸ“ä¸» Agent çš„ä¸Šä¸‹æ–‡çª—å£ã€‚å°±åƒä½ æ´¾å®žä¹ ç”ŸåŽ»è°ƒç ”ä¸€ä¸ªæŠ€æœ¯æ–¹æ¡ˆâ€”â€”ä»–åŽ»æŸ¥èµ„æ–™ã€å†™æŠ¥å‘Šï¼Œæœ€åŽåªæŠŠç»“è®ºå¸¦å›žæ¥ï¼Œä¸ä¼šæŠŠä»–æŸ¥è¿‡çš„ 100 ç¯‡æ–‡ç« éƒ½å¡žè¿›ä½ çš„è„‘å­é‡Œã€‚

Claude Code é€šè¿‡ Task tool çš„ `subagent_type` å‚æ•°æŒ‡å®š subagent ç±»åž‹ï¼š
- **Explore**ï¼šåªè¯»æŽ¢ç´¢ä»£ç åº“ï¼ˆåªèƒ½ç”¨ Glob/Grep/Readï¼Œä¸èƒ½ä¿®æ”¹æ–‡ä»¶ï¼‰
- **Plan**ï¼šæ–¹æ¡ˆè®¾è®¡ï¼ˆåªè¯»åˆ†æžï¼Œè¾“å‡ºå®žæ–½è®¡åˆ’ï¼‰
- **general-purpose**ï¼šé€šç”¨åž‹ï¼Œèƒ½è¯»å†™æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ï¼Œä»€ä¹ˆéƒ½èƒ½å¹²

### 0.4.3 Context Windowï¼ˆä¸Šä¸‹æ–‡çª—å£ï¼‰

Agent çš„"å·¥ä½œè®°å¿†"ã€‚æ‰€æœ‰çš„å¯¹è¯åŽ†å²ã€è¯»è¿‡çš„ä»£ç ã€å·¥å…·è°ƒç”¨ç»“æžœï¼Œéƒ½ä¼šå ç”¨ä¸Šä¸‹æ–‡çª—å£çš„ç©ºé—´ã€‚

Claude Code çš„ä¸Šä¸‹æ–‡çª—å£å¤§å°å–å†³äºŽåº•å±‚æ¨¡åž‹ï¼ˆç›®å‰æœ€å¤§ 200K tokenï¼‰ã€‚å¬èµ·æ¥å¾ˆå¤§ï¼Œä½†è¯»å‡ ä¸ªå¤§æ–‡ä»¶å°±èƒ½åƒæŽ‰ä¸€å¤§åŠã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ subagent çš„ä¸Šä¸‹æ–‡éš”ç¦»é‚£ä¹ˆé‡è¦â€”â€”ä½ ä¸æƒ³è®©ä¸€ä¸ªæŽ¢ç´¢ä»»åŠ¡æŠŠä¸» agent çš„è®°å¿†æ’‘çˆ†ã€‚

> ðŸ’¡ **Tip**: å½“ä¸Šä¸‹æ–‡å¿«æ»¡æ—¶ï¼ŒClaude Code ä¼šè‡ªåŠ¨åŽ‹ç¼©ï¼ˆcompactï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ `/compact` æ¥é‡Šæ”¾ç©ºé—´ã€‚

### 0.4.4 MCPï¼ˆModel Context Protocolï¼‰

ä¸€å¥—æ ‡å‡†åè®®ï¼Œè®© AI Agent èƒ½è¿žæŽ¥å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºã€‚

æ²¡æœ‰ MCP ä¹‹å‰ï¼Œæ¯ä¸ª AI å·¥å…·æƒ³æŽ¥ GitHub å°±å¾—è‡ªå·±å†™ä¸€å¥— GitHub é›†æˆï¼Œæƒ³æŽ¥æ•°æ®åº“åˆå¾—å†™ä¸€å¥—ã€‚æœ‰äº† MCPï¼Œå°±åƒ USB æŽ¥å£ä¸€æ ·â€”â€”åªè¦å·¥å…·å®žçŽ°äº† MCP åè®®ï¼Œä»»ä½•æ”¯æŒ MCP çš„ Agent éƒ½èƒ½ç›´æŽ¥ç”¨ã€‚

åœ¨ Claude Code ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ `claude mcp add` å‘½ä»¤æ·»åŠ  MCP Serverï¼Œçž¬é—´èŽ·å¾—æ–°èƒ½åŠ›ï¼ˆæ¯”å¦‚ç›´æŽ¥æ“ä½œ GitHub PRã€æŸ¥è¯¢æ•°æ®åº“ï¼‰ã€‚

### 0.4.5 Workflow / Orchestrationï¼ˆå·¥ä½œæµ / ç¼–æŽ’ï¼‰

æŠŠå¤šä¸ª Agent æŒ‰ç…§ä¸€å®šçš„é€»è¾‘ç»„ç»‡èµ·æ¥ï¼ŒååŒå®Œæˆä¸€ä¸ªå¤æ‚ä»»åŠ¡ã€‚

è¿™å°±æ˜¯æœ¬æ•™ç¨‹çš„æ ¸å¿ƒä¸»é¢˜ã€‚å•ä¸ª Agent èƒ½åŠ›æœ‰é™ï¼Œä½†å½“ä½ å­¦ä¼šç¼–æŽ’â€”â€”è®©å®ƒä»¬ä¸²è¡Œã€å¹¶è¡Œã€æ¡ä»¶åˆ†æ”¯ã€å¾ªçŽ¯â€”â€”å°±èƒ½å¤„ç†è¿œè¶…å•ä¸ª Agent èƒ½åŠ›èŒƒå›´çš„ä»»åŠ¡ã€‚

å¸¸è§çš„ç¼–æŽ’æ¨¡å¼ï¼š

```
é¡ºåºæ‰§è¡Œ:
     A â”€â”€â†’ B â”€â”€â†’ C

å¹¶è¡Œæ‰§è¡Œ:
          â”Œâ”€â”€ B â”€â”€â”
     A â”€â”€â”€â”¤       â”œâ”€â”€â†’ D
          â””â”€â”€ C â”€â”€â”˜

æ¡ä»¶åˆ†æ”¯:
          â”Œâ”€ yes â”€â†’ B
     A â”€â”€â”€â”¤
          â””â”€ no â”€â”€â†’ C

Fan-out/Fan-in:
     A â”€â”€â”€â”¬â”€â”€ B1 â”€â”€â”¬â”€â”€â†’ Cï¼ˆæ±‡æ€»ï¼‰
          â”œâ”€â”€ B2 â”€â”€â”¤
          â”œâ”€â”€ B3 â”€â”€â”¤
          â””â”€â”€ B4 â”€â”€â”˜
```

Code Review Automator ä¼šç”¨åˆ°æ‰€æœ‰è¿™äº›æ¨¡å¼ã€‚

### 0.4.6 Agentic æ¦‚å¿µå±‚æ¬¡å›¾

ä¸Šé¢ä»‹ç»çš„ Agentã€Skillã€Hookã€MCP ç­‰æ¦‚å¿µï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä»€ä¹ˆå±‚çº§å…³ç³»ï¼Ÿ

```
Agentic Framework (Claude Code / OpenCode)
â”‚
â”œâ”€â”€ CLAUDE.md é…ç½®å±‚
â”‚   å…¨å±€è§„åˆ™ã€é¡¹ç›®çº¦å®šã€ä»£ç é£Žæ ¼
â”‚
â”œâ”€â”€ Workflow ç¼–æŽ’å±‚
â”‚   é¡ºåº / å¹¶è¡Œ / è·¯ç”± / ç¼–æŽ’è€…ç­‰æ¨¡å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ Agent   è‡ªæ²»å•å…ƒ (è§’è‰² + èƒ½åŠ› + çº¦æŸ)
â”‚   â”œâ”€â”€ Skill   å¯å¤ç”¨ Prompt æ¨¡æ¿ (/å‘½ä»¤è§¦å‘)
â”‚   â””â”€â”€ Hook    äº‹ä»¶é©±åŠ¨è‡ªåŠ¨åŒ– (å·¥å…·è°ƒç”¨å‰åŽæ‹¦æˆª)
â”‚
â””â”€â”€ MCP å¤–éƒ¨å·¥å…·å±‚
    GitHub / æ•°æ®åº“ / æ–‡ä»¶ç³»ç»Ÿç­‰å¤–éƒ¨èƒ½åŠ›
```

```mermaid
graph TD
    Framework["Agentic Framework\nClaude Code / OpenCode"]

    Config["CLAUDE.md é…ç½®å±‚\nå…¨å±€è§„åˆ™ Â· é¡¹ç›®çº¦å®š Â· ä»£ç é£Žæ ¼"]
    Orch["Workflow ç¼–æŽ’å±‚\né¡ºåº / å¹¶è¡Œ / è·¯ç”± / ç¼–æŽ’è€…"]
    ExtMCP["MCP å¤–éƒ¨å·¥å…·å±‚\nGitHub / æ•°æ®åº“ / æ–‡ä»¶ç³»ç»Ÿ"]

    Agent(["Agent\nè‡ªæ²»å•å…ƒ\nè§’è‰² + èƒ½åŠ› + çº¦æŸ"])
    Skill(["Skill\nå¯å¤ç”¨ Prompt æ¨¡æ¿\n/å‘½ä»¤è§¦å‘"])
    Hook(["Hook\näº‹ä»¶é©±åŠ¨è‡ªåŠ¨åŒ–\nå·¥å…·è°ƒç”¨å‰åŽæ‹¦æˆª"])

    Framework --> Config
    Framework --> Orch
    Framework --> ExtMCP

    Orch --> Agent
    Orch --> Skill
    Orch --> Hook
```

### 0.4.7 å„å±‚èŒè´£é€ŸæŸ¥è¡¨

| å±‚çº§ | æ˜¯ä»€ä¹ˆ | æ”¾åœ¨å“ª | è§¦å‘æ–¹å¼ |
|------|--------|--------|---------|
| Workflow | å¤šæ­¥éª¤ä»»åŠ¡çš„ç¼–æŽ’æ¨¡å¼ï¼ˆé¡ºåºã€å¹¶è¡Œã€è·¯ç”±â€¦ï¼‰ | Skill æ–‡ä»¶ä¸­ç¼–æŽ’ï¼Œæˆ– CLAUDE.md ä¸­æè¿° | ç”¨æˆ·æŒ‡ä»¤æˆ– Skill è§¦å‘ |
| Agent | æœ‰è§’è‰²ã€èƒ½åŠ›ã€çº¦æŸçš„è‡ªæ²»å•å…ƒ | `.claude/agents/*.md` | è¢« Skill æˆ–ä¸» Agent ä½œä¸º subagent è°ƒç”¨ |
| Skill | å¯å¤ç”¨çš„ prompt æ¨¡æ¿ | `.claude/skills/*/SKILL.md` | ç”¨æˆ·è¾“å…¥ `/skill-name` |
| Hook | äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨åŒ–è§„åˆ™ | `.claude/settings.json` | å·¥å…·è°ƒç”¨å‰åŽè‡ªåŠ¨è§¦å‘ |
| MCP | å¤–éƒ¨å·¥å…·åè®®ï¼ˆGitHubã€DBã€FSâ€¦ï¼‰ | `.claude/settings.json` æˆ–å…¨å±€é…ç½® | Agent/Skill éœ€è¦å¤–éƒ¨èƒ½åŠ›æ—¶è‡ªåŠ¨è°ƒç”¨ |
| CLAUDE.md | é¡¹ç›®çº§è§„åˆ™å’Œçº¦å®š | é¡¹ç›®æ ¹ç›®å½• `CLAUDE.md` | æ¯æ¬¡ä¼šè¯è‡ªåŠ¨åŠ è½½ |

### 0.4.8 åœ¨ Review Bot ä¸­çš„å¯¹åº”

æŠŠè¿™ä¸ªå±‚æ¬¡æ˜ å°„åˆ°æˆ‘ä»¬å³å°†æž„å»ºçš„é¡¹ç›®ï¼š

```
Review Bot æ¦‚å¿µæ˜ å°„ï¼š

Workflow    â†’ /review-bot skill ç¼–æŽ’çš„ 4 æ­¥æµç¨‹
              (get diff â†’ fan-out agents â†’ fan-in â†’ report)

Agent       â†’ 4 ä¸ªå®¡æŸ¥ agentï¼ˆå®‰å…¨/æ€§èƒ½/é£Žæ ¼/é€»è¾‘ï¼‰
              å®šä¹‰åœ¨ .claude/agents/*.md

Skill       â†’ /review-bot å‘½ä»¤
              å®šä¹‰åœ¨ .claude/skills/review-bot/SKILL.md

Hook        â†’ commit åŽè‡ªåŠ¨æç¤ºã€å†™æ–‡ä»¶åŽè‡ªåŠ¨æµ‹è¯•
              é…ç½®åœ¨ .claude/settings.json

MCP         â†’ æœ¬é¡¹ç›®æš‚ä¸ä½¿ç”¨ï¼ˆçº¯æœ¬åœ° git æ“ä½œï¼‰

CLAUDE.md   â†’ é¡¹ç›®è§„åˆ™ã€ä»£ç é£Žæ ¼ã€ä¸‰å±‚æž¶æž„è¯´æ˜Ž
```

> ðŸ’¡ **Tip**: æžæ¸…æ¥šæ¦‚å¿µå±‚æ¬¡ï¼ŒåŽé¢å†™ä»£ç æ—¶å°±ä¸ä¼šçº ç»“"è¿™æ®µé€»è¾‘è¯¥æ”¾ Python é‡Œè¿˜æ˜¯æ”¾ Skill é‡Œ"ã€‚ç»éªŒæ³•åˆ™ï¼š**å¯æµ‹è¯•çš„æ•°æ®å¤„ç†æ”¾ Pythonï¼ŒLLM ç¼–æŽ’æ”¾ Skillï¼Œä¸“ä¸šè§’è‰²æ”¾ Agentï¼Œè‡ªåŠ¨åŒ–è§¦å‘æ”¾ Hook**ã€‚

---

## 0.5 Claude Code å¿«é€Ÿå®‰è£…

æ—¢ç„¶é€‰å®šäº†å·¥å…·ï¼Œå…ˆæŠŠå®ƒè£…ä¸Šã€‚

```bash
# Install Claude Code (requires Node.js 18+)
npm install -g @anthropic-ai/claude-code

# Verify installation
claude --version

# Start Claude Code
claude
```

é¦–æ¬¡å¯åŠ¨ä¼šè¦æ±‚ä½ ç™»å½• Anthropic è´¦å·æˆ–é…ç½® API keyã€‚æŒ‰æç¤ºæ“ä½œå³å¯ã€‚

> âš ï¸ **æ³¨æ„**: Claude Code éœ€è¦ Node.js 18 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å¦‚æžœä½ è¿˜æ²¡è£… Node.jsï¼ŒæŽ¨èç”¨ [nvm](https://github.com/nvm-sh/nvm) ç®¡ç†ç‰ˆæœ¬ã€‚

---

## 0.6 å°ç»“

å¿«é€Ÿæ‰«äº†ä¸€é AI Coding Agent çš„ç”Ÿæ€ï¼š

- AI Coding Agent å’ŒèŠå¤©å¼ AI çš„æœ¬è´¨åŒºåˆ«åœ¨äºŽ**è‡ªä¸»æ€§**
- å•†ä¸šäº§å“ï¼ˆClaude Code / Codex CLI / Gemini CLIï¼‰å„æœ‰ä¾§é‡
- å¼€æºå·¥å…·ï¼ˆOpenCode / Aiderï¼‰å’Œæ¡†æž¶ï¼ˆOpenClaw / NanoClaw / NanoBotï¼‰æä¾›äº†æ›´å¤šé€‰æ‹©
- é€‰ Claude Code æ˜¯å› ä¸ºå®ƒçš„ agent ç¼–æŽ’èƒ½åŠ›æœ€å®Œæ•´
- AI æ—¶ä»£çš„å¼€å‘æ¨¡å¼ï¼šVibe Codingã€TDD with AIã€Spec-Drivenã€Ralph Loopã€Plan-then-Codeâ€”â€”æ ¹æ®åœºæ™¯æ··åˆä½¿ç”¨
- æ ¸å¿ƒæ¦‚å¿µï¼šAgentã€Subagentã€Context Windowã€MCPã€Workflow

---

# Ch1: éœ€æ±‚åˆ†æž â€” ç”¨ Plan Agent æƒ³æ¸…æ¥šå†åŠ¨æ‰‹

> å†™ä»£ç ä¹‹å‰æœ€é‡è¦çš„äº‹ï¼šæƒ³æ¸…æ¥šè¦åšä»€ä¹ˆã€‚

**æœ¯è¯­**

- Plan Modeï¼ˆè§„åˆ’æ¨¡å¼ï¼ŒClaude Code çš„åªè¯»è§„åˆ’çŠ¶æ€ï¼‰
- PRï¼ˆPull Requestï¼Œåˆå¹¶è¯·æ±‚ï¼‰
- Subagentï¼ˆå­ä»£ç†ï¼Œä¸» Agent æ´¾å‡ºçš„ä¸‹å±žï¼‰
- Dataclassï¼ˆPython æ•°æ®ç±»ï¼Œç”¨è£…é¥°å™¨è‡ªåŠ¨ç”Ÿæˆæ ·æ¿ä»£ç ï¼‰
- Fan-out/Fan-inï¼ˆæ‰‡å‡º/æ‰‡å…¥ï¼Œå¹¶è¡Œåˆ†å‘å†æ±‡æ€»çš„æ¨¡å¼ï¼‰

**æœ¬ç« æ–°æ¦‚å¿µ**

| æ¦‚å¿µ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------------|
| Plan Mode | å†™åˆ°ä¸€åŠå‘çŽ°æž¶æž„ä¸å¯¹ï¼ŒæŽ¨å€’é‡æ¥â€”â€”ä¸å¦‚å…ˆè®© AI å¸®ä½ æƒ³æ¸…æ¥šå†åŠ¨æ‰‹ |

## 1.1 åœºæ™¯å¼•å…¥

ä½ æŽ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼š"åšä¸€ä¸ªè‡ªåŠ¨ä»£ç å®¡æŸ¥å·¥å…·"ã€‚

å¤§å¤šæ•°äººçš„ç¬¬ä¸€ååº”æ˜¯æ‰“å¼€ç¼–è¾‘å™¨å¼€å§‹å†™ä»£ç ã€‚ç„¶åŽå†™åˆ°ä¸€åŠå‘çŽ°æž¶æž„ä¸å¯¹ï¼ŒæŽ¨å€’é‡æ¥ã€‚å†å†™åˆ°ä¸€åŠå‘çŽ°éœ€æ±‚ç†è§£é”™äº†ï¼ŒåˆæŽ¨å€’é‡æ¥ã€‚

å¦‚æžœä½ æœ‰ä¸€ä¸ª AI åŠ©æ‰‹ï¼Œèƒ½åœ¨åŠ¨æ‰‹ä¹‹å‰å¸®ä½ æŠŠéœ€æ±‚æ‹†æ¸…æ¥šã€æž¶æž„æƒ³æ˜Žç™½ã€ä»»åŠ¡æŽ’å¥½åºå‘¢ï¼Ÿ

è¿™å°±æ˜¯ Claude Code çš„ **Plan Agent** èƒ½åšçš„äº‹ã€‚

---

## 1.2 è®¾è®¡æ€ç»´ï¼šä¸ºä»€ä¹ˆè¦ç”¨ AI åšè§„åˆ’ï¼Ÿ

### 1.2.1 è§„åˆ’çš„ä»·å€¼

è½¯ä»¶å¼€å‘ä¸­ï¼Œæœ€è´µçš„ä¸æ˜¯å†™ä»£ç ï¼Œè€Œæ˜¯**å†™é”™ä»£ç **ã€‚è¿”å·¥çš„æˆæœ¬è¿œé«˜äºŽå¤šèŠ±ç‚¹æ—¶é—´æƒ³æ¸…æ¥šã€‚

ä¼ ç»Ÿåšæ³•ï¼šä½ è‡ªå·±å†™ PRDã€ç”»æž¶æž„å›¾ã€æ‹†ä»»åŠ¡ã€‚è¿™äº›éƒ½æ˜¯ä½ çš„ç»éªŒåœ¨é©±åŠ¨ã€‚

AI è¾…åŠ©åšæ³•ï¼šä½ æè¿°ç›®æ ‡ï¼ŒAI å¸®ä½ è¡¥ç›²ç‚¹ã€‚å®ƒè§è¿‡çš„é¡¹ç›®æ¯”ä½ å¤šï¼Œèƒ½æé†’ä½ "è¿™é‡Œé€šå¸¸ä¼šæœ‰å‘"ã€‚

> å…³é”®å¿ƒæ€è½¬å˜ï¼šä¸æ˜¯è®© AI æ›¿ä½ å†³ç­–ï¼Œè€Œæ˜¯è®©å®ƒå¸®ä½ **æƒ³å¾—æ›´å…¨é¢**ã€‚æœ€ç»ˆæ‹æ¿çš„è¿˜æ˜¯ä½ ã€‚

### 1.2.2 Claude Code çš„ Plan æ¨¡å¼

Claude Code æœ‰ä¸€ä¸ªå†…ç½®çš„ Plan æ¨¡å¼ã€‚å½“ä½ é¢å¯¹ä¸€ä¸ªå¤æ‚ä»»åŠ¡æ—¶ï¼Œå¯ä»¥è®©å®ƒå…ˆè¿›å…¥"è§„åˆ’æ¨¡å¼"â€”â€”åªæ€è€ƒã€ä¸åŠ¨æ‰‹ã€‚

**æ€Žä¹ˆè¿›å…¥ Plan æ¨¡å¼ï¼Ÿ**

åœ¨ Claude Code çš„è¾“å…¥æ¡†ä¸­æŒ‰ `Shift+Tab`ï¼Œä¼šåœ¨ä¸‰ç§æ¨¡å¼ä¹‹é—´å¾ªçŽ¯åˆ‡æ¢ï¼š

```
Normal Mode â†’ Auto-accept Edits â†’ Plan Mode â†’ Normal Mode â†’ ...
```

å½“åº•éƒ¨çŠ¶æ€æ æ˜¾ç¤º `â¸ plan mode on` æ—¶ï¼Œå°±è¿›å…¥äº† Plan æ¨¡å¼ã€‚

**Plan æ¨¡å¼ä¸‹èƒ½åšä»€ä¹ˆï¼Ÿ**

| èƒ½åš | ä¸èƒ½åš |
|------|--------|
| è¯»å–æ–‡ä»¶ã€æœç´¢ä»£ç  | åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æ–‡ä»¶ |
| æ´¾å‡º Explore subagent åˆ†æžæž¶æž„ | æ‰§è¡Œä¿®æ”¹æ€§çš„ shell å‘½ä»¤ |
| æœç´¢ç½‘é¡µã€èŽ·å–æ–‡æ¡£ | å®‰è£…ä¾èµ–åŒ… |
| å‘ä½ æé—®ã€æ¾„æ¸…éœ€æ±‚ | ä»»ä½•ä¼šæ”¹å˜ä»£ç åº“çš„æ“ä½œ |
| åˆ›å»ºå’Œç®¡ç†ä»»åŠ¡åˆ—è¡¨ | |

è¿™ä¸ª"åªè¯»"çº¦æŸå¾ˆé‡è¦â€”â€”å®ƒä¿è¯äº† AI åœ¨è§„åˆ’é˜¶æ®µä¸ä¼š"æ‰‹ç—’"å·å·æ”¹ä½ çš„ä»£ç ã€‚

**æ€Žä¹ˆé€€å‡ºï¼Ÿ**

å†æŒ‰ä¸€æ¬¡ `Shift+Tab` åˆ‡å›ž Normal Modeã€‚ç¡®è®¤æ–¹æ¡ˆåŽï¼Œåœ¨ Normal Mode ä¸‹è®© AI æŒ‰æ–¹æ¡ˆæ‰§è¡Œã€‚

> ðŸ’¡ **Tip**: ä½ ä¹Ÿå¯ä»¥ä¸ç”¨ Plan æ¨¡å¼çš„å¿«æ·é”®ï¼Œç›´æŽ¥åœ¨ prompt é‡Œè¯´"è¯·å…ˆå¸®æˆ‘è§„åˆ’ï¼Œä¸è¦å†™ä»£ç "ã€‚æ•ˆæžœç±»ä¼¼ï¼Œä½† Plan æ¨¡å¼çš„ç¡¬çº¦æŸæ›´å¯é â€”â€”å®ƒä»Žå·¥å…·å±‚é¢ç¦æ­¢äº†å†™æ“ä½œï¼Œè€Œä¸æ˜¯é  AI çš„"è‡ªè§‰"ã€‚

Plan æ¨¡å¼ä¸‹ï¼ŒClaude Code ä¼šï¼š
1. åˆ†æžä½ çš„éœ€æ±‚
2. æŽ¢ç´¢ç›¸å…³ä»£ç ï¼ˆå¦‚æžœå·²æœ‰ä»£ç åº“ï¼‰
3. è®¾è®¡å®žçŽ°æ–¹æ¡ˆ
4. åˆ—å‡ºå…·ä½“æ­¥éª¤
5. ç­‰ä½ ç¡®è®¤åŽå†æ‰§è¡Œ

è¿™å’Œç›´æŽ¥è®©å®ƒ"å¸®æˆ‘å†™ä¸ª XXX"æœ‰æœ¬è´¨åŒºåˆ«ã€‚åŽè€…æ˜¯è¾¹æƒ³è¾¹åšï¼Œå‰è€…æ˜¯æƒ³æ¸…æ¥šå†åšã€‚è¿™å°±æ˜¯ Ch0 ä¸­æåˆ°çš„ **Plan-then-Code** å¼€å‘æ¨¡å¼çš„å®žè·µã€‚

---

## 1.3 å®žæ“å¤çŽ°ï¼šè§„åˆ’ Code Review Automator

### Step 1: å¯åŠ¨ Claude Code å¹¶æè¿°é¡¹ç›®

æ‰“å¼€ç»ˆç«¯ï¼Œåˆ›å»ºé¡¹ç›®ç›®å½•ï¼š

```bash
mkdir -p ~/projects/review-bot && cd ~/projects/review-bot
claude
```

è¿›å…¥ Claude Code åŽï¼Œè¾“å…¥ï¼š

```
æˆ‘æƒ³æž„å»ºä¸€ä¸ª Code Review Automator CLI å·¥å…·ã€‚
åŠŸèƒ½ï¼šåˆ†æžæœ¬åœ° git diffï¼Œç”¨å¤šä¸ªä¸“ä¸š agent å¹¶è¡Œå®¡æŸ¥ï¼ˆå®‰å…¨ã€æ€§èƒ½ã€é£Žæ ¼ã€é€»è¾‘ï¼‰ï¼Œç”Ÿæˆç»“æž„åŒ–æŠ¥å‘Šã€‚
æŠ€æœ¯æ ˆï¼šPython + typerã€‚
è¯·å…ˆå¸®æˆ‘è§„åˆ’ï¼Œä¸è¦å†™ä»£ç ã€‚
```

> ðŸ’¡ **Tip**: æœ€åŽé‚£å¥"è¯·å…ˆå¸®æˆ‘è§„åˆ’ï¼Œä¸è¦å†™ä»£ç "å¾ˆå…³é”®ã€‚ä¸åŠ è¿™å¥ï¼ŒClaude Code å¯èƒ½ç›´æŽ¥å¼€å§‹å†™ä»£ç ã€‚æ˜Žç¡®å‘Šè¯‰å®ƒä½ è¦çš„æ˜¯è§„åˆ’ï¼Œä¸æ˜¯å®žçŽ°ã€‚

### Step 2: å®¡è§† AI ç»™å‡ºçš„è§„åˆ’

Claude Code é€šå¸¸ä¼šç»™å‡ºç±»ä¼¼è¿™æ ·çš„è§„åˆ’ï¼š

```
é¡¹ç›®ç»“æž„ï¼š
review_bot/
â”œâ”€â”€ cli.py          # CLI entry point (typer)
â”œâ”€â”€ diff_parser.py  # Git diff parsing
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ security.py # Security review agent
â”‚   â”œâ”€â”€ performance.py
â”‚   â”œâ”€â”€ style.py
â”‚   â””â”€â”€ logic.py
â”œâ”€â”€ reporter.py     # Report generation
â””â”€â”€ config.py       # Configuration

å®žçŽ°æ­¥éª¤ï¼š
1. æ­å»º CLI æ¡†æž¶ï¼ˆtyperï¼‰
2. å®žçŽ° git diff è§£æž
3. è®¾è®¡å®¡æŸ¥ agent prompt
4. å®žçŽ°å¹¶è¡Œå®¡æŸ¥è°ƒåº¦
5. å®žçŽ°æŠ¥å‘Šç”Ÿæˆ
6. æ·»åŠ  hook è‡ªåŠ¨è§¦å‘
```

è¿™ä¸ªè§„åˆ’çœ‹èµ·æ¥ä¸é”™ï¼Œä½†æœ‰å‡ ä¸ªé—®é¢˜å€¼å¾—è¿½é—®ï¼š

```
å‡ ä¸ªé—®é¢˜ï¼š
1. diff è§£æžè¦æ”¯æŒå“ªäº›æ ¼å¼ï¼Ÿåªæ”¯æŒ unified diff è¿˜æ˜¯ä¹Ÿè¦æ”¯æŒ statï¼Ÿ
2. agent ä¹‹é—´éœ€è¦å…±äº«ä¸Šä¸‹æ–‡å—ï¼Ÿæ¯”å¦‚å®‰å…¨ agent å‘çŽ°çš„é—®é¢˜ï¼Œé€»è¾‘ agent éœ€è¦çŸ¥é“å—ï¼Ÿ
3. æŠ¥å‘Šè¾“å‡ºä»€ä¹ˆæ ¼å¼ï¼Ÿçº¯æ–‡æœ¬ï¼ŸMarkdownï¼ŸJSONï¼Ÿ
4. é”™è¯¯å¤„ç†ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿä¸€ä¸ª agent æŒ‚äº†ï¼Œå…¶ä»–çš„ç»§ç»­è¿˜æ˜¯å…¨éƒ¨åœï¼Ÿ
```

> âš ï¸ **è¸©å‘æé†’**: ä¸è¦æ— è„‘æŽ¥å— AI çš„ç¬¬ä¸€ç‰ˆè§„åˆ’ã€‚å®ƒç»™çš„æ˜¯"é€šç”¨æœ€ä½³å®žè·µ"ï¼Œä¸ä¸€å®šé€‚åˆä½ çš„å…·ä½“åœºæ™¯ã€‚ä½ çš„å·¥ä½œæ˜¯**è¿½é—®ç»†èŠ‚**å’Œ**åšå–èˆ**ã€‚

### Step 3: è¿­ä»£ç»†åŒ–

å¥½çš„è§„åˆ’ä¸æ˜¯ä¸€è½®å°±èƒ½å®šçš„ã€‚ä½ éœ€è¦å’Œ AI æ¥å›žå‡ è½®ï¼Œé€æ­¥æ”¶æ•›ï¼š

```
ä½ : agent ä¹‹é—´éœ€è¦å…±äº«ä¸Šä¸‹æ–‡å—ï¼Ÿæ¯”å¦‚å®‰å…¨ agent å‘çŽ°äº† buffer overflowï¼Œ
    é€»è¾‘ agent éœ€è¦çŸ¥é“è¿™ä»¶äº‹å—ï¼Ÿ

AI: å»ºè®®ä¸å…±äº«ã€‚å…±äº«ä¼šå¼•å…¥ä¾èµ–ï¼ˆå®‰å…¨ agent å¿…é¡»å…ˆè·‘å®Œï¼‰ï¼Œè¯¯åˆ¤ä¼šä¼ æŸ“ï¼Œ
    ä¸”ç‹¬ç«‹è¿è¡Œæ‰èƒ½å¹¶è¡Œã€‚ä»£ä»·æ˜¯å°‘é‡é‡å¤å‘çŽ°ï¼Œæ±‡æ€»é˜¶æ®µåŽ»é‡å³å¯ã€‚

ä½ : åŒæ„ã€‚é‚£å¦‚æžœä¸€ä¸ª agent æŒ‚äº†å‘¢ï¼Ÿ

AI: å»ºè®®éƒ¨åˆ†å¤±è´¥ç»§ç»­ï¼Œåœ¨æŠ¥å‘Šä¸­æ ‡æ³¨å“ªä¸ª agent å¤±è´¥äº†ã€‚
    3 ä¸ª agent çš„å®¡æŸ¥ç»“æžœæ€»æ¯” 0 ä¸ªå¥½ã€‚

ä½ : é€‰è¿™ä¸ªã€‚å››ä¸ª agent çš„è¾“å‡ºæ ¼å¼éœ€è¦ç»Ÿä¸€å—ï¼Ÿ

AI: å¼ºçƒˆå»ºè®®ç»Ÿä¸€ä¸º 5 ä¸ªå­—æ®µï¼šseverity / file / line / description / suggestionã€‚
    severity åˆ† 3 çº§ï¼šcriticalï¼ˆå¿…é¡»ä¿®å¤ï¼‰/ warningï¼ˆå»ºè®®ä¿®å¤ï¼‰/ infoï¼ˆå¯é€‰æ”¹è¿›ï¼‰ã€‚
    æŠ¥å‘Šçš„æœ€ç»ˆ verdict åŸºäºŽæœ€é«˜ severity å†³å®šã€‚

ä½ : å¥½ï¼Œå°±è¿™æ ·ã€‚
```

ç»è¿‡å‡ è½®è¿½é—®ï¼Œç¡®å®šäº†ä»¥ä¸‹è®¾è®¡å†³ç­–ï¼š

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|--------|------|------|
| Diff æ ¼å¼ | unified diff | ä¿¡æ¯æœ€å®Œæ•´ï¼ŒåŒ…å«ä¸Šä¸‹æ–‡è¡Œ |
| Agent é—´é€šä¿¡ | ä¸å…±äº« | ä¿æŒç‹¬ç«‹æ€§ï¼Œé¿å…çº§è”é”™è¯¯ |
| æŠ¥å‘Šæ ¼å¼ | Markdown + JSON | Markdown ç»™äººçœ‹ï¼ŒJSON ç»™ç¨‹åºç”¨ |
| é”™è¯¯å¤„ç† | éƒ¨åˆ†å¤±è´¥ç»§ç»­ | ä¸€ä¸ª agent æŒ‚äº†ä¸å½±å“å…¶ä»–å®¡æŸ¥ |
| CLI æ¡†æž¶ | typer | ç±»åž‹å®‰å…¨ï¼Œè‡ªåŠ¨ç”Ÿæˆå¸®åŠ©æ–‡æ¡£ |
| è¾“å‡ºæ ¼å¼ | ç»Ÿä¸€ 5 å­—æ®µ | severity / file / line / description / suggestion |
| ä¸¥é‡ç¨‹åº¦ | 3 çº§ | critical / warning / info |

### Step 4: ç¡®è®¤æœ€ç»ˆæž¶æž„

è®© Claude Code æ ¹æ®è®¨è®ºç»“æžœç”»å‡ºæœ€ç»ˆæž¶æž„ï¼š

```
è¯·æ ¹æ®è®¨è®ºç»“æžœï¼Œç”»å‡ºæœ€ç»ˆçš„ç³»ç»Ÿæž¶æž„å›¾ï¼ˆASCIIï¼‰å’Œç¡®è®¤é¡¹ç›®ç»“æž„ã€‚
```

æœ€ç»ˆæž¶æž„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CLI (typer)                   â”‚
â”‚           review-bot review                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Diff Parser                    â”‚
â”‚       git diff â†’ structured data           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼         â–¼       â–¼         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
   â”‚Securityâ”‚ â”‚ Perf â”‚ â”‚ Style â”‚ â”‚ Logic â”‚
   â”‚ Agent  â”‚ â”‚Agent â”‚ â”‚ Agent â”‚ â”‚ Agent â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”˜
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Reporter                      â”‚
â”‚      aggregate â†’ markdown / json           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 5: ç”¨å·¥å…·èƒ½åŠ›å¿«é€Ÿç†è§£ Agentic æ¦‚å¿µå±‚æ¬¡

è§„åˆ’é¡¹ç›®æž¶æž„ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä»¶äº‹å€¼å¾—åšï¼š**æžæ¸…æ¥šä½ ç”¨çš„å·¥å…·æœ¬èº«çš„æ¦‚å¿µä½“ç³»**ã€‚

Claude Code / OpenCode è¿™ç±» agentic coding tool ä¸åªæ˜¯"èƒ½èŠå¤©çš„ç¼–è¾‘å™¨"ã€‚å®ƒä»¬æœ‰ä¸€å¥—å®Œæ•´çš„å±‚çº§æ¦‚å¿µâ€”â€”Frameworkã€Workflowã€Agentã€Skillã€Hookã€MCPâ€”â€”æžæ··äº†å°±ä¼šæŠŠä»£ç æ”¾é”™åœ°æ–¹ã€‚

å¥½æ¶ˆæ¯æ˜¯ï¼Œä½ å¯ä»¥ç”¨å·¥å…·è‡ªèº«çš„èƒ½åŠ›æ¥ç†è§£è¿™äº›æ¦‚å¿µã€‚

**æ–¹æ³• 1ï¼šç”¨ Plan æ¨¡å¼æé—®**

```
è¯·å¸®æˆ‘æ¢³ç† Claude Code çš„æ¦‚å¿µå±‚æ¬¡ï¼š
- Agentic Frameworkã€Workflowã€Agentã€Skillã€Hookã€MCP åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
- å®ƒä»¬ä¹‹é—´çš„å±‚çº§å…³ç³»å’Œåä½œæ–¹å¼æ˜¯æ€Žæ ·çš„ï¼Ÿ
- åœ¨ä¸€ä¸ªå®žé™…é¡¹ç›®ä¸­ï¼Œä»£ç åº”è¯¥æ”¾åœ¨å“ªä¸€å±‚ï¼Ÿ
ä¸è¦å†™ä»£ç ï¼Œåªç»™æˆ‘æ¦‚å¿µæ¢³ç†ã€‚
```

**æ–¹æ³• 2ï¼šç”¨ Explore Agent çœ‹çœŸå®žé¡¹ç›®**

```
å¸®æˆ‘åˆ†æžè¿™ä¸ªé¡¹ç›®çš„ .claude/ ç›®å½•ç»“æž„ã€‚
æˆ‘éœ€è¦çŸ¥é“ï¼š
1. commands/ã€agents/ã€skills/ ä¸‰ä¸ªç›®å½•å„æ”¾äº†ä»€ä¹ˆï¼Ÿ
2. settings.json é‡Œé…ç½®äº†å“ªäº› hookï¼Ÿ
3. è¿™äº›é…ç½®æ˜¯æ€Žä¹ˆåä½œçš„ï¼Ÿ
```

**æ–¹æ³• 3ï¼šç”¨ WebSearch æŸ¥å®˜æ–¹æ–‡æ¡£**

```
æœç´¢ Claude Code å®˜æ–¹æ–‡æ¡£ä¸­å…³äºŽ hooksã€skillsã€agents çš„è¯´æ˜Žï¼Œ
å¸®æˆ‘æ•´ç†æˆä¸€ä»½å¯¹æ¯”è¡¨ã€‚
```

ä¸‰ç§æ–¹æ³•å¯ä»¥ç»„åˆä½¿ç”¨ã€‚Plan æ¨¡å¼ç»™ä½ æ¦‚å¿µæ¡†æž¶ï¼ŒExplore Agent ç»™ä½ çœŸå®žæ¡ˆä¾‹ï¼ŒWebSearch è¡¥å……æœ€æ–°æ–‡æ¡£ã€‚

æ¦‚å¿µå±‚æ¬¡å›¾å’Œå„å±‚èŒè´£é€ŸæŸ¥è¡¨è§å‰æ–‡ [Agentic æ¦‚å¿µå±‚æ¬¡å›¾](#046-agentic) ä¸€èŠ‚ã€‚

> ðŸ’¡ **Tip**: åœ¨è§„åˆ’é˜¶æ®µå°±æŠŠæ¦‚å¿µå±‚æ¬¡ç†æ¸…ï¼ŒåŽé¢å†™ä»£ç æ—¶å°±ä¸ä¼šçº ç»“"è¿™æ®µé€»è¾‘è¯¥æ”¾ Python é‡Œè¿˜æ˜¯æ”¾ Skill é‡Œ"ã€‚ç»éªŒæ³•åˆ™ï¼š**å¯æµ‹è¯•çš„æ•°æ®å¤„ç†æ”¾ Pythonï¼ŒLLM ç¼–æŽ’æ”¾ Skillï¼Œä¸“ä¸šè§’è‰²æ”¾ Agentï¼Œè‡ªåŠ¨åŒ–è§¦å‘æ”¾ Hook**ã€‚

---

## 1.4 æç‚¼æ¨¡æ¿ï¼šAI è¾…åŠ©è§„åˆ’çš„é€šç”¨æµç¨‹

ä¸ç®¡ä½ åšä»€ä¹ˆé¡¹ç›®ï¼Œéƒ½å¯ä»¥å¥—ç”¨è¿™ä¸ªæµç¨‹ï¼š

```
1. æè¿°ç›®æ ‡ï¼ˆä¸è¦è¯´"æ€Žä¹ˆåš"ï¼Œåªè¯´"è¦ä»€ä¹ˆ"ï¼‰
   â†“
2. è®© AI ç»™å‡ºåˆç‰ˆè§„åˆ’
   â†“
3. è¿½é—®ç»†èŠ‚ï¼ˆæ ¼å¼ï¼Ÿè¾¹ç•Œï¼Ÿé”™è¯¯å¤„ç†ï¼Ÿï¼‰
   â†“
4. åšå–èˆï¼ˆè®°å½•æ¯ä¸ªå†³ç­–çš„ç†ç”±ï¼‰
   â†“
5. ç¡®è®¤æœ€ç»ˆæ–¹æ¡ˆï¼ˆæž¶æž„å›¾ + é¡¹ç›®ç»“æž„ + å®žæ–½æ­¥éª¤ï¼‰
```

### 1.4.1 Prompt æ¨¡æ¿

```
æˆ‘æƒ³æž„å»º [é¡¹ç›®æè¿°]ã€‚
åŠŸèƒ½éœ€æ±‚ï¼š[åˆ—å‡ºæ ¸å¿ƒåŠŸèƒ½]
æŠ€æœ¯çº¦æŸï¼š[æŠ€æœ¯æ ˆã€å¹³å°ã€æ€§èƒ½è¦æ±‚ç­‰]
è¯·å…ˆå¸®æˆ‘è§„åˆ’ï¼Œä¸è¦å†™ä»£ç ã€‚éœ€è¦åŒ…å«ï¼š
- é¡¹ç›®ç»“æž„
- æ ¸å¿ƒæ¨¡å—åˆ’åˆ†
- å®žæ–½æ­¥éª¤ï¼ˆæŒ‰ä¼˜å…ˆçº§æŽ’åºï¼‰
- ä½ è®¤ä¸ºéœ€è¦æå‰æƒ³æ¸…æ¥šçš„è®¾è®¡å†³ç­–
```

### 1.4.2 å†³ç­–è®°å½•æ¨¡æ¿

å…»æˆè®°å½•è®¾è®¡å†³ç­–çš„ä¹ æƒ¯ã€‚åŽé¢å›žå¤´çœ‹ï¼Œä½ ä¼šæ„Ÿè°¢è‡ªå·±çš„ã€‚

```markdown
## å†³ç­–ï¼š[å†³ç­–æ ‡é¢˜]
- é€‰é¡¹ Aï¼š[æè¿°] â€” ä¼˜ç‚¹ / ç¼ºç‚¹
- é€‰é¡¹ Bï¼š[æè¿°] â€” ä¼˜ç‚¹ / ç¼ºç‚¹
- **é€‰æ‹©**ï¼š[é€‰äº†å“ªä¸ª]
- **ç†ç”±**ï¼š[ä¸ºä»€ä¹ˆ]
```

---

## 1.5 è§„åˆ’çš„å¸¸è§è¯¯åŒº

### è¯¯åŒº 1ï¼šè§„åˆ’ç­‰äºŽå†™ PRD

ä¸éœ€è¦å†™ä¸€ä»½ 20 é¡µçš„éœ€æ±‚æ–‡æ¡£ã€‚AI è¾…åŠ©è§„åˆ’çš„é‡ç‚¹æ˜¯**å¯¹è¯å¼æŽ¢ç´¢**â€”â€”é€šè¿‡æé—®å’Œå›žç­”é€æ­¥æ”¶æ•›æ–¹æ¡ˆã€‚ä¸€ä¸ªæ¸…æ™°çš„æž¶æž„å›¾ + ä¸€å¼ å†³ç­–è¡¨ï¼Œæ¯”ä¸€ä»½å†—é•¿çš„ PRD æ›´æœ‰ç”¨ã€‚

### è¯¯åŒº 2ï¼šä¸€æ¬¡è§„åˆ’åˆ°ä½

æ²¡æœ‰äººèƒ½åœ¨ç¬¬ä¸€æ¬¡å°±æƒ³æ¸…æ¥šæ‰€æœ‰ç»†èŠ‚ã€‚å¥½çš„è§„åˆ’æ˜¯**æ¸è¿›å¼**çš„ï¼šå…ˆå®šå¤§æ–¹å‘ï¼ˆCh1ï¼‰ï¼Œå®žçŽ°è¿‡ç¨‹ä¸­é‡åˆ°æ–°é—®é¢˜å†è¡¥å……ã€‚Review Bot å°±æ˜¯è¿™æ ·â€”â€”Ch1 å®šäº†æ•´ä½“æž¶æž„ï¼Œä½† agent çš„å…·ä½“ prompt è®¾è®¡æ˜¯åˆ° Ch4 æ‰ç»†åŒ–çš„ã€‚

### è¯¯åŒº 3ï¼šAI è¯´ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆ

AI ç»™çš„è§„åˆ’åŸºäºŽ"é€šç”¨æœ€ä½³å®žè·µ"ï¼Œä½†ä½ çš„é¡¹ç›®æœ‰è‡ªå·±çš„çº¦æŸã€‚æ¯”å¦‚ AI å¯èƒ½å»ºè®®ç”¨ asyncio åšå¹¶è¡Œï¼Œä½†è¿™é‡Œé€‰äº† Claude Code çš„ subagent å¹¶è¡Œâ€”â€”å› ä¸ºè¿™æ˜¯æ•™ç¨‹çš„æ•™å­¦ç›®æ ‡ã€‚**ä½ æ‰æ˜¯æœ€ç»ˆå†³ç­–è€…**ã€‚

### è¯¯åŒº 4ï¼šè·³è¿‡è§„åˆ’ç›´æŽ¥å†™ä»£ç 

"è¿™ä¸ªéœ€æ±‚å¾ˆç®€å•ï¼Œä¸ç”¨è§„åˆ’"â€”â€”è¿™å¥è¯æ˜¯ bug çš„æ¸©åºŠã€‚å“ªæ€•åªèŠ± 5 åˆ†é’Ÿè®© AI å¸®ä½ åˆ—ä¸€ä¸‹å®žæ–½æ­¥éª¤ï¼Œä¹Ÿæ¯”ç›´æŽ¥å¼€å¹²å¼ºã€‚è§„åˆ’çš„æˆæœ¬è¿œä½ŽäºŽè¿”å·¥çš„æˆæœ¬ã€‚

---

## 1.6 å°ç»“

è¿™ä¸€ç« çœ‹èµ·æ¥"æ²¡äº§å‡º"ï¼Œä½†åšçš„äº‹æœ€é‡è¦ï¼š**æƒ³æ¸…æ¥šå†åŠ¨æ‰‹**ã€‚

- Plan Agent çš„æ ¸å¿ƒä»·å€¼ä¸æ˜¯æ›¿ä½ åšå†³ç­–ï¼Œè€Œæ˜¯å¸®ä½ **æƒ³å¾—æ›´å…¨é¢**
- å¥½çš„è§„åˆ’ = æ˜Žç¡®çš„ç›®æ ‡ + æ¸…æ™°çš„æž¶æž„ + æœ‰åºçš„æ­¥éª¤ + è®°å½•åœ¨æ¡ˆçš„å†³ç­–
- ä¸è¦æ— è„‘æŽ¥å— AI çš„ç¬¬ä¸€ç‰ˆæ–¹æ¡ˆï¼Œè¿½é—®ç»†èŠ‚ã€åšå–èˆæ‰æ˜¯ä½ çš„å·¥ä½œ

---

# Ch2: æ­å»ºè„šæ‰‹æž¶ â€” CLAUDE.md + CLI ä¸€æ­¥åˆ°ä½

> å¥½çš„å¼€å§‹æ˜¯æˆåŠŸçš„ä¸€åŠã€‚å¥½çš„ CLAUDE.md èƒ½çœæŽ‰ä¸€åŠçš„åå¤çº æ­£ã€‚

**æœ¯è¯­**

- CLIï¼ˆCommand Line Interfaceï¼Œå‘½ä»¤è¡Œç•Œé¢ï¼‰
- Linterï¼ˆä»£ç é™æ€æ£€æŸ¥å·¥å…·ï¼‰
- Docstringï¼ˆæ–‡æ¡£å­—ç¬¦ä¸²ï¼ŒåµŒåœ¨ä»£ç ä¸­çš„è¯´æ˜Žæ–‡æœ¬ï¼‰
- Type Hintsï¼ˆç±»åž‹æç¤ºï¼ŒPython çš„é™æ€ç±»åž‹æ ‡æ³¨ï¼‰
- pyproject.tomlï¼ˆPython é¡¹ç›®é…ç½®æ–‡ä»¶ï¼ŒPEP 621 æ ‡å‡†ï¼‰

**æœ¬ç« æ–°æ¦‚å¿µ**

| æ¦‚å¿µ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------------|
| CLAUDE.md | AI æ¯æ¬¡éƒ½åœ¨çŒœä½ çš„åå¥½ï¼Œåå¤çº æ­£å¾ˆç´¯â€”â€”å†™ä¸€ä»½"å…¥èŒæ‰‹å†Œ"ï¼Œå¯åŠ¨å³ç”Ÿæ•ˆ |
| Sequential Workflow | å¤šä¸ªæ­¥éª¤æœ‰å…ˆåŽä¾èµ–â€”â€”æŒ‰é¡ºåºä¸²èµ·æ¥ï¼Œå‰ä¸€æ­¥çš„è¾“å‡ºå–‚ç»™ä¸‹ä¸€æ­¥ |

## 2.1 åœºæ™¯å¼•å…¥

ä½ æ–°æ‹›äº†ä¸€ä¸ªå®žä¹ ç”Ÿï¼Œç¬¬ä¸€å¤©ä¸Šç­ã€‚ä½ ä¼šæ€Žä¹ˆåšï¼Ÿ

è‚¯å®šä¸æ˜¯ç›´æŽ¥ç”©ä¸€å¥"åŽ»æŠŠä»£ç å†™äº†"ã€‚ä½ ä¼šç»™ä»–ä¸€ä»½å…¥èŒæ‰‹å†Œï¼šå…¬å¸ç”¨ä»€ä¹ˆæŠ€æœ¯æ ˆã€ä»£ç é£Žæ ¼æ˜¯ä»€ä¹ˆã€å“ªäº›äº‹æƒ…ç»å¯¹ä¸èƒ½åšã€é‡åˆ°é—®é¢˜æ‰¾è°ã€‚

CLAUDE.md å°±æ˜¯ä½ ç»™ Claude Code çš„"å…¥èŒæ‰‹å†Œ"ã€‚æ²¡æœ‰å®ƒï¼ŒClaude Code æ¯æ¬¡éƒ½åœ¨çŒœä½ çš„åå¥½ï¼›æœ‰äº†å®ƒï¼Œå®ƒä»Žç¬¬ä¸€è¡Œä»£ç å°±çŸ¥é“è¯¥æ€Žä¹ˆå†™ã€‚

---

## 2.2 è®¾è®¡æ€ç»´ï¼šCLAUDE.md çš„ä¸‰å±‚é…ç½®

Claude Code çš„é…ç½®æœ‰ä¸‰ä¸ªå±‚çº§ï¼Œä»Žå¤§åˆ°å°ï¼š

```
~/.claude/CLAUDE.md          â† å…¨å±€ï¼šä½ æ‰€æœ‰é¡¹ç›®çš„é€šç”¨åå¥½
é¡¹ç›®æ ¹ç›®å½•/CLAUDE.md          â† é¡¹ç›®çº§ï¼šè¿™ä¸ªé¡¹ç›®çš„è§„åˆ™
å­ç›®å½•/CLAUDE.md              â† ç›®å½•çº§ï¼šç‰¹å®šæ¨¡å—çš„è§„åˆ™
```

å°±åƒå…¬å¸åˆ¶åº¦ï¼šé›†å›¢æœ‰é›†å›¢çš„è§„ç« ï¼Œéƒ¨é—¨æœ‰éƒ¨é—¨çš„ç»†åˆ™ï¼Œå°ç»„æœ‰å°ç»„çš„çº¦å®šã€‚è¶Šå…·ä½“çš„å±‚çº§ä¼˜å…ˆçº§è¶Šé«˜ã€‚

### 2.2.1 è¯¥å†™ä»€ä¹ˆï¼Ÿ

ä¸€ä»½å¥½çš„ CLAUDE.md å›žç­”å››ä¸ªé—®é¢˜ï¼š

1. **è¿™ä¸ªé¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ**ï¼ˆæŠ€æœ¯æ ˆã€æž¶æž„æ¦‚è¿°ï¼‰
2. **ä»£ç æ€Žä¹ˆå†™ï¼Ÿ**ï¼ˆé£Žæ ¼ã€å‘½åã€æ ¼å¼ï¼‰
3. **ä»€ä¹ˆä¸èƒ½åšï¼Ÿ**ï¼ˆç¦æ­¢äº‹é¡¹ã€å®‰å…¨çº¢çº¿ï¼‰
4. **å¸¸ç”¨æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿ**ï¼ˆæµ‹è¯•å‘½ä»¤ã€æž„å»ºå‘½ä»¤ã€éƒ¨ç½²æµç¨‹ï¼‰

### 2.2.2 å¿«é€Ÿèµ·æ­¥ï¼š/init å‘½ä»¤

ä¸æƒ³ä»Žé›¶å†™ CLAUDE.mdï¼ŸClaude Code æä¾›äº† `/init` å‘½ä»¤ï¼Œè‡ªåŠ¨åˆ†æžä½ çš„é¡¹ç›®ç»“æž„å¹¶ç”Ÿæˆåˆç‰ˆé…ç½®ï¼š

```bash
cd ~/projects/review-bot
claude
# è¿›å…¥ Claude Code åŽè¾“å…¥ï¼š
/init
```

`/init` ä¼šæ‰«æç›®å½•ç»“æž„ã€è¯†åˆ«ç¼–ç¨‹è¯­è¨€ã€æ£€æµ‹æž„å»ºç³»ç»Ÿï¼Œç„¶åŽç”Ÿæˆä¸€ä»½ CLAUDE.mdã€‚é€šå¸¸ä¸¤åˆ†é’Ÿå°±èƒ½å¾—åˆ°ä¸€ä¸ªå¯ç”¨çš„èµ·ç‚¹ï¼Œç„¶åŽä½ å†æ ¹æ®é¡¹ç›®å®žé™…æƒ…å†µè°ƒæ•´ã€‚

> ðŸ’¡ **Tip**: `/init` ç”Ÿæˆçš„æ˜¯"é€šç”¨ç‰ˆ"ï¼Œé€‚åˆå¿«é€Ÿèµ·æ­¥ã€‚ä½†é¡¹ç›®ç‰¹æœ‰çš„è§„åˆ™ï¼ˆæ¯”å¦‚"ä¸è¦ç›´æŽ¥ commit åˆ° main"ï¼‰è¿˜æ˜¯éœ€è¦ä½ æ‰‹åŠ¨è¡¥å……ã€‚

### 2.2.3 CLAUDE.md å†™ä½œåæ¨¡å¼

å†™ CLAUDE.md ä¹Ÿæœ‰å‘ã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„é”™è¯¯å†™æ³•å’Œæ”¹è¿›å»ºè®®ï¼š

**âŒ å¤ªæ¨¡ç³Š**
```markdown
## Rules
- Write good code
- Follow best practices
```

**âœ… å…·ä½“å¯æ‰§è¡Œ**
```markdown
## Rules
- Use type hints on all function signatures
- Max line length: 88 (black default)
- All public functions must have Google-style docstrings
```

**âŒ å¤ªé•¿å¤ªæ‚**

æŠŠæ•´ä¸ªé¡¹ç›®çš„ API æ–‡æ¡£ã€æ•°æ®åº“ schemaã€éƒ¨ç½²æ‰‹å†Œå…¨å¡žè¿› CLAUDE.mdã€‚ç»“æžœæ–‡ä»¶ 2000 è¡Œï¼ŒClaude Code æ¯æ¬¡å¯åŠ¨éƒ½è¦è¯»ä¸€éï¼ŒæŒ¤å ä¸Šä¸‹æ–‡ç©ºé—´ã€‚

**âœ… ç²¾ç®€èšç„¦**

CLAUDE.md åªæ”¾"AI å†™ä»£ç æ—¶éœ€è¦çŸ¥é“çš„è§„åˆ™"ã€‚è¯¦ç»†æ–‡æ¡£æ”¾åœ¨åˆ«çš„åœ°æ–¹ï¼Œéœ€è¦æ—¶è®© AI åŽ»è¯»ã€‚

**âŒ åªæœ‰æ­£é¢è§„åˆ™ï¼Œæ²¡æœ‰è´Ÿé¢çº¦æŸ**
```markdown
## Style
- Use descriptive variable names
```

**âœ… æ­£åéƒ½æœ‰**
```markdown
## Style
- Use descriptive variable names
- NEVER use single-letter variables except in list comprehensions
- NEVER use `print()` for logging, use the `logging` module
```

Claude Code å¯¹ "NEVER" å¼€å¤´çš„è§„åˆ™ç‰¹åˆ«æ•æ„Ÿï¼Œéµå®ˆçŽ‡å¾ˆé«˜ã€‚

---

## 2.3 å®žæ“å¤çŽ°ï¼šæ­å»º Review Bot è„šæ‰‹æž¶

### Step 1: åˆ›å»º CLAUDE.md

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `CLAUDE.md`ï¼š

```markdown
# Review Bot â€” Code Review Automator

## Project Overview
A CLI tool that analyzes local git diffs of C/C++ projects and runs parallel
code reviews using multiple specialized agents. Built with Python and typer.

## Tech Stack
- Python 3.10+
- typer (CLI framework)
- subprocess (git operations)

## Code Style
- Use type hints everywhere
- Docstrings: Google style
- Max line length: 88 (black default)
- Import order: stdlib â†’ third-party â†’ local (isort)

## Architecture
- Python ä»£ç  = å·¥å…·å±‚ï¼ˆdiff è§£æžã€æŠ¥å‘Šç”Ÿæˆï¼‰
- `.claude/skills/review-bot/SKILL.md` = ç¼–æŽ’å±‚ï¼ˆé€šè¿‡ Claude Code Task tool è°ƒåº¦ï¼‰
- `.claude/agents/*.md` = Agent å®šä¹‰ï¼ˆæ¯ä¸ª agent çš„è§’è‰²å’Œ promptï¼‰

## Project Structure
review_bot/
â”œâ”€â”€ cli.py           # CLI entry point (diff/report subcommands)
â”œâ”€â”€ diff_parser.py   # Git diff parsing
â”œâ”€â”€ scheduler.py     # Result aggregation utilities
â”œâ”€â”€ reporter.py      # Report generation
â””â”€â”€ agents/
    â”œâ”€â”€ base.py      # Base agent definition
    â””â”€â”€ registry.py  # Agent registry

## Commands
- Diff: `review-bot diff [TARGET] [--repo PATH]`
- Skill: `/review-bot HEAD~3` or `/review-bot HEAD~5 --repo /path/to/repo`
- Test: `pytest tests/ -x -q`
- Lint: `ruff check .`
- Format: `black .`

## Rules
- NEVER commit directly to main
- NEVER hardcode file paths
- Always handle subprocess errors gracefully
- Keep each module under 200 lines
```

> ðŸ’¡ **Tip**: CLAUDE.md é‡Œçš„ Rules éƒ¨åˆ†ç‰¹åˆ«é‡è¦ã€‚Claude Code ä¼šä¸¥æ ¼éµå®ˆè¿™äº›è§„åˆ™ã€‚å¦‚æžœä½ å‘çŽ°å®ƒæ€»æ˜¯çŠ¯åŒä¸€ä¸ªé”™è¯¯ï¼ŒæŠŠ"ä¸è¦åš XXX"å†™è¿› Rulesï¼Œç«‹ç«¿è§å½±ã€‚

### Step 2: ç”¨ Claude Code æ­å»º CLI æ¡†æž¶

çŽ°åœ¨è®© Claude Code æ¥å¹²æ´»ã€‚åœ¨é¡¹ç›®ç›®å½•ä¸­å¯åŠ¨ Claude Codeï¼š

```bash
cd ~/projects/review-bot
claude
```

è¾“å…¥ï¼š

```
è¯·æ ¹æ® CLAUDE.md çš„é¡¹ç›®ç»“æž„ï¼Œå¸®æˆ‘æ­å»ºåŸºç¡€çš„ CLI æ¡†æž¶ã€‚
éœ€è¦ï¼š
1. pyproject.tomlï¼ˆç”¨ setuptoolsï¼‰
2. review_bot/cli.py â€” ç”¨ typerï¼ŒåŒ…å«ä¸€ä¸ª review å‘½ä»¤
3. review_bot/__init__.py
4. ä¸€ä¸ªèƒ½è·‘é€šçš„æœ€å°å®žçŽ°
```

Claude Code ä¼šè¯»å– CLAUDE.mdï¼Œç„¶åŽæŒ‰ç…§é‡Œé¢çš„è§„èŒƒç”Ÿæˆä»£ç ã€‚ä½ åº”è¯¥ä¼šå¾—åˆ°ç±»ä¼¼è¿™æ ·çš„ç»“æžœï¼š

**pyproject.toml**:

```toml
[build-system]
requires = ["setuptools>=68.0"]
build-backend = "setuptools.build_meta"

[project]
name = "review-bot"
version = "0.1.0"
requires-python = ">=3.10"
dependencies = [
    "typer>=0.9.0",
]

[project.scripts]
review-bot = "review_bot.cli:app"
```

**review_bot/diff_parser.py**ï¼ˆå ä½ stubï¼ŒCh3 ä¼šæ›¿æ¢ä¸ºå®Œæ•´å®žçŽ°ï¼‰:

```python
"""Git diff parser â€” stub for CLI scaffolding."""
import subprocess
from dataclasses import dataclass, field


@dataclass
class FileChange:
    """Represents changes to a single file."""
    path: str
    added_lines: list[str] = field(default_factory=list)
    removed_lines: list[str] = field(default_factory=list)


@dataclass
class DiffResult:
    """Parsed diff containing all file changes."""
    files: list[FileChange] = field(default_factory=list)

    @property
    def summary(self) -> str:
        return f"{len(self.files)} files changed"


def get_diff(target: str = "HEAD~1", repo: str | None = None) -> str:
    """Run git diff and return raw output."""
    cmd = ["git", "diff", target]
    result = subprocess.run(cmd, capture_output=True, text=True, cwd=repo)
    if result.returncode != 0:
        raise RuntimeError(f"git diff failed: {result.stderr}")
    return result.stdout


def parse_diff(raw_diff: str) -> DiffResult:
    """Parse unified diff into structured data (minimal stub)."""
    result = DiffResult()
    for line in raw_diff.splitlines():
        if line.startswith("diff --git"):
            path = line.split(" b/")[-1]
            result.files.append(FileChange(path=path))
    return result
```

**review_bot/cli.py**:

```python
"""CLI entry point for Review Bot â€” utility layer for Claude Code skills."""
import typer

from .diff_parser import get_diff, parse_diff

app = typer.Typer(
    name="review-bot",
    help="Code review utilities â€” use /review-bot skill for full orchestration.",
)


@app.command()
def diff(
    target: str = typer.Argument("HEAD~1", help="Git diff target (e.g., HEAD~1, main)"),
    repo: str = typer.Option(None, help="Path to git repository (default: cwd)"),
) -> None:
    """Parse git diff and print structured summary."""
    raw_diff = get_diff(target, repo=repo)
    result = parse_diff(raw_diff)
    typer.echo(result.summary)
    typer.echo("---")
    typer.echo(raw_diff)


if __name__ == "__main__":
    app()
```

æ³¨æ„å‡ ä¸ªç»†èŠ‚ï¼š
- ç”¨äº† type hintsï¼ˆ`str`ã€`-> None`ï¼‰ï¼Œå› ä¸º CLAUDE.md é‡Œè¦æ±‚äº†
- docstring ç”¨ Google styleï¼Œä¹Ÿæ˜¯ CLAUDE.md çš„è§„èŒƒ
- CLI å®šä½ä¸º**å·¥å…·å±‚**â€”â€”åªåš diff è§£æžå’ŒæŠ¥å‘Šç”Ÿæˆï¼Œä¸åš LLM ç¼–æŽ’ã€‚ç¼–æŽ’ç”± `/review-bot` skill é€šè¿‡ Claude Code çš„ Task tool å®Œæˆ
- `repo` å‚æ•°æ”¯æŒä»Žä»»æ„ç›®å½•å®¡æŸ¥è¿œç¨‹ä»“åº“

### Step 3: éªŒè¯è„šæ‰‹æž¶

```bash
# Install in development mode
pip install -e .

# Test the CLI
review-bot --help
review-bot HEAD~3
review-bot HEAD~3 --repo /path/to/other/repo
```

å¦‚æžœçœ‹åˆ° diff æ‘˜è¦å’ŒåŽŸå§‹ diff è¾“å‡ºï¼Œè¯´æ˜Žè„šæ‰‹æž¶æ­å¥½äº†ã€‚

> âš ï¸ **æ³¨æ„ typer çš„å•å‘½ä»¤è¡Œä¸º**: å½“å‰åªæœ‰ä¸€ä¸ª `diff` å‘½ä»¤ï¼Œtyper ä¼šè‡ªåŠ¨å°†å®ƒæå‡ä¸ºä¸»å‘½ä»¤ã€‚æ‰€ä»¥ç”¨æ³•æ˜¯ `review-bot HEAD~3` è€Œä¸æ˜¯ `review-bot diff HEAD~3`ã€‚ç­‰ Ch6 æ·»åŠ  `report` å­å‘½ä»¤åŽï¼Œtyper åˆ‡æ¢ä¸ºå¤šå‘½ä»¤æ¨¡å¼ï¼Œå±Šæ—¶éœ€è¦æ”¹ç”¨ `review-bot diff HEAD~3`ã€‚

---

## 2.4 è®¾è®¡æ€ç»´ï¼šé¡ºåºå·¥ä½œæµï¼ˆSequential Workflowï¼‰

æ­è„šæ‰‹æž¶çš„è¿‡ç¨‹ï¼Œå…¶å®žå°±æ˜¯ä¸€ä¸ª**é¡ºåºå·¥ä½œæµ**ï¼š

```
åˆ›å»º CLAUDE.md â†’ ç”Ÿæˆé¡¹ç›®ç»“æž„ â†’ å†™ CLI å…¥å£ â†’ å®‰è£…ä¾èµ– â†’ éªŒè¯
```

æ¯ä¸€æ­¥éƒ½ä¾èµ–å‰ä¸€æ­¥çš„ç»“æžœã€‚è¿™æ˜¯æœ€ç®€å•çš„ç¼–æŽ’æ¨¡å¼ï¼Œä¹Ÿæ˜¯æ‰€æœ‰å¤æ‚æ¨¡å¼çš„åŸºç¡€ã€‚

åœ¨ Claude Code ä¸­ï¼Œé¡ºåºå·¥ä½œæµå°±æ˜¯ä½ å’Œ AI çš„ä¸€é—®ä¸€ç­”ï¼šä½ ç»™æŒ‡ä»¤ï¼Œå®ƒæ‰§è¡Œï¼Œä½ éªŒè¯ï¼Œå†ç»™ä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€‚æ²¡æœ‰å¹¶è¡Œï¼Œæ²¡æœ‰åˆ†æ”¯ï¼Œå°±æ˜¯ä¸€æ¡ç›´çº¿èµ°åˆ°åº•ã€‚

ä»€ä¹ˆæ—¶å€™ç”¨é¡ºåºå·¥ä½œæµï¼Ÿ
- æ­¥éª¤ä¹‹é—´æœ‰ä¸¥æ ¼ä¾èµ–ï¼ˆä¸è£…ä¾èµ–å°±æ²¡æ³•è·‘æµ‹è¯•ï¼‰
- ä»»åŠ¡æœ¬èº«ä¸å¤æ‚ï¼Œä¸éœ€è¦æ‹†åˆ†
- ä½ éœ€è¦åœ¨æ¯ä¸€æ­¥ä¹‹åŽäººå·¥ç¡®è®¤

---

## 2.5 è®¾è®¡æ€ç»´ï¼šä¸Šä¸‹æ–‡ç®¡ç† â€” ä½ æœ€å®è´µçš„èµ„æº

Claude Code çš„ä¸Šä¸‹æ–‡çª—å£æ˜¯ä½ æœ€å®è´µçš„èµ„æºã€‚**ä¸Šä¸‹æ–‡è¶Šæ»¡ï¼Œæ€§èƒ½è¶Šå·®**â€”â€”è¿™æ˜¯å®˜æ–¹æ–‡æ¡£åå¤å¼ºè°ƒçš„æ ¸å¿ƒåŽŸåˆ™ã€‚

### 2.5.1 ä¸‰ä¸ªå…³é”®å‘½ä»¤

| å‘½ä»¤ | ä½œç”¨ | ä»€ä¹ˆæ—¶å€™ç”¨ |
|------|------|-----------|
| `/clear` | æ¸…ç©ºå½“å‰å¯¹è¯ï¼Œé‡æ–°å¼€å§‹ | åˆ‡æ¢åˆ°ä¸ç›¸å…³çš„ä»»åŠ¡æ—¶ |
| `/compact` | åŽ‹ç¼©å¯¹è¯åŽ†å²ï¼Œä¿ç•™å…³é”®ä¿¡æ¯ | ä¸Šä¸‹æ–‡å¿«æ»¡æ—¶ï¼ˆè¶…è¿‡ 128Kï¼‰ |
| `/rewind` | å›žé€€åˆ°ä¹‹å‰çš„å¯¹è¯çŠ¶æ€ | å‘çŽ°èµ°é”™æ–¹å‘ï¼Œæƒ³å›žåˆ°æŸä¸ªèŠ‚ç‚¹ |

### 2.5.2 é¿å… "Kitchen Sink Session"

æœ€å¸¸è§çš„ä¸Šä¸‹æ–‡æµªè´¹æ¨¡å¼ï¼šåœ¨åŒä¸€ä¸ªä¼šè¯é‡Œåšä¸€å †ä¸ç›¸å…³çš„äº‹ã€‚

```
âŒ ä¸€ä¸ªä¼šè¯é‡Œï¼šæ­è„šæ‰‹æž¶ â†’ è°ƒè¯• CSS â†’ å†™æ–‡æ¡£ â†’ æŸ¥ API â†’ æ”¹é…ç½®
âœ… æ¯ä¸ªç‹¬ç«‹ä»»åŠ¡ä¸€ä¸ªä¼šè¯ï¼šæ­è„šæ‰‹æž¶ â†’ /clear â†’ å†™æ–‡æ¡£ â†’ /clear â†’ æ”¹é…ç½®
```

### 2.5.3 Subagent æ˜¯ä¸Šä¸‹æ–‡çš„"é˜²ç«å¢™"

è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ subagent çš„ä¸Šä¸‹æ–‡éš”ç¦»é‚£ä¹ˆé‡è¦ï¼ˆCh3 å’Œ Ch5 ä¼šè¯¦ç»†è®²ï¼‰ã€‚Explore Agent åŽ»ç¿»äº† 100 ä¸ªæ–‡ä»¶ï¼Œè¿™äº›å†…å®¹ä¸ä¼šå‡ºçŽ°åœ¨ä¸» agent çš„ä¸Šä¸‹æ–‡é‡Œâ€”â€”ä¸» agent åªæ”¶åˆ°æœ€ç»ˆç»“è®ºã€‚

> ðŸ’¡ **Tip**: å…»æˆä¹ æƒ¯â€”â€”æ¯å®Œæˆä¸€ä¸ªé˜¶æ®µæ€§ä»»åŠ¡ï¼Œè€ƒè™‘æ˜¯å¦éœ€è¦ `/clear` æˆ– `/compact`ã€‚ä¸Šä¸‹æ–‡ç®¡ç†ä¸æ˜¯é«˜çº§æŠ€å·§ï¼Œè€Œæ˜¯æ—¥å¸¸å«ç”Ÿã€‚

---

## 2.6 æç‚¼æ¨¡æ¿ï¼šCLAUDE.md é…ç½®æ¨¡æ¿

```markdown
# [é¡¹ç›®åç§°]

## Project Overview
[ä¸€å¥è¯æè¿°é¡¹ç›®åšä»€ä¹ˆ]

## Tech Stack
- [è¯­è¨€å’Œç‰ˆæœ¬]
- [æ ¸å¿ƒä¾èµ–]

## Architecture
- [ä»£ç å±‚èŒè´£è¯´æ˜Ž]
- [ç¼–æŽ’å±‚èŒè´£è¯´æ˜Ž]

## Code Style
- [ç±»åž‹æ ‡æ³¨è¦æ±‚]
- [æ–‡æ¡£å­—ç¬¦ä¸²é£Žæ ¼]
- [æ ¼å¼åŒ–å·¥å…·å’Œé…ç½®]

## Project Structure
[ç›®å½•æ ‘]

## Commands
- Run: [å¯åŠ¨å‘½ä»¤]
- Test: [æµ‹è¯•å‘½ä»¤]
- Lint: [æ£€æŸ¥å‘½ä»¤]

## Rules
- [ç»å¯¹ä¸èƒ½åšçš„äº‹]
- [å¿…é¡»éµå®ˆçš„çº¦å®š]

## Testing Rules
- [æµ‹è¯•æ‰§è¡Œå‘½ä»¤]
- [æäº¤å‰å¿…é¡»é€šè¿‡æµ‹è¯•]
- [æ–°åŠŸèƒ½å¿…é¡»åŒ…å«æµ‹è¯•]
```

### 2.6.1 é¡ºåºå·¥ä½œæµæ¨¡æ¿

```
Step 1: [å‰ç½®å‡†å¤‡] â†’ éªŒè¯ âœ“
Step 2: [æ ¸å¿ƒæ“ä½œ] â†’ éªŒè¯ âœ“
Step 3: [åŽç»­å¤„ç†] â†’ éªŒè¯ âœ“
```

æ¯ä¸€æ­¥éƒ½æœ‰æ˜Žç¡®çš„è¾“å…¥ã€è¾“å‡ºå’ŒéªŒè¯æ¡ä»¶ã€‚ç®€å•ä½†å¯é ã€‚

---

## 2.7 å°ç»“

- CLAUDE.md æ˜¯ä½ å’Œ AI ä¹‹é—´çš„"å¥‘çº¦"ï¼Œå†™å¾—è¶Šæ¸…æ¥šï¼ŒAI è¶Šé è°±
- ä¸‰å±‚é…ç½®ï¼ˆå…¨å±€ â†’ é¡¹ç›® â†’ ç›®å½•ï¼‰è®©ä½ èƒ½ç²¾ç»†æŽ§åˆ¶ä¸åŒåœºæ™¯
- ä¸Šä¸‹æ–‡çª—å£æ˜¯æœ€å®è´µçš„èµ„æºâ€”â€”ç”¨ `/clear`ã€`/compact`ã€`/rewind` ä¸»åŠ¨ç®¡ç†
- é¡ºåºå·¥ä½œæµæ˜¯æœ€åŸºç¡€çš„ç¼–æŽ’æ¨¡å¼ï¼šä¸€æ­¥æŽ¥ä¸€æ­¥ï¼Œæ¯æ­¥éªŒè¯

---

# Ch3: è§£æž Git Diff â€” ç”¨ Explore Agent è¯»æ‡‚å˜æ›´

> å®¡æŸ¥ä»£ç çš„ç¬¬ä¸€æ­¥ä¸æ˜¯"æ‰¾ bug"ï¼Œè€Œæ˜¯"ç†è§£å˜æ›´"ã€‚

**æœ¯è¯­**

- Diffï¼ˆå·®å¼‚ï¼Œä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å˜æ›´å†…å®¹ï¼‰
- Unified Diffï¼ˆç»Ÿä¸€å·®å¼‚æ ¼å¼ï¼Œ`git diff` çš„æ ‡å‡†è¾“å‡ºæ ¼å¼ï¼‰
- Explore Agentï¼ˆæŽ¢ç´¢ä»£ç†ï¼ŒClaude Code çš„åªè¯»ä»£ç æŽ¢ç´¢ subagentï¼‰
- Dataclassï¼ˆPython æ•°æ®ç±»ï¼‰
- Subprocessï¼ˆå­è¿›ç¨‹ï¼ŒPython ä¸­è°ƒç”¨å¤–éƒ¨å‘½ä»¤çš„æ¨¡å—ï¼‰

**æœ¬ç« æ–°æ¦‚å¿µ**

| æ¦‚å¿µ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------------|
| Explore Agent | æƒ³è®© AI åˆ†æžä»£ç ä½†æ€•å®ƒæ‰‹ç—’æ”¹åä¸œè¥¿â€”â€”åªè¯»æ¨¡å¼ï¼Œåªçœ‹ä¸åŠ¨ |

## 3.1 åœºæ™¯å¼•å…¥

ä½ æ‰“å¼€ä¸€ä¸ª PRï¼Œé‡Œé¢æ”¹äº† 47 ä¸ªæ–‡ä»¶ã€1200 è¡Œä»£ç ã€‚ä½ çš„ç¬¬ä¸€ååº”æ˜¯ä»€ä¹ˆï¼Ÿ

å¤§å¤šæ•°äººä¼šä»Žç¬¬ä¸€ä¸ªæ–‡ä»¶å¼€å§‹é€è¡Œçœ‹ã€‚çœ‹åˆ°ç¬¬ 10 ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå‰é¢çœ‹çš„å·²ç»å¿˜äº†ä¸€åŠã€‚

æ›´èªæ˜Žçš„åšæ³•ï¼šå…ˆé¸Ÿçž°å…¨å±€â€”â€”æ”¹äº†å“ªäº›æ¨¡å—ï¼Ÿæ˜¯æ–°åŠŸèƒ½è¿˜æ˜¯ bug fixï¼Ÿå½±å“èŒƒå›´æœ‰å¤šå¤§ï¼Ÿç„¶åŽå†å†³å®šé‡ç‚¹çœ‹å“ªé‡Œã€‚

è¿™ä¸€ç« ç»™ Review Bot åŠ ä¸Š"ç†è§£å˜æ›´"çš„èƒ½åŠ›ï¼ŒåŒæ—¶å­¦ä¹  Claude Code çš„ **Explore Agent**ã€‚

---

## 3.2 è®¾è®¡æ€ç»´ï¼šExplore Agent æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ Claude Code ä¸­ï¼ŒExplore Agent æ˜¯ä¸€ç§ä¸“é—¨ç”¨æ¥**æŽ¢ç´¢ä»£ç åº“**çš„ subagentã€‚å®ƒçš„ç‰¹ç‚¹ï¼š

- åªè¯»ä¸å†™ï¼šåªèƒ½çœ‹ä»£ç ï¼Œä¸èƒ½æ”¹ä»£ç 
- ä¸Šä¸‹æ–‡éš”ç¦»ï¼šå®ƒæŽ¢ç´¢è¿‡ç¨‹ä¸­è¯»çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸ä¼šå ç”¨ä¸» agent çš„ä¸Šä¸‹æ–‡
- é€Ÿåº¦å¿«ï¼šä¸“é—¨ä¼˜åŒ–è¿‡ï¼Œæ¯”è®©ä¸» agent è‡ªå·±åŽ»ç¿»æ–‡ä»¶å¿«å¾—å¤š

æ‰“ä¸ªæ¯”æ–¹ï¼šä½ è¦è£…ä¿®æˆ¿å­ï¼Œä¸ä¼šè‡ªå·±æ‹¿ç€å·å°ºæ¯ä¸ªæˆ¿é—´é‡ä¸€éã€‚ä½ ä¼šæ´¾ä¸€ä¸ªäººåŽ»é‡ï¼Œé‡å®ŒæŠŠæ•°æ®å¸¦å›žæ¥ç»™ä½ ã€‚Explore Agent å°±æ˜¯é‚£ä¸ªæ‹¿å·å°ºçš„äººã€‚

### 3.2.1 Explore Agent çš„å·¥å…·ç®±

Explore Agent ä¸æ˜¯ç©ºæ‰‹åŽ»æŽ¢ç´¢çš„ï¼Œå®ƒæœ‰ä¸€å¥—ä¸“ç”¨å·¥å…·ï¼š

| å·¥å…· | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| Glob | æŒ‰æ¨¡å¼åŒ¹é…æ–‡ä»¶è·¯å¾„ | `**/*.py` æ‰¾æ‰€æœ‰ Python æ–‡ä»¶ |
| Grep | åœ¨æ–‡ä»¶å†…å®¹ä¸­æœç´¢ | æœç´¢ `def parse_diff` æ‰¾åˆ°å‡½æ•°å®šä¹‰ |
| Read | è¯»å–æ–‡ä»¶å†…å®¹ | è¯»å– `cli.py` ç†è§£å…¥å£é€»è¾‘ |
| WebFetch | èŽ·å–ç½‘é¡µå†…å®¹ | æŸ¥é˜…å¤–éƒ¨æ–‡æ¡£ |
| WebSearch | æœç´¢ç½‘é¡µ | æœç´¢æŠ€æœ¯æ–¹æ¡ˆ |

æ³¨æ„ï¼šExplore Agent **æ²¡æœ‰** Editã€Writeã€Bash è¿™äº›èƒ½ä¿®æ”¹æ–‡ä»¶æˆ–æ‰§è¡Œå‘½ä»¤çš„å·¥å…·ã€‚è¿™æ˜¯"åªè¯»"çº¦æŸçš„ç¡¬æ€§ä¿è¯ã€‚

### 3.2.2 ä»€ä¹ˆæ—¶å€™ç”¨ Explore Agentï¼Ÿ

- ä½ éœ€è¦äº†è§£ä¸€ä¸ªä¸ç†Ÿæ‚‰çš„ä»£ç åº“çš„ç»“æž„
- ä½ æƒ³çŸ¥é“æŸä¸ªå‡½æ•°åœ¨å“ªé‡Œè¢«è°ƒç”¨
- ä½ éœ€è¦åˆ†æžå˜æ›´å½±å“äº†å“ªäº›æ¨¡å—
- ä»»ä½•"å…ˆçœ‹çœ‹å†è¯´"çš„åœºæ™¯

### 3.2.3 ä»€ä¹ˆæ—¶å€™ä¸è¯¥ç”¨ï¼Ÿ

- ç®€å•çš„æ–‡ä»¶æŸ¥æ‰¾ï¼ˆç›´æŽ¥ç”¨ Glob æ›´å¿«ï¼‰
- ä½ å·²ç»çŸ¥é“è¦çœ‹å“ªä¸ªæ–‡ä»¶ï¼ˆç›´æŽ¥ç”¨ Readï¼‰
- éœ€è¦æ‰§è¡Œå‘½ä»¤æ‰èƒ½èŽ·å–ä¿¡æ¯ï¼ˆç”¨ Bash agentï¼‰

> ðŸ’¡ **Tip**: Explore Agent é€‚åˆ"å¼€æ”¾å¼æŽ¢ç´¢"â€”â€”ä½ ä¸ç¡®å®šç­”æ¡ˆåœ¨å“ªé‡Œï¼Œéœ€è¦ AI è‡ªå·±åŽ»ç¿»ã€‚å¦‚æžœä½ å·²ç»çŸ¥é“ç›®æ ‡æ–‡ä»¶ï¼Œç›´æŽ¥è¯»å–æ¯”æ´¾ Explore Agent æ›´å¿«ã€‚

### 3.2.4 åœ¨ Claude Code ä¸­æ€Žä¹ˆè§¦å‘ï¼Ÿ

ä½ ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º Explore Agentã€‚å½“ä½ è®© Claude Code åšæŽ¢ç´¢æ€§ä»»åŠ¡æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä½¿ç”¨ Task tool æ´¾å‡º Explore subagentï¼š

```
å¸®æˆ‘çœ‹çœ‹è¿™ä¸ªé¡¹ç›®çš„ç›®å½•ç»“æž„å’Œæ ¸å¿ƒæ¨¡å—æ˜¯æ€Žä¹ˆç»„ç»‡çš„ã€‚
```

Claude Code å†…éƒ¨ä¼šè¿™æ ·åšï¼š

```
Task(subagent_type="Explore", prompt="åˆ†æžé¡¹ç›®ç›®å½•ç»“æž„å’Œæ ¸å¿ƒæ¨¡å—ç»„ç»‡æ–¹å¼...")
```

Explore Agent ä¼šç”¨ Globã€Grepã€Read ç­‰å·¥å…·å¿«é€Ÿæ‰«æä»£ç åº“ï¼Œç„¶åŽæŠŠç»“è®ºå¸¦å›žæ¥ã€‚ä¸» agent åªæ”¶åˆ°æœ€ç»ˆç»“è®ºï¼Œä¸ä¼šè¢«æŽ¢ç´¢è¿‡ç¨‹ä¸­è¯»å–çš„å¤§é‡æ–‡ä»¶å†…å®¹æ’‘æ»¡ä¸Šä¸‹æ–‡çª—å£ã€‚

---

## 3.3 å®žæ“å¤çŽ°ï¼šå®žçŽ° Git Diff è§£æž

### Step 1: ç†è§£ git diff çš„è¾“å‡ºæ ¼å¼

å…ˆçœ‹çœ‹ `git diff` åˆ°åº•è¾“å‡ºä»€ä¹ˆï¼š

```bash
git diff HEAD~1
```

è¾“å‡ºçš„ unified diff æ ¼å¼é•¿è¿™æ ·ï¼š

```diff
diff --git a/review_bot/cli.py b/review_bot/cli.py
index abc1234..def5678 100644
--- a/review_bot/cli.py
+++ b/review_bot/cli.py
@@ -10,6 +10,8 @@ app = typer.Typer(
 )

+import subprocess
+
 @app.command()
 def review(
```

å…³é”®ä¿¡æ¯ï¼š
- `diff --git a/... b/...` â€” å“ªä¸ªæ–‡ä»¶å˜äº†
- `@@ -10,6 +10,8 @@` â€” å˜æ›´çš„ä½ç½®ï¼ˆç¬¬ 10 è¡Œå¼€å§‹ï¼ŒåŽŸæ¥ 6 è¡Œï¼ŒçŽ°åœ¨ 8 è¡Œï¼‰
- `+` å¼€å¤´ â€” æ–°å¢žçš„è¡Œ
- `-` å¼€å¤´ â€” åˆ é™¤çš„è¡Œ

### Step 2: è®© Claude Code å®žçŽ° diff è§£æžå™¨

åœ¨ Claude Code ä¸­è¾“å…¥ï¼š

```
å¸®æˆ‘å®žçŽ° review_bot/diff_parser.pyã€‚
éœ€æ±‚ï¼š
1. è°ƒç”¨ git diff èŽ·å–å˜æ›´
2. è§£æž unified diff æ ¼å¼
3. è¿”å›žç»“æž„åŒ–æ•°æ®ï¼šæ¯ä¸ªæ–‡ä»¶çš„å˜æ›´å†…å®¹ã€æ–°å¢žè¡Œæ•°ã€åˆ é™¤è¡Œæ•°
4. ç”¨ dataclass å®šä¹‰æ•°æ®ç»“æž„
```

ä½ åº”è¯¥å¾—åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š

**review_bot/diff_parser.py**:

```python
"""Git diff parser â€” turns raw diff into structured data."""
import subprocess
from dataclasses import dataclass, field


@dataclass
class FileChange:
    """Represents changes to a single file."""

    path: str
    added_lines: list[str] = field(default_factory=list)
    removed_lines: list[str] = field(default_factory=list)

    @property
    def additions(self) -> int:
        return len(self.added_lines)

    @property
    def deletions(self) -> int:
        return len(self.removed_lines)
```

æŽ¥ä¸‹æ¥æ˜¯æ ¸å¿ƒçš„è§£æžé€»è¾‘ï¼š

```python
@dataclass
class DiffResult:
    """Parsed diff containing all file changes."""

    files: list[FileChange] = field(default_factory=list)

    @property
    def total_additions(self) -> int:
        return sum(f.additions for f in self.files)

    @property
    def total_deletions(self) -> int:
        return sum(f.deletions for f in self.files)

    @property
    def summary(self) -> str:
        return (
            f"{len(self.files)} files changed, "
            f"{self.total_additions} additions, "
            f"{self.total_deletions} deletions"
        )
```

ç„¶åŽæ˜¯èŽ·å–å’Œè§£æž diff çš„å‡½æ•°ï¼š

```python
def get_diff(target: str = "HEAD~1", repo: str | None = None) -> str:
    """Run git diff and return raw output.

    Args:
        target: Git diff target (e.g., HEAD~1, main, abc1234).
        repo: Path to the git repository. Uses cwd if None.
    """
    cmd = ["git", "diff", target]
    result = subprocess.run(
        cmd,
        capture_output=True,
        text=True,
        cwd=repo,
    )
    if result.returncode != 0:
        raise RuntimeError(f"git diff failed: {result.stderr}")
    return result.stdout


def parse_diff(raw_diff: str) -> DiffResult:
    """Parse unified diff into structured data."""
    result = DiffResult()
    current_file: FileChange | None = None

    for line in raw_diff.splitlines():
        if line.startswith("diff --git"):
            # Extract file path: "diff --git a/foo.py b/foo.py"
            path = line.split(" b/")[-1]
            current_file = FileChange(path=path)
            result.files.append(current_file)
        elif current_file and line.startswith("+") and not line.startswith("+++"):
            current_file.added_lines.append(line[1:])
        elif current_file and line.startswith("-") and not line.startswith("---"):
            current_file.removed_lines.append(line[1:])

    return result
```

> ðŸ’¡ **ä¸ºä»€ä¹ˆç”¨ dataclassï¼Ÿ** æ¯”èµ·è¿”å›ž dictï¼Œdataclass æœ‰ç±»åž‹æç¤ºã€è‡ªåŠ¨ç”Ÿæˆ `__repr__`ï¼Œè¿˜èƒ½åŠ  property åšè®¡ç®—å±žæ€§ã€‚åŽé¢ agent æ‹¿åˆ°è¿™ä¸ªæ•°æ®ç»“æž„ï¼Œç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚

### 3.3.3 è¾¹ç•Œæƒ…å†µï¼šçœŸå®žä¸–ç•Œçš„ diff æ²¡é‚£ä¹ˆå¹²å‡€

ä¸Šé¢çš„è§£æžå™¨èƒ½å¤„ç†æœ€å¸¸è§çš„æƒ…å†µï¼Œä½†çœŸå®žé¡¹ç›®ä¸­ä½ ä¼šé‡åˆ°è¿™äº›è¾¹ç•Œï¼š

| æƒ…å†µ | diff ä¸­çš„è¡¨çŽ° | å¤„ç†ç­–ç•¥ |
|------|-------------|---------|
| äºŒè¿›åˆ¶æ–‡ä»¶ | `Binary files a/logo.png and b/logo.png differ` | è·³è¿‡ï¼Œè®°å½•æ–‡ä»¶å |
| æ–‡ä»¶é‡å‘½å | `rename from old.py` / `rename to new.py` | è®°å½•æ–°æ—§è·¯å¾„ |
| æ–°å¢žæ–‡ä»¶ | `--- /dev/null` | `deletions = 0` |
| åˆ é™¤æ–‡ä»¶ | `+++ /dev/null` | `additions = 0` |
| ç©º diff | ç©ºå­—ç¬¦ä¸² | è¿”å›žç©º `DiffResult` |
| æ–‡ä»¶è·¯å¾„å«ç©ºæ ¼ | `diff --git a/my file.py b/my file.py` | ç”¨ `b/` åˆ†å‰²è€Œéžç©ºæ ¼ |

è§£æžå™¨å·²ç»å¤„ç†äº†ç©º diff å’ŒåŸºæœ¬çš„å¢žåˆ ã€‚å…¶ä»–è¾¹ç•Œæƒ…å†µå¯ä»¥åŽç»­æŒ‰éœ€æ·»åŠ â€”â€”å…ˆè®©æ ¸å¿ƒæµç¨‹è·‘é€šï¼Œå†é€æ­¥å®Œå–„ã€‚è¿™ä¹Ÿæ˜¯ Ch1 ä¸­"æ¸è¿›å¼è§„åˆ’"æ€æƒ³çš„ä½“çŽ°ã€‚

> âš ï¸ **è¸©å‘æé†’**: ä¸è¦è¯•å›¾ä¸€å¼€å§‹å°±å¤„ç†æ‰€æœ‰è¾¹ç•Œæƒ…å†µã€‚å…ˆè¦†ç›– 80% çš„å¸¸è§åœºæ™¯ï¼Œç­‰æµ‹è¯•ï¼ˆCh8ï¼‰æš´éœ²å‡ºé—®é¢˜å†è¡¥ã€‚è¿‡æ—©ä¼˜åŒ–è¾¹ç•Œå¤„ç†æ˜¯æµªè´¹æ—¶é—´ã€‚

### Step 3: æŽ¥å…¥ CLI

æ›´æ–° `cli.py`ï¼ŒæŠŠ diff è§£æžæŽ¥è¿›åŽ»ï¼š

```python
from review_bot.diff_parser import get_diff, parse_diff

@app.command()
def diff(
    target: str = typer.Argument("HEAD~1", help="Git diff target"),
    repo: str = typer.Option(None, help="Path to git repository (default: cwd)"),
) -> None:
    """Parse git diff and print structured summary."""
    raw_diff = get_diff(target, repo=repo)
    result = parse_diff(raw_diff)
    typer.echo(result.summary)
    typer.echo("---")
    typer.echo(raw_diff)
```

çŽ°åœ¨è·‘ä¸€ä¸‹ï¼š

```bash
review-bot HEAD~1
review-bot HEAD~3 --repo /path/to/other/repo
```

ä½ åº”è¯¥èƒ½çœ‹åˆ°å˜æ›´æ–‡ä»¶åˆ—è¡¨å’ŒåŽŸå§‹ diff è¾“å‡ºã€‚`--repo` å‚æ•°è®©ä½ å¯ä»¥ä»Žä»»æ„ç›®å½•å®¡æŸ¥å…¶ä»–ä»“åº“çš„å˜æ›´ã€‚

> âš ï¸ **æ³¨æ„**: å½“å‰åªæœ‰ä¸€ä¸ª `diff` å‘½ä»¤ï¼Œtyper ä¼šè‡ªåŠ¨æå‡ä¸ºä¸»å‘½ä»¤ï¼Œæ‰€ä»¥ç”¨æ³•æ˜¯ `review-bot HEAD~1` è€Œä¸æ˜¯ `review-bot diff HEAD~1`ã€‚Ch6 æ·»åŠ  `report` å­å‘½ä»¤åŽä¼šåˆ‡æ¢ä¸ºå¤šå‘½ä»¤æ¨¡å¼ï¼Œå±Šæ—¶éœ€è¦æ”¹ç”¨ `review-bot diff HEAD~1`ã€‚

---

## 3.4 æç‚¼æ¨¡æ¿ï¼šExplore Agent ä½¿ç”¨æ¨¡å¼

å½“ä½ éœ€è¦è®© Claude Code æŽ¢ç´¢ä»£ç åº“æ—¶ï¼Œç”¨è¿™ä¸ª prompt æ¨¡å¼ï¼š

```
å¸®æˆ‘åˆ†æž [ç›®æ ‡èŒƒå›´]ã€‚
æˆ‘éœ€è¦çŸ¥é“ï¼š
1. [å…·ä½“é—®é¢˜ 1]
2. [å…·ä½“é—®é¢˜ 2]
3. [å…·ä½“é—®é¢˜ 3]
ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œåªéœ€è¦å‘Šè¯‰æˆ‘ç»“è®ºã€‚
```

å…³é”®ç‚¹ï¼š**æ˜Žç¡®è¯´"ä¸éœ€è¦ä¿®æ”¹"**ã€‚å¦åˆ™ Claude Code å¯èƒ½ä¼šé¡ºæ‰‹å¸®ä½ æ”¹ä»£ç ã€‚

---

## 3.5 å°ç»“

- Explore Agent æ˜¯ Claude Code çš„"ä¾¦å¯Ÿå…µ"ï¼Œåªè¯»ä¸å†™ï¼Œä¸Šä¸‹æ–‡éš”ç¦»
- Git diff è§£æžæ˜¯ Code Review çš„ç¬¬ä¸€æ­¥ï¼šå…ˆç†è§£å˜æ›´ï¼Œå†åšå®¡æŸ¥
- ç”¨ dataclass å®šä¹‰ç»“æž„åŒ–æ•°æ®ï¼Œæ¯” dict æ›´å®‰å…¨ã€æ›´å¥½ç”¨

---

# Ch4: Agent è®¾è®¡ â€” å®‰å…¨ã€æ€§èƒ½ã€é£Žæ ¼ã€é€»è¾‘å››ä¸ªä¸“å®¶

> ä¸€ä¸ªäººçœ‹ä»£ç å®¹æ˜“æœ‰ç›²åŒºã€‚å››ä¸ªä¸“å®¶åŒæ—¶çœ‹ï¼Œç›²åŒºå°±å°‘å¤šäº†ã€‚

**æœ¯è¯­**

- Promptï¼ˆæç¤ºè¯ï¼Œç»™ AI çš„æŒ‡ä»¤æ–‡æœ¬ï¼‰
- Buffer Overflowï¼ˆç¼“å†²åŒºæº¢å‡ºï¼Œå†™å…¥è¶…å‡ºåˆ†é…å†…å­˜çš„æ•°æ®ï¼‰
- Use-After-Freeï¼ˆé‡Šæ”¾åŽä½¿ç”¨ï¼Œè®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ï¼‰
- RAIIï¼ˆResource Acquisition Is Initializationï¼Œèµ„æºèŽ·å–å³åˆå§‹åŒ–ï¼‰
- CWEï¼ˆCommon Weakness Enumerationï¼Œé€šç”¨ç¼ºé™·æžšä¸¾ï¼‰
- Dataclassï¼ˆPython æ•°æ®ç±»ï¼‰
- ABCï¼ˆAbstract Base Classï¼ŒæŠ½è±¡åŸºç±»ï¼‰

**æœ¬ç« æ–°æ¦‚å¿µ**

| æ¦‚å¿µ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------------|
| Agentï¼ˆä¸“ä¸šè§’è‰²ï¼‰ | ä¸€ä¸ª AI ä»€ä¹ˆéƒ½å®¡ï¼Œç»“æžœä»€ä¹ˆéƒ½å®¡ä¸ç²¾â€”â€”åˆ’å®šä¸“ä¸šè§’è‰²ï¼Œå„å¸å…¶èŒ |
| Prompt å·¥ç¨‹ | åŒæ ·çš„æ¨¡åž‹ï¼Œä¸åŒçš„ prompt æ•ˆæžœå¤©å·®åœ°åˆ«â€”â€”ç”¨è§’è‰²ã€èƒ½åŠ›ã€çº¦æŸä¸‰è¦ç´ è®¾è®¡ prompt |

## 4.1 åœºæ™¯å¼•å…¥

å‡è®¾ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯æ€»ç›‘ï¼Œè¦å®¡æŸ¥ä¸€ä¸ªé‡è¦çš„ PRã€‚ä½ ä¼šæ€Žä¹ˆå®‰æŽ’ï¼Ÿ

ä½ ä¸ä¼šè®©ä¸€ä¸ªäººä»Žå¤´çœ‹åˆ°å°¾ã€‚ä½ ä¼šè¯´ï¼š

- "è€çŽ‹ï¼Œä½ çœ‹å®‰å…¨æ–¹é¢æœ‰æ²¡æœ‰é—®é¢˜"
- "å°æŽï¼Œä½ å…³æ³¨ä¸€ä¸‹æ€§èƒ½"
- "é˜¿èŠ±ï¼Œä»£ç é£Žæ ¼å’Œè§„èŒƒä½ æŠŠæŠŠå…³"
- "è€å¼ ï¼Œä¸šåŠ¡é€»è¾‘ä½ æœ€ç†Ÿï¼Œä½ æ¥çœ‹å¯¹ä¸å¯¹"

å››ä¸ªäººå„çœ‹å„çš„ï¼Œæœ€åŽæ±‡æ€»ã€‚è¿™å°±æ˜¯ Review Bot è¦å®žçŽ°çš„ã€‚

---

## 4.2 è®¾è®¡æ€ç»´ï¼šAgent = è§’è‰² + èƒ½åŠ› + çº¦æŸ

è®¾è®¡ä¸€ä¸ªå¥½çš„ Agentï¼Œæ ¸å¿ƒå°±ä¸‰ä»¶äº‹ï¼š

**è§’è‰²ï¼ˆRoleï¼‰**ï¼šå®ƒæ˜¯è°ï¼Ÿè¿™å†³å®šäº†å®ƒçš„è§†è§’å’Œå…³æ³¨ç‚¹ã€‚å®‰å…¨ä¸“å®¶çœ‹åˆ° `strcpy()` ä¼šè­¦è§‰ï¼Œä½†é£Žæ ¼å®¡æŸ¥å‘˜ä¸ä¼šåœ¨æ„ã€‚

**èƒ½åŠ›ï¼ˆCapabilityï¼‰**ï¼šå®ƒèƒ½ç”¨ä»€ä¹ˆå·¥å…·ï¼Ÿèƒ½è¯»å“ªäº›æ–‡ä»¶ï¼Ÿèƒ½æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ï¼Ÿèƒ½åŠ›è¶Šç²¾ç¡®ï¼Œè¾“å‡ºè¶Šèšç„¦ã€‚

**çº¦æŸï¼ˆConstraintï¼‰**ï¼šå®ƒä¸èƒ½åšä»€ä¹ˆï¼Ÿä¸èƒ½æ”¹ä»£ç ï¼Ÿåªèƒ½çœ‹ç‰¹å®šç±»åž‹çš„æ–‡ä»¶ï¼Ÿçº¦æŸé˜²æ­¢ agent è¶Šç•Œã€‚

æ‰“ä¸ªæ¯”æ–¹ï¼š

| | å®‰å…¨å®¡æŸ¥å‘˜ | æ€§èƒ½å®¡æŸ¥å‘˜ |
|---|---|---|
| è§’è‰² | å®‰å…¨ä¸“å®¶ | æ€§èƒ½å·¥ç¨‹å¸ˆ |
| èƒ½åŠ› | è¯†åˆ« buffer overflowã€use-after-freeã€format string æ¼æ´ž | è¯†åˆ«å†…å­˜æ³„æ¼ã€cache-unfriendly è®¿é—®ã€ä¸å¿…è¦çš„æ‹·è´ |
| çº¦æŸ | åªå…³æ³¨å®‰å…¨ï¼Œä¸è¯„ä»·ä»£ç é£Žæ ¼ | åªå…³æ³¨æ€§èƒ½ï¼Œä¸è¯„ä»·ä¸šåŠ¡é€»è¾‘ |

### 4.2.1 Prompt å·¥ç¨‹ï¼šå†™å¥½ Agent æŒ‡ä»¤çš„å…³é”®

ç»™ Agent å†™ promptï¼Œå’Œç»™äººå†™å·¥ä½œè¯´æ˜Žä¸€æ ·ã€‚å¥½çš„å·¥ä½œè¯´æ˜Žæœ‰ä¸‰ä¸ªç‰¹ç‚¹ï¼š

1. **å…·ä½“**ï¼šä¸è¯´"æ£€æŸ¥ä»£ç è´¨é‡"ï¼Œè¯´"æ£€æŸ¥æ˜¯å¦æœ‰ buffer overflowã€use-after-freeã€æœªåˆå§‹åŒ–å†…å­˜è¯»å–"
2. **æœ‰è¾¹ç•Œ**ï¼šä¸è¯´"çœ‹çœ‹æœ‰ä»€ä¹ˆé—®é¢˜"ï¼Œè¯´"åªå…³æ³¨å®‰å…¨é—®é¢˜ï¼Œå…¶ä»–é—®é¢˜å¿½ç•¥"
3. **æœ‰è¾“å‡ºæ ¼å¼**ï¼šä¸è¯´"å‘Šè¯‰æˆ‘ç»“æžœ"ï¼Œè¯´"æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†çº§ï¼Œæ¯ä¸ªé—®é¢˜åŒ…å«æ–‡ä»¶è·¯å¾„ã€è¡Œå·ã€æè¿°ã€ä¿®å¤å»ºè®®"

> âš ï¸ **è¸©å‘æé†’**: æœ€å¸¸è§çš„é”™è¯¯æ˜¯ prompt å¤ªå®½æ³›ã€‚"å¸®æˆ‘å®¡æŸ¥è¿™æ®µä»£ç "ä¼šå¾—åˆ°ä¸€å †æ³›æ³›è€Œè°ˆçš„å»ºè®®ã€‚"æ£€æŸ¥è¿™æ®µ C ä»£ç ä¸­æ˜¯å¦å­˜åœ¨ `strcpy`/`sprintf` ç­‰ä¸æ£€æŸ¥ç¼“å†²åŒºé•¿åº¦çš„å‡½æ•°è°ƒç”¨"ä¼šå¾—åˆ°ç²¾å‡†çš„ç»“æžœã€‚

---

## 4.3 å®žæ“å¤çŽ°ï¼šå®šä¹‰å››ä¸ªå®¡æŸ¥ Agent

### Step 1: åˆ›å»º Agent æ•°æ®ç»“æž„

å…ˆå®šä¹‰ Agent çš„é€šç”¨ç»“æž„ã€‚åœ¨ `review_bot/agents/` ç›®å½•ä¸‹åˆ›å»ºï¼š

**review_bot/agents/__init__.py**:

```python
"""Review agents package."""
```

**review_bot/agents/base.py**:

```python
"""Base agent definition."""
from dataclasses import dataclass, field


@dataclass
class ReviewIssue:
    """A single issue found during review."""

    severity: str  # "critical", "warning", "info"
    file_path: str
    line: int | None
    description: str
    suggestion: str


@dataclass
class ReviewAgent:
    """Base review agent with role, capability, and constraints."""

    name: str
    role: str
    prompt_template: str
    focus_areas: list[str] = field(default_factory=list)

    def build_prompt(self, diff_content: str) -> str:
        """Build the review prompt with diff content injected."""
        return self.prompt_template.format(diff=diff_content)
```

> ðŸ’¡ **ä¸ºä»€ä¹ˆç”¨ dataclass è€Œä¸æ˜¯ ABCï¼Ÿ** è¿™é‡Œçš„ agent æœ¬è´¨ä¸Šæ˜¯"prompt é…ç½®"ï¼Œä¸æ˜¯éœ€è¦å¤šæ€çš„å¯¹è±¡ã€‚dataclass æ›´è½»é‡ï¼Œä¹Ÿæ›´å®¹æ˜“åºåˆ—åŒ–ã€‚

### Step 2: å®šä¹‰å››ä¸ªä¸“ä¸š Agent

Agent çš„ prompt å®šä¹‰å­˜åœ¨ä¸¤ä¸ªä½ç½®ï¼Œå„æœ‰ç”¨é€”ï¼š

| ä½ç½® | ç”¨é€” | æ ¼å¼ |
|------|------|------|
| `review_bot/agents/registry.py` | Python ä¾§å¼•ç”¨ï¼Œç”¨äºŽæµ‹è¯•å’Œç¨‹åºåŒ–è®¿é—® | Python dataclass |
| `.claude/agents/*.md` | Claude Code è¿è¡Œæ—¶ä½¿ç”¨çš„ subagent å®šä¹‰ | Markdown æ–‡ä»¶ |

ä¸¤è€…çš„ prompt å†…å®¹åº”ä¿æŒåŒæ­¥ã€‚`registry.py` æ˜¯"å‚è€ƒå‰¯æœ¬"ï¼Œ`.claude/agents/` æ˜¯"è¿è¡Œæ—¶çœŸç›¸"ã€‚

**review_bot/agents/registry.py**:

```python
"""Pre-configured review agents."""
from .base import ReviewAgent

SECURITY_AGENT = ReviewAgent(
    name="security",
    role="Security Reviewer",
    focus_areas=[
        "buffer overflow",
        "use-after-free",
        "format string vulnerability",
        "integer overflow/underflow",
        "null pointer dereference",
        "uninitialized memory read",
    ],
    prompt_template="""You are a C/C++ security expert reviewing code changes.

Focus ONLY on security and memory safety issues. Ignore style, performance, and logic concerns.

Check for:
- Buffer overflow (strcpy, sprintf, gets, unbounded memcpy)
- Use-after-free / double-free
- Format string vulnerabilities (printf with user-controlled format)
- Integer overflow/underflow leading to incorrect allocation sizes
- Null pointer dereference without prior check
- Uninitialized memory read
- Any other CWE-listed C/C++ vulnerability you recognize

Diff to review:
{diff}

For each issue found, respond with one JSON object per line (no code fences):
{{"severity":"critical|warning|info","file":"<path>","line":<number or null>,"description":"<what's wrong>","suggestion":"<how to fix>"}}

If no security issues found, respond with: "No security issues detected."
""",
)

PERFORMANCE_AGENT = ReviewAgent(
    name="performance",
    role="Performance Reviewer",
    focus_areas=[
        "memory leaks",
        "cache-unfriendly access",
        "unnecessary copies",
        "malloc in loops",
        "missing move semantics",
    ],
    prompt_template="""You are a C/C++ performance engineer reviewing code changes.

Focus ONLY on performance issues. Ignore security, style, and logic concerns.

Check for:
- Memory leaks (malloc/new without corresponding free/delete)
- Unnecessary heap allocations in hot loops
- Cache-unfriendly data access patterns (e.g. linked list traversal vs array)
- Unnecessary deep copies where move or reference would suffice
- Missing reserve() for vectors with known size
- Blocking I/O without async or thread pool

Diff to review:
{diff}

For each issue, respond with one JSON object per line (no code fences):
{{"severity":"critical|warning|info","file":"<path>","line":<number or null>,"description":"<what's wrong>","suggestion":"<how to fix>"}}

If no performance issues found, respond with: "No performance issues detected."
""",
)

STYLE_AGENT = ReviewAgent(
    name="style",
    role="Style Reviewer",
    focus_areas=[
        "header guards",
        "const correctness",
        "RAII usage",
        "naming conventions",
        "include order",
    ],
    prompt_template="""You are a C/C++ code style reviewer.

Focus ONLY on style and readability. Ignore security, performance, and logic.

Check for:
- Missing or inconsistent header guards (#pragma once vs #ifndef)
- Lack of const correctness (parameters, member functions, pointers)
- Raw new/delete instead of RAII (smart pointers, containers)
- Inconsistent naming conventions (mixedCase vs snake_case)
- Wrong #include order (system â†’ third-party â†’ project)
- Magic numbers without named constants

Diff to review:
{diff}

For each issue, respond with one JSON object per line (no code fences):
{{"severity":"critical|warning|info","file":"<path>","line":<number or null>,"description":"<what's wrong>","suggestion":"<how to fix>"}}

If no style issues found, respond with: "No style issues detected."
""",
)

LOGIC_AGENT = ReviewAgent(
    name="logic",
    role="Logic Reviewer",
    focus_areas=[
        "undefined behavior",
        "signed/unsigned mismatch",
        "off-by-one errors",
        "resource leak paths",
        "unchecked error codes",
    ],
    prompt_template="""You are a C/C++ logic and correctness reviewer.

Focus ONLY on logical errors. Ignore security, performance, and style.

Check for:
- Undefined behavior (signed overflow, out-of-bounds access, strict aliasing)
- Signed/unsigned comparison mismatch
- Off-by-one errors in loop bounds or array indexing
- Resource leak on error paths (early return without cleanup)
- Unchecked return values from system calls (malloc, fopen, read)
- Incorrect pointer arithmetic

Diff to review:
{diff}

For each issue, respond with one JSON object per line (no code fences):
{{"severity":"critical|warning|info","file":"<path>","line":<number or null>,"description":"<what's wrong>","suggestion":"<how to fix>"}}

If no logic issues found, respond with: "No logic issues detected."
""",
)

# All agents in one place for easy iteration
ALL_AGENTS = [SECURITY_AGENT, PERFORMANCE_AGENT, STYLE_AGENT, LOGIC_AGENT]
```

### Step 3: åˆ†æž Prompt è®¾è®¡çš„å…³é”®å†³ç­–

å›žå¤´çœ‹è¿™å››ä¸ª agent çš„ promptï¼Œæœ‰å‡ ä¸ªåˆ»æ„çš„è®¾è®¡ï¼š

**1. æ˜Žç¡®çš„è¾¹ç•Œå£°æ˜Ž**

æ¯ä¸ª prompt éƒ½æœ‰ä¸€å¥"Focus ONLY on X. Ignore Y, Z."ã€‚è¿™ä¸æ˜¯åºŸè¯â€”â€”æ²¡æœ‰è¿™å¥ï¼Œagent ä¼š"å¥½å¿ƒ"åœ°é¡ºä¾¿æä¸€äº›å…¶ä»–ç»´åº¦çš„å»ºè®®ï¼Œå¯¼è‡´å››ä¸ª agent çš„è¾“å‡ºæœ‰å¤§é‡é‡å¤ã€‚

**2. å…·ä½“çš„æ£€æŸ¥æ¸…å•**

ä¸è¯´"æ£€æŸ¥å®‰å…¨é—®é¢˜"ï¼Œè€Œæ˜¯åˆ—å‡ºå…·ä½“çš„æ£€æŸ¥é¡¹ï¼ˆbuffer overflow, use-after-free, format string...ï¼‰ã€‚è¿™è®© agent æœ‰æ˜Žç¡®çš„"æ‰«æç›®æ ‡"ï¼Œè€Œä¸æ˜¯æ¼«æ— ç›®çš„åœ°çœ‹ã€‚

**3. ç»Ÿä¸€çš„è¾“å‡ºæ ¼å¼**

å››ä¸ª agent ç”¨å®Œå…¨ç›¸åŒçš„ **JSON-per-line** è¾“å‡ºæ ¼å¼ã€‚æ¯ä¸ªé—®é¢˜è¾“å‡ºä¸€è¡Œ JSON å¯¹è±¡ï¼š

```json
{"severity":"warning","file":"parser.c","line":42,"description":"...","suggestion":"..."}
```

è¿™æ ·åŽé¢æ±‡æ€»æŠ¥å‘Šæ—¶ï¼Œåªéœ€è¦é€è¡Œæå–ä»¥ `{` å¼€å¤´çš„è¡Œå¹¶ `json.loads()`ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ª agent å†™ä¸åŒçš„è§£æžé€»è¾‘ã€‚

> âš ï¸ **è¸©å‘æé†’**: ä¸è¦è®© agent ç”¨ Markdown ä»£ç å—åŒ…è£¹ JSON è¾“å‡ºï¼ˆå¦‚ ` ```json ... ``` `ï¼‰ã€‚ä»£ç å—ä¼šå¯¼è‡´è§£æžå™¨æ— æ³•é€è¡Œæå– JSONã€‚åœ¨ prompt ä¸­æ˜Žç¡®å†™"respond with one JSON object per line (no code fences)"ã€‚

**4. å…œåº•è¯­å¥**

æ¯ä¸ª prompt æœ€åŽéƒ½æœ‰"If no X issues found, respond with..."ã€‚æ²¡æœ‰è¿™å¥ï¼Œagent åœ¨æ²¡å‘çŽ°é—®é¢˜æ—¶å¯èƒ½ä¼šç¼–é€ é—®é¢˜æ¥"äº¤å·®"ã€‚ç»™å®ƒä¸€ä¸ªåˆæ³•çš„"æ²¡é—®é¢˜"å‡ºå£ã€‚

### Step 4: Prompt è¿­ä»£è°ƒä¼˜

Prompt ä¸æ˜¯å†™ä¸€æ¬¡å°±å®Œç¾Žçš„ã€‚ä½ éœ€è¦ç”¨çœŸå®žçš„ diff æ•°æ®åŽ»æµ‹è¯•ï¼Œç„¶åŽæ ¹æ®ç»“æžœè°ƒæ•´ã€‚ä¸‹é¢æ˜¯å®‰å…¨ agent çš„ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹ï¼š

**é—®é¢˜ 1ï¼šè¯¯æŠ¥å¤ªå¤š**

ç¬¬ä¸€ç‰ˆ prompt è·‘å®ŒåŽï¼Œå®‰å…¨ agent æŠŠæ‰€æœ‰ `memcpy()` è°ƒç”¨éƒ½æ ‡è®°ä¸º"æ½œåœ¨ buffer overflow"ã€‚è¿™æ˜¾ç„¶å¤ªæ¿€è¿›äº†â€”â€”å¾ˆå¤š `memcpy` çš„é•¿åº¦å‚æ•°æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼Œå®Œå…¨å®‰å…¨ã€‚

```
ä¿®æ”¹å‰ï¼š- Buffer overflow (strcpy, sprintf, gets, unbounded memcpy)
ä¿®æ”¹åŽï¼š- Buffer overflow (strcpy, sprintf, gets, memcpy with
         runtime-computed size lacking bounds check)
```

åŠ äº†"runtime-computed size lacking bounds check"è¿™ä¸ªé™å®šè¯ï¼Œè¯¯æŠ¥çŽ‡å¤§å¹…ä¸‹é™ã€‚

**é—®é¢˜ 2ï¼šè¾“å‡ºæ ¼å¼ä¸ç¨³å®š**

æœ‰æ—¶å€™ agent ä¼šè¾“å‡ºè‡ªç”±æ ¼å¼çš„æ–‡æœ¬è€Œä¸æ˜¯ç»“æž„åŒ–çš„ severity/file/line æ ¼å¼ã€‚

```
ä¿®æ”¹å‰ï¼šFor each issue found, respond in this exact format:
ä¿®æ”¹åŽï¼šFor each issue found, you MUST respond in this exact format.
        Do NOT add any text outside this format:
```

åŠ äº† "MUST" å’Œ "Do NOT"ï¼Œæ ¼å¼éµå®ˆçŽ‡ä»Žçº¦ 80% æå‡åˆ°æŽ¥è¿‘ 100%ã€‚

**é—®é¢˜ 3ï¼šæ¼æŠ¥**

å®‰å…¨ agent æ²¡æœ‰æ£€æµ‹åˆ° `snprintf` è¿”å›žå€¼æœªæ£€æŸ¥å¯¼è‡´çš„æˆªæ–­é£Žé™©ã€‚

```
ä¿®æ”¹å‰ï¼š- Format string vulnerabilities (printf with user-controlled format)
ä¿®æ”¹åŽï¼š- Format string vulnerabilities (printf with user-controlled format)
        - Truncation bugs (snprintf return value unchecked)
```

åœ¨æ£€æŸ¥é¡¹ä¸­åŠ å…¥å…·ä½“çš„ä»£ç æ¨¡å¼ï¼Œè®© agent çŸ¥é“"é•¿ä»€ä¹ˆæ ·"çš„ä»£ç éœ€è¦å…³æ³¨ã€‚

> ðŸ’¡ **Tip**: Prompt è°ƒä¼˜çš„æœ¬è´¨æ˜¯**ç”¨å¤±è´¥æ¡ˆä¾‹é©±åŠ¨æ”¹è¿›**ã€‚æ¯æ¬¡å‘çŽ°è¯¯æŠ¥æˆ–æ¼æŠ¥ï¼Œå°±æŠŠå¯¹åº”çš„ä¿®æ­£åŠ è¿› promptã€‚è¿™å’Œ TDD çš„æ€è·¯ä¸€æ ·â€”â€”ç”¨æµ‹è¯•é©±åŠ¨ä»£ç è´¨é‡ï¼Œç”¨çœŸå®žæ•°æ®é©±åŠ¨ prompt è´¨é‡ã€‚

---

## 4.4 æ£€æŸ¥æ¸…å•ç²¾åº¦ vs. LLM æ³›åŒ–èƒ½åŠ›

è®¾è®¡ agent prompt æ—¶ï¼Œä½ ä¼šé¢ä¸´ä¸€ä¸ªæ ¸å¿ƒå¼ åŠ›ï¼š**æ£€æŸ¥æ¸…å•å†™å¾—è¶Šå…·ä½“ï¼Œç²¾åº¦è¶Šé«˜ä½†è¦†ç›–é¢è¶Šçª„ï¼›å†™å¾—è¶Šå¼€æ”¾ï¼Œè¦†ç›–é¢è¶Šå¹¿ä½†å™ªå£°è¶Šå¤§**ã€‚çº¯æ¸…å•æ¨¡å¼ï¼ˆåªåˆ— `strcpy`/`sprintf`/`gets`ï¼‰ç²¾åº¦é«˜ä½†æ¼æŠ¥å¤šï¼›çº¯å¼€æ”¾æ¨¡å¼ï¼ˆ"find all security issues"ï¼‰è¦†ç›–å¹¿ä½†è¯¯æŠ¥å¤šã€‚

### 4.4.1 ç”œèœœç‚¹ï¼š"æ¸…å•é”šå®š + å¼€æ”¾å…œåº•"

Security Agent çš„ prompt ä¸­ç”¨äº†è¿™ä¸ªæ¨¡å¼ï¼š

```
Check for:
- Buffer overflow (strcpy, sprintf, gets, ...)
- Use-after-free / double-free
- Format string vulnerabilities
- Integer overflow/underflow
- Null pointer dereference
- Uninitialized memory read
- Any other CWE-listed C/C++ vulnerability you recognize  â† å¼€æ”¾å…œåº•
```

å‰ 6 æ¡æ˜¯**é”šå®šæ¸…å•**â€”â€”å‘Šè¯‰ LLM "è¿™äº›æ˜¯é‡ç‚¹ï¼Œå¿…é¡»æŸ¥"ã€‚æœ€åŽä¸€æ¡æ˜¯**å¼€æ”¾å…œåº•**â€”â€”ç»™ LLM ç©ºé—´å‘æŒ¥æ³›åŒ–èƒ½åŠ›ï¼Œæ•æ‰æ¸…å•ä¹‹å¤–çš„é—®é¢˜ã€‚

### 4.4.2 å®žä¾‹å¯¹æ¯”ï¼šåŒä¸€æ®µä»£ç ï¼Œä¸‰ç§ Prompt ç­–ç•¥

ç”¨è¿™æ®µ C ä»£ç æ¥çœ‹ä¸‰ç§ç­–ç•¥çš„å·®å¼‚ï¼š

```c
void handle_request(int sock) {
    char buf[64];
    int n = read(sock, buf, 256);  // â† é—®é¢˜ 1: è¯» 256 å­—èŠ‚åˆ° 64 å­—èŠ‚ç¼“å†²åŒº
    buf[n] = '\0';                 // â† é—®é¢˜ 2: n å¯èƒ½ä¸º -1ï¼ˆread å¤±è´¥ï¼‰
    printf(buf);                   // â† é—®é¢˜ 3: format string æ¼æ´ž
    char *copy = strdup(buf);
    process(copy);
    // copy æœª free                 â† é—®é¢˜ 4: å†…å­˜æ³„æ¼ï¼ˆæ€§èƒ½ç»´åº¦ï¼‰
}
```

| ç­–ç•¥ | Prompt é£Žæ ¼ | èƒ½å‘çŽ°çš„é—®é¢˜ | è¯¯æŠ¥é£Žé™© |
|------|------------|-------------|---------|
| çº¯æ¸…å• | "Check for: strcpy, sprintf, gets" | æ— ï¼ˆè¿™æ®µä»£ç æ²¡ç”¨æ¸…å•é‡Œçš„å‡½æ•°ï¼‰ | æžä½Ž |
| æ¸…å•é”šå®š + å¼€æ”¾å…œåº• | æ¸…å• + "Any other CWE vulnerability" | é—®é¢˜ 1, 2, 3 | ä½Ž |
| çº¯å¼€æ”¾ | "Find all security issues" | é—®é¢˜ 1, 2, 3, 4 + å¯èƒ½è¯¯æŠ¥ | ä¸­ç­‰ |

çº¯æ¸…å•ç­–ç•¥åœ¨è¿™ä¸ªä¾‹å­ä¸­å®Œå…¨å¤±æ•ˆâ€”â€”å› ä¸ºä»£ç æ²¡ç”¨ `strcpy`/`sprintf`/`gets`ï¼Œä½† `read` çš„è¶Šç•Œå†™å…¥åŒæ ·å±é™©ã€‚æ¸…å•é”šå®š + å¼€æ”¾å…œåº•ç­–ç•¥èƒ½æ•æ‰åˆ°æ ¸å¿ƒå®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒè¾ƒä½Žçš„è¯¯æŠ¥çŽ‡ã€‚

### 4.4.3 è®¾è®¡åŽŸåˆ™

æ€»ç»“ä¸ºå››æ¡å®žæ“åŽŸåˆ™ï¼š

1. **æ¸…å•è¦†ç›–é«˜é¢‘é—®é¢˜**ï¼šæŠŠä½ çš„é¢†åŸŸä¸­æœ€å¸¸è§çš„ 80% é—®é¢˜åˆ—æˆæ¸…å•ã€‚å¯¹ C/C++ å®‰å…¨æ¥è¯´ï¼Œå°±æ˜¯ CWE Top 25 ä¸­çš„ C ç›¸å…³æ¡ç›®ã€‚

2. **å¼€æ”¾å…œåº•æ•æ‰é•¿å°¾**ï¼šåœ¨æ¸…å•æœ«å°¾åŠ ä¸€æ¡å¼€æ”¾å¼æŒ‡ä»¤ï¼Œè®© LLM ç”¨è‡ªå·±çš„çŸ¥è¯†è¡¥å……æ¸…å•ä¹‹å¤–çš„å‘çŽ°ã€‚

3. **ç”¨é™å®šè¯æŽ§åˆ¶ç²¾åº¦**ï¼šä¸è¯´"buffer overflow"ï¼Œè¯´"buffer overflow with runtime-computed size lacking bounds check"ã€‚é™å®šè¯è¶Šç²¾ç¡®ï¼Œè¯¯æŠ¥è¶Šå°‘ã€‚

4. **è¿­ä»£æ ¡å‡†**ï¼šè·‘å‡ è½®çœŸå®žæ•°æ®ï¼Œç»Ÿè®¡è¯¯æŠ¥å’Œæ¼æŠ¥ï¼Œè°ƒæ•´æ¸…å•çš„ç²’åº¦å’Œå¼€æ”¾å…œåº•çš„æŽªè¾žã€‚è¿™æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§çš„ã€‚

> ðŸ’¡ **Tip**: è¿™ä¸ªå¹³è¡¡æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆã€‚å¦‚æžœä½ çš„åœºæ™¯å¯¹è¯¯æŠ¥é›¶å®¹å¿ï¼ˆæ¯”å¦‚ CI æµæ°´çº¿ä¸­çš„è‡ªåŠ¨æ‹¦æˆªï¼‰ï¼Œå°±æŠŠæ¸…å•å†™å¾—æ›´å…·ä½“ã€å¼€æ”¾å…œåº•çš„æƒé‡è°ƒä½Žã€‚å¦‚æžœä½ çš„åœºæ™¯æ›´çœ‹é‡è¦†ç›–é¢ï¼ˆæ¯”å¦‚å®‰å…¨å®¡è®¡æŠ¥å‘Šï¼‰ï¼Œå°±ç»™ LLM æ›´å¤šè‡ªç”±å‘æŒ¥çš„ç©ºé—´ã€‚

---

## 4.5 æç‚¼æ¨¡æ¿ï¼šAgent Prompt è®¾è®¡æ¨¡æ¿

```
You are a [è§’è‰²] reviewing [å®¡æŸ¥å¯¹è±¡].

Focus ONLY on [å…³æ³¨é¢†åŸŸ]. Ignore [æŽ’é™¤é¢†åŸŸ].

Check for:
- [å…·ä½“æ£€æŸ¥é¡¹ 1]
- [å…·ä½“æ£€æŸ¥é¡¹ 2]
- [å…·ä½“æ£€æŸ¥é¡¹ 3]

[è¾“å…¥æ•°æ®å ä½ç¬¦]

For each issue found, respond with one JSON object per line (no code fences):
{"severity":"critical|warning|info","file":"<path>","line":<number or null>,"description":"<what>","suggestion":"<fix>"}

If no issues found, respond with: "[æ— é—®é¢˜æ—¶çš„æ ‡å‡†å›žå¤]"
```

è¿™ä¸ªæ¨¡æ¿çš„æ ¸å¿ƒåŽŸåˆ™ï¼š**è¶Šå…·ä½“è¶Šå¥½ï¼Œè¶Šæœ‰è¾¹ç•Œè¶Šå¥½ï¼Œè¾“å‡ºæ ¼å¼å¿…é¡»æ˜¯æœºå™¨å¯è§£æžçš„ JSON-per-line**ã€‚

---

## 4.6 å°ç»“

- Agent è®¾è®¡ä¸‰è¦ç´ ï¼šè§’è‰²ã€èƒ½åŠ›ã€çº¦æŸ
- Prompt è¦å…·ä½“ã€æœ‰è¾¹ç•Œã€æœ‰ç»Ÿä¸€è¾“å‡ºæ ¼å¼
- å››ä¸ªå®¡æŸ¥ agent å„å¸å…¶èŒï¼šå®‰å…¨ã€æ€§èƒ½ã€é£Žæ ¼ã€é€»è¾‘

---

# Ch5: Fan-out/Fan-in â€” å››ä¸ª Agent åŒæ—¶å¼€å·¥

> ä¸²è¡Œå®¡æŸ¥åƒæŽ’é˜Ÿä¹°å¥¶èŒ¶ï¼Œå¹¶è¡Œå®¡æŸ¥åƒå››ä¸ªçª—å£åŒæ—¶å‡ºé¤ã€‚

**æœ¯è¯­**

- Fan-out/Fan-inï¼ˆæ‰‡å‡º/æ‰‡å…¥ï¼Œä»»åŠ¡å¹¶è¡Œåˆ†å‘å†æ±‡æ€»ç»“æžœçš„æ¨¡å¼ï¼‰
- Subagentï¼ˆå­ä»£ç†ï¼Œç”±ä¸» Agent æ´¾å‡ºæ‰§è¡Œå­ä»»åŠ¡ï¼‰
- Context Isolationï¼ˆä¸Šä¸‹æ–‡éš”ç¦»ï¼Œæ¯ä¸ª subagent æ‹¥æœ‰ç‹¬ç«‹çš„å¯¹è¯ä¸Šä¸‹æ–‡ï¼‰
- Timeoutï¼ˆè¶…æ—¶ï¼Œç­‰å¾…æ“ä½œå®Œæˆçš„æœ€å¤§æ—¶é—´é™åˆ¶ï¼‰

**æœ¬ç« æ–°æ¦‚å¿µ**

| æ¦‚å¿µ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------------|
| Ch5 Fan-out/Fan-in | 4 ä¸ª Agent ä¸²è¡Œå¤ªæ…¢â€”â€”åŒæ—¶æ´¾å‡ºåŽ»ï¼Œæœ€åŽç»Ÿä¸€æ”¶ç»“æžœ |
| Subagent | å­ä»»åŠ¡çš„ä¸­é—´è¿‡ç¨‹å¡žæ»¡ä¸» Agent çš„è®°å¿†â€”â€”ç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼Œåªå¸¦ç»“è®ºå›žæ¥ |

## 5.1 åœºæ™¯å¼•å…¥

ä¸Šä¸€ç« è®¾è®¡äº†å››ä¸ªå®¡æŸ¥ agentã€‚å¦‚æžœè®©å®ƒä»¬ä¸€ä¸ªæŽ¥ä¸€ä¸ªåœ°è·‘ï¼š

```
å®‰å…¨å®¡æŸ¥ï¼ˆ30ç§’ï¼‰â†’ æ€§èƒ½å®¡æŸ¥ï¼ˆ30ç§’ï¼‰â†’ é£Žæ ¼å®¡æŸ¥ï¼ˆ30ç§’ï¼‰â†’ é€»è¾‘å®¡æŸ¥ï¼ˆ30ç§’ï¼‰= 120ç§’
```

ä½†å®ƒä»¬ä¹‹é—´å®Œå…¨æ²¡æœ‰ä¾èµ–â€”â€”å®‰å…¨å®¡æŸ¥ä¸éœ€è¦ç­‰æ€§èƒ½å®¡æŸ¥çš„ç»“æžœã€‚é‚£ä¸ºä»€ä¹ˆä¸è®©å®ƒä»¬åŒæ—¶è·‘ï¼Ÿ

```
å®‰å…¨å®¡æŸ¥ï¼ˆ30ç§’ï¼‰â”€â”
æ€§èƒ½å®¡æŸ¥ï¼ˆ30ç§’ï¼‰â”€â”¤
é£Žæ ¼å®¡æŸ¥ï¼ˆ30ç§’ï¼‰â”€â”¼â†’ æ±‡æ€» = 30ç§’ + æ±‡æ€»æ—¶é—´
é€»è¾‘å®¡æŸ¥ï¼ˆ30ç§’ï¼‰â”€â”˜
```

è¿™å°±æ˜¯ **Fan-out / Fan-in** æ¨¡å¼ï¼šæŠŠä»»åŠ¡åˆ†å‘ï¼ˆfan-outï¼‰ç»™å¤šä¸ª agentï¼Œç­‰å®ƒä»¬éƒ½å®ŒæˆåŽæ”¶é›†ç»“æžœï¼ˆfan-inï¼‰ã€‚

---

## 5.2 è®¾è®¡æ€ç»´ï¼šClaude Code çš„å¹¶è¡Œæ‰§è¡Œæœºåˆ¶

### 5.2.1 æ€Žä¹ˆå®žçŽ°å¹¶è¡Œï¼Ÿ

åœ¨ Claude Code ä¸­ï¼Œå¹¶è¡Œæ‰§è¡Œçš„å…³é”®æ˜¯ï¼š**åœ¨åŒä¸€æ¡æ¶ˆæ¯ä¸­å‘èµ·å¤šä¸ª Task è°ƒç”¨**ã€‚

ä¸²è¡Œï¼ˆä¸€ä¸ªæŽ¥ä¸€ä¸ªï¼‰ï¼š
```
æ¶ˆæ¯1: Task(agent=security, ...)  â†’ ç­‰ç»“æžœ
æ¶ˆæ¯2: Task(agent=performance, ...) â†’ ç­‰ç»“æžœ
æ¶ˆæ¯3: Task(agent=style, ...)     â†’ ç­‰ç»“æžœ
```

å¹¶è¡Œï¼ˆåŒæ—¶å‘å‡ºï¼‰ï¼š
```
æ¶ˆæ¯1: Task(agent=security, ...)
        Task(agent=performance, ...)
        Task(agent=style, ...)
        Task(agent=logic, ...)
        â†’ åŒæ—¶æ‰§è¡Œï¼Œä¸€èµ·è¿”å›ž
```

### 5.2.2 å‰å° vs åŽå° Agent

Claude Code çš„ Task tool æœ‰ä¸€ä¸ª `run_in_background` å‚æ•°ï¼š

- **å‰å°ï¼ˆé»˜è®¤ï¼‰**ï¼šä¸» agent ç­‰å¾… subagent å®ŒæˆåŽæ‰ç»§ç»­ã€‚é€‚åˆéœ€è¦ç»“æžœæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥çš„åœºæ™¯ã€‚
- **åŽå°**ï¼šä¸» agent ä¸ç­‰å¾…ï¼Œç»§ç»­åšå…¶ä»–äº‹ã€‚é€‚åˆ"å‘å‡ºåŽ»å°±è¡Œï¼Œç»“æžœæ™šç‚¹å†çœ‹"çš„åœºæ™¯ã€‚

å®¡æŸ¥åœºæ™¯ç”¨å‰å°æ¨¡å¼â€”â€”å› ä¸ºéœ€è¦ç­‰æ‰€æœ‰ agent éƒ½å®¡æŸ¥å®Œï¼Œæ‰èƒ½æ±‡æ€»æŠ¥å‘Šã€‚

### 5.2.3 ä¸Šä¸‹æ–‡éš”ç¦»ï¼šä¸ºä»€ä¹ˆå¹¶è¡Œ Agent ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼Ÿ

æ¯ä¸ª subagent éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£ã€‚å®‰å…¨ agent è¯»äº† 100 ä¸ªæ–‡ä»¶ï¼Œè¿™äº›å†…å®¹ä¸ä¼šå‡ºçŽ°åœ¨æ€§èƒ½ agent çš„ä¸Šä¸‹æ–‡é‡Œã€‚

è¿™å¾ˆé‡è¦ï¼ŒåŽŸå› æœ‰äºŒï¼š
1. **é¿å…å¹²æ‰°**ï¼šå®‰å…¨ agent çš„åˆ†æžä¸ä¼šå½±å“æ€§èƒ½ agent çš„åˆ¤æ–­
2. **èŠ‚çœä¸Šä¸‹æ–‡**ï¼šä¸» agent åªæ”¶åˆ°æ¯ä¸ª subagent çš„æœ€ç»ˆç»“è®ºï¼Œä¸ä¼šè¢«ä¸­é—´è¿‡ç¨‹æ’‘çˆ†

---

## 5.3 å®žæ“å¤çŽ°ï¼šå®žçŽ°å¹¶è¡Œå®¡æŸ¥è°ƒåº¦

### Step 1: åˆ›å»ºç»“æžœèšåˆå±‚

æ³¨æ„ï¼šè¿™é‡Œä¸å®žçŽ° LLM è°ƒåº¦é€»è¾‘ã€‚Python ä»£ç åªè´Ÿè´£**æ•°æ®ç»“æž„å’Œç»“æžœè§£æž**ï¼ŒçœŸæ­£çš„å¹¶è¡Œè°ƒåº¦ç”± `/review-bot` skill é€šè¿‡ Claude Code çš„ Task tool å®Œæˆã€‚

**review_bot/scheduler.py**:

```python
"""Result aggregation utilities for Claude Code skill orchestration.

This module provides data structures for collecting and aggregating
review results from parallel Claude Code subagents. The actual LLM
orchestration happens through the /review-bot skill, not Python code.
"""
import json
from dataclasses import dataclass, field

from .agents.base import ReviewIssue


@dataclass
class AgentResult:
    """Result from a single agent's review."""

    agent_name: str
    issues: list[ReviewIssue] = field(default_factory=list)
    error: str | None = None


@dataclass
class ReviewSession:
    """Aggregated results from all agents."""

    results: list[AgentResult] = field(default_factory=list)

    @property
    def all_issues(self) -> list[ReviewIssue]:
        return [
            issue
            for result in self.results
            for issue in result.issues
        ]

    @property
    def has_critical(self) -> bool:
        return any(i.severity == "critical" for i in self.all_issues)
```

### Step 2: å®žçŽ° Agent è¾“å‡ºè§£æž

æ¯ä¸ª subagent è¿”å›žçš„æ˜¯è‡ªç”±æ–‡æœ¬ï¼ˆåŒ…å« JSON-per-line æ ¼å¼çš„ issueï¼‰ã€‚éœ€è¦ä¸€ä¸ªè§£æžå‡½æ•°æŠŠæ–‡æœ¬è½¬æˆç»“æž„åŒ–æ•°æ®ï¼š

```python
def parse_agent_output(agent_name: str, raw_output: str) -> AgentResult:
    """Parse raw agent output text into structured AgentResult.

    Extracts JSON issue objects from agent response text.
    Each line starting with '{' is treated as a potential JSON issue.
    """
    result = AgentResult(agent_name=agent_name)

    for line in raw_output.splitlines():
        line = line.strip()
        if not line.startswith("{"):
            continue
        try:
            data = json.loads(line)
            result.issues.append(ReviewIssue(
                severity=data.get("severity", "info"),
                file_path=data.get("file", "unknown"),
                line=data.get("line"),
                description=data.get("description", ""),
                suggestion=data.get("suggestion", ""),
            ))
        except (json.JSONDecodeError, KeyError):
            continue

    return result
```

è¿™æ®µä»£ç çš„å…³é”®è®¾è®¡ï¼š

1. **åªæå–ä»¥ `{` å¼€å¤´çš„è¡Œ**ï¼šagent è¾“å‡ºä¸­å¯èƒ½æœ‰è§£é‡Šæ€§æ–‡å­—ï¼Œåªæœ‰ JSON è¡Œæ‰æ˜¯ç»“æž„åŒ–æ•°æ®
2. **å®¹é”™**ï¼šæ— æ•ˆ JSON é™é»˜è·³è¿‡ï¼Œä¸ä¼šè®©æ•´ä¸ªè§£æžå´©æŽ‰
3. **çº¯å‡½æ•°**ï¼šè¾“å…¥æ–‡æœ¬ï¼Œè¾“å‡ºç»“æž„åŒ–æ•°æ®ï¼Œå¯ç‹¬ç«‹æµ‹è¯•

> âš ï¸ **æž¶æž„è¦ç‚¹**ï¼šPython ä»£ç åªåš"å·¥å…·å±‚"â€”â€”è§£æžæ–‡æœ¬ã€ç”ŸæˆæŠ¥å‘Šã€‚LLM ç¼–æŽ’ï¼ˆè°æ¥è·‘ã€æ€Žä¹ˆå¹¶è¡Œï¼‰å®Œå…¨äº¤ç»™ Claude Code çš„ `/review-bot` skillã€‚è¿™ç§åˆ†å±‚è®© Python ä»£ç å¯æµ‹è¯•ã€å¯å¤ç”¨ï¼Œè€Œç¼–æŽ’é€»è¾‘ä¿æŒçµæ´»ã€‚

### Step 3: ç”¨ `/review-bot` Skill è§¦å‘å¹¶è¡Œå®¡æŸ¥

è¿™æ˜¯å…³é”®éƒ¨åˆ†ã€‚å®žé™…é¡¹ç›®ä¸­ï¼Œå¹¶è¡Œå®¡æŸ¥é€šè¿‡ **Skill**ï¼ˆ`.claude/skills/review-bot/SKILL.md`ï¼‰è§¦å‘ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ‰‹åŠ¨å†™ä¸€å¤§æ®µ promptã€‚

åœ¨ Claude Code ä¸­è¾“å…¥ï¼š

```
/review-bot HEAD~3
```

Claude Code è¯»å– `.claude/skills/review-bot/SKILL.md`ï¼ŒæŠŠ `HEAD~3` æ›¿æ¢åˆ° `$ARGUMENTS`ï¼Œç„¶åŽæŒ‰æ­¥éª¤æ‰§è¡Œã€‚Skill æ–‡ä»¶çš„æ ¸å¿ƒå†…å®¹ï¼š

```markdown
Run a C/C++ code review workflow.

## Step 1: Get the diff
review-bot diff $ARGUMENTS

## Step 2: Fan-out â€” 4 parallel review agents
Launch exactly 4 Task tool calls IN PARALLEL (in a single message). Each Task must:
- Use subagent_type: "general-purpose"
- Include the COMPLETE agent prompt below
- Append the full diff content at the end

**Task 1 â€” Security:**
> You are a C/C++ security expert. Focus ONLY on security...
> Output one JSON object per line (no code fences):
> {"severity":"...","file":"...","line":...,"description":"...","suggestion":"..."}

**Task 2 â€” Performance:**
> You are a C/C++ performance engineer. Focus ONLY on performance.
> Ignore security, style, logic. Check for: memory leaks, unnecessary heap allocations
> in loops, cache-unfriendly access, unnecessary copies, missing reserve(), blocking I/O.
> Output format: same JSON-per-line as above. If none: "No performance issues detected."

**Task 3 â€” Style:**
> You are a C/C++ style reviewer. Focus ONLY on style and readability.
> Ignore security, performance, logic. Check for: missing/inconsistent header guards,
> const correctness, raw new/delete vs RAII, naming conventions, include order, magic numbers.
> Output format: same JSON-per-line. If none: "No style issues detected."

**Task 4 â€” Logic:**
> You are a C/C++ logic reviewer. Focus ONLY on correctness.
> Ignore security, performance, style. Check for: undefined behavior, signed/unsigned
> mismatch, off-by-one errors, resource leaks on error paths, unchecked return values,
> incorrect pointer arithmetic. Output format: same JSON-per-line. If none: "No logic issues detected."

## Step 3: Fan-in â€” collect and merge
Extract all lines starting with `{` from each agent's response.

## Step 4: Generate report
echo '<merged_json_array>' | review-bot report
```

Claude Code å†…éƒ¨ä¼šåŒæ—¶å‘èµ· 4 ä¸ª Task è°ƒç”¨ï¼ˆæ¦‚å¿µç¤ºæ„ï¼‰ï¼š

```
Task(subagent_type="general-purpose", prompt="[Security prompt + diff]")
Task(subagent_type="general-purpose", prompt="[Performance prompt + diff]")
Task(subagent_type="general-purpose", prompt="[Style prompt + diff]")
Task(subagent_type="general-purpose", prompt="[Logic prompt + diff]")
```

å››ä¸ª subagent åŒæ—¶å¯åŠ¨ï¼Œå„è‡ªç‹¬ç«‹å®¡æŸ¥ï¼Œå®ŒæˆåŽç»“æžœä¸€èµ·è¿”å›žç»™ä¸» agentã€‚

> âš ï¸ **è¸©å‘æé†’ï¼šPrompt å¿…é¡»å†…è”**ï¼šSkill æ–‡ä»¶ä¸­å¿…é¡»æŠŠæ¯ä¸ª agent çš„å®Œæ•´ prompt å†™è¿›åŽ»ï¼Œä¸èƒ½å†™"è¯»å– `.claude/agents/security-reviewer.md`"ã€‚å› ä¸º subagent æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œçœ‹ä¸åˆ°ä¸» agent è¯»è¿‡çš„æ–‡ä»¶ã€‚è¿™æ˜¯å®žè·µä¸­æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯ã€‚

### Step 4: ä¸‰å±‚æž¶æž„çš„åä½œ

å›žé¡¾ Ch2 çš„ CLAUDE.mdï¼Œå…¶ä¸­å®šä¹‰äº†ä¸‰å±‚æž¶æž„ï¼š

```markdown
## Architecture
- Python ä»£ç  = å·¥å…·å±‚ï¼ˆdiff è§£æžã€æŠ¥å‘Šç”Ÿæˆï¼‰
- `.claude/skills/review-bot/SKILL.md` = ç¼–æŽ’å±‚ï¼ˆé€šè¿‡ Claude Code Task tool è°ƒåº¦ï¼‰
- `.claude/agents/*.md` = Agent å®šä¹‰ï¼ˆæ¯ä¸ª agent çš„è§’è‰²å’Œ promptï¼‰
```

åœ¨å¹¶è¡Œå®¡æŸ¥ä¸­ï¼Œä¸‰å±‚å„å¸å…¶èŒï¼š

| å±‚ | èŒè´£ | æ–‡ä»¶ |
|---|------|------|
| å·¥å…·å±‚ | `review-bot diff` èŽ·å– diffï¼Œ`review-bot report` ç”ŸæˆæŠ¥å‘Š | `cli.py`, `diff_parser.py`, `reporter.py` |
| ç¼–æŽ’å±‚ | `/review-bot` skill è°ƒåº¦ 4 ä¸ªå¹¶è¡Œ Taskï¼Œæ”¶é›†ç»“æžœ | `.claude/skills/review-bot/SKILL.md` |
| Agent å±‚ | æ¯ä¸ª agent çš„ä¸“ä¸š promptï¼ˆè¿è¡Œæ—¶çœŸç›¸ï¼‰ | `.claude/agents/*.md` |

æ³¨æ„ï¼šSkill æ–‡ä»¶ä¸­å†…è”äº† agent promptï¼ˆå› ä¸º subagent ä¸Šä¸‹æ–‡éš”ç¦»ï¼‰ï¼Œè€Œ `.claude/agents/*.md` ä½œä¸ºç‹¬ç«‹çš„ agent å®šä¹‰æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å…¶ä»–åœºæ™¯ä¸­è¢«å•ç‹¬è°ƒç”¨ã€‚`registry.py` åˆ™æ˜¯ Python ä¾§çš„å‚è€ƒå‰¯æœ¬ï¼Œç”¨äºŽæµ‹è¯•å’Œç¨‹åºåŒ–è®¿é—®ã€‚

> âš ï¸ **è¸©å‘æé†’**: å¹¶è¡Œ agent çš„æ•°é‡ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚Claude Code æœ‰å¹¶å‘é™åˆ¶ï¼ˆå»ºè®®æœ€å¤š 4 ä¸ªåŒæ—¶è¿è¡Œï¼‰ã€‚è¶…è¿‡è¿™ä¸ªæ•°é‡ï¼Œåè€Œä¼šå› ä¸ºèµ„æºç«žäº‰å˜æ…¢ã€‚

### 5.3.5 å¹¶è¡Œæ‰§è¡Œçš„å®žæˆ˜æ³¨æ„äº‹é¡¹

**1. å‰å° vs åŽå°ï¼šæ€Žä¹ˆé€‰ï¼Ÿ**

```
# æ¦‚å¿µç¤ºæ„ï¼ˆéžå¯æ‰§è¡Œä»£ç ï¼‰

# å‰å°ï¼ˆé»˜è®¤ï¼‰ï¼šä¸» agent ç­‰æ‰€æœ‰ subagent å®ŒæˆåŽæ‰ç»§ç»­
Task(subagent_type="general-purpose", prompt="...")

# åŽå°ï¼šä¸» agent ä¸ç­‰å¾…ï¼Œç»§ç»­åšå…¶ä»–äº‹
Task(subagent_type="general-purpose", prompt="...", run_in_background=True)
```

å®¡æŸ¥åœºæ™¯ç”¨å‰å°â€”â€”å› ä¸ºå¿…é¡»ç­‰æ‰€æœ‰ agent éƒ½å®¡æŸ¥å®Œï¼Œæ‰èƒ½æ±‡æ€»æŠ¥å‘Šã€‚åŽå°æ¨¡å¼é€‚åˆ"å‘å‡ºåŽ»å°±è¡Œï¼Œç»“æžœæ™šç‚¹å†çœ‹"çš„åœºæ™¯ï¼Œæ¯”å¦‚åœ¨åŽå°è·‘ä¸€ä¸ªè€—æ—¶çš„ä»£ç åˆ†æžï¼ŒåŒæ—¶ä¸» agent ç»§ç»­å’Œä½ å¯¹è¯ã€‚

**2. å¦‚æžœä¸€ä¸ª agent è¶…æ—¶äº†æ€Žä¹ˆåŠžï¼Ÿ**

å›žé¡¾ Ch1 çš„è®¾è®¡å†³ç­–ï¼šéƒ¨åˆ†å¤±è´¥ä¸é˜»å¡žæ•´ä½“ã€‚åœ¨ `scheduler.py` ä¸­ï¼Œ`AgentResult` æœ‰ä¸€ä¸ª `error` å­—æ®µã€‚å¦‚æžœæŸä¸ª agent è¶…æ—¶æˆ–æŠ¥é”™ï¼Œä¸» agent ä¼šè®°å½•é”™è¯¯ä¿¡æ¯ï¼Œä½†ä¸ä¼šé˜»å¡žå…¶ä»– agent çš„ç»“æžœã€‚

**3. å¹¶è¡Œ agent çš„ prompt è¦è‡ªåŒ…å«**

æ¯ä¸ª subagent æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œçœ‹ä¸åˆ°ä¸» agent çš„å¯¹è¯åŽ†å²ã€‚æ‰€ä»¥ prompt å¿…é¡»åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯â€”â€”ä¸èƒ½è¯´"ç”¨ä¹‹å‰è®¨è®ºçš„æ ¼å¼"ï¼Œè¦æŠŠæ ¼å¼å®Œæ•´å†™è¿›åŽ»ã€‚è¿™å°±æ˜¯ Ch4 ä¸­æ¯ä¸ª agent prompt éƒ½è‡ªå¸¦å®Œæ•´è¾“å‡ºæ ¼å¼è¯´æ˜Žçš„åŽŸå› ã€‚

---

## 5.4 æç‚¼æ¨¡æ¿ï¼šFan-out / Fan-in æ¨¡å¼

```
1. å‡†å¤‡è¾“å…¥æ•°æ®
   â†“
2. Fan-out: åŒæ—¶æ´¾å‡º N ä¸ª agent
   â”œâ”€â”€ Agent A (ç‹¬ç«‹ä¸Šä¸‹æ–‡)
   â”œâ”€â”€ Agent B (ç‹¬ç«‹ä¸Šä¸‹æ–‡)
   â””â”€â”€ Agent C (ç‹¬ç«‹ä¸Šä¸‹æ–‡)
   â†“
3. Fan-in: æ”¶é›†æ‰€æœ‰ç»“æžœ
   â†“
4. èšåˆå¤„ç†
```

é€‚ç”¨åœºæ™¯ï¼š
- å¤šä¸ªç‹¬ç«‹çš„å®¡æŸ¥/åˆ†æžä»»åŠ¡
- æ‰¹é‡å¤„ç†å¤šä¸ªæ–‡ä»¶
- å¤šç»´åº¦è¯„ä¼°ï¼ˆå®‰å…¨ + æ€§èƒ½ + é£Žæ ¼ + ...ï¼‰

ä¸é€‚ç”¨åœºæ™¯ï¼š
- æ­¥éª¤ä¹‹é—´æœ‰ä¾èµ–ï¼ˆç”¨é¡ºåºå·¥ä½œæµï¼‰
- åŽä¸€æ­¥éœ€è¦å‰ä¸€æ­¥çš„ç»“æžœï¼ˆç”¨ pipelineï¼‰

---

## 5.5 å°ç»“

- å¹¶è¡Œæ‰§è¡Œçš„å…³é”®ï¼šåœ¨åŒä¸€æ¡æ¶ˆæ¯ä¸­å‘èµ·å¤šä¸ª Task è°ƒç”¨
- Fan-out / Fan-in æ˜¯æœ€å¸¸ç”¨çš„å¹¶è¡Œæ¨¡å¼
- æ¯ä¸ª subagent ä¸Šä¸‹æ–‡éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°
- å¹¶å‘æ•°å»ºè®®ä¸è¶…è¿‡ 4 ä¸ª

---

# Ch6: ç»“æžœèšåˆ â€” æŠŠæ•£è£…ç»“æžœå˜æˆä¸€ä»½æ­£ç»æŠ¥å‘Š

> å››ä¸ªä¸“å®¶å„è¯´å„çš„ï¼Œä½ éœ€è¦ä¸€ä¸ªäººæŠŠå®ƒä»¬æ•´ç†æˆè€æ¿èƒ½çœ‹æ‡‚çš„ä¸œè¥¿ã€‚

**æœ¯è¯­**

- Verdictï¼ˆè£å®šï¼Œå®¡æŸ¥çš„æœ€ç»ˆç»“è®ºï¼šé€šè¿‡/è­¦å‘Š/ä¸é€šè¿‡ï¼‰
- JSONï¼ˆJavaScript Object Notationï¼Œè½»é‡æ•°æ®äº¤æ¢æ ¼å¼ï¼‰
- Enumï¼ˆæžšä¸¾ï¼Œä¸€ç»„å‘½åå¸¸é‡çš„é›†åˆï¼‰
- CI/CDï¼ˆContinuous Integration/Continuous Deliveryï¼ŒæŒç»­é›†æˆ/æŒç»­äº¤ä»˜ï¼‰
- Deduplicationï¼ˆåŽ»é‡ï¼Œåˆå¹¶é‡å¤çš„å®¡æŸ¥ç»“æžœï¼‰

**æœ¬ç« æ–°æ¦‚å¿µ**

| æ¦‚å¿µ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------------|
| Result Aggregation | å››ä»½æ•£è£…ç»“æžœæ²¡äººèƒ½ä¸€çœ¼çœ‹å‡ºç»“è®ºâ€”â€”åˆ†ç±»ã€æŽ’åºã€åŽ»é‡ï¼Œç”Ÿæˆä¸€ä»½èƒ½åšå†³ç­–çš„æŠ¥å‘Š |
| Verdictï¼ˆè£å®šï¼‰ | çœ‹å®ŒæŠ¥å‘Šè¿˜æ˜¯ä¸çŸ¥é“"è¿™ä¸ª PR èƒ½ä¸èƒ½åˆ"â€”â€”ç”¨è§„åˆ™è‡ªåŠ¨ç»™å‡º PASS / NEEDS_WORK / FAIL |

## 6.1 åœºæ™¯å¼•å…¥

å››ä¸ªå®¡æŸ¥ agent è·‘å®Œäº†ï¼Œä½ æ‰‹é‡Œæœ‰å››ä»½ç‹¬ç«‹çš„å®¡æŸ¥ç»“æžœã€‚å®‰å…¨ agent è¯´å‘çŽ°äº† 2 ä¸ªé—®é¢˜ï¼Œæ€§èƒ½ agent è¯´æœ‰ 1 ä¸ªè­¦å‘Šï¼Œé£Žæ ¼ agent æäº† 5 æ¡å»ºè®®ï¼Œé€»è¾‘ agent è¯´ä¸€åˆ‡æ­£å¸¸ã€‚

çŽ°åœ¨é—®é¢˜æ¥äº†ï¼šä½ è¦æŠŠè¿™äº›æ•£è£…ä¿¡æ¯å˜æˆä¸€ä»½ç»“æž„åŒ–çš„æŠ¥å‘Šï¼Œè®©äººä¸€çœ¼å°±èƒ½çœ‹å‡º"è¿™ä¸ª PR èƒ½ä¸èƒ½åˆ"ã€‚

---

## 6.2 è®¾è®¡æ€ç»´ï¼šç»“æžœèšåˆçš„ä¸‰ä¸ªå±‚æ¬¡

**å±‚æ¬¡ 1ï¼šç®€å•æ‹¼æŽ¥** â€” æŠŠå››ä»½ç»“æžœé¦–å°¾ç›¸è¿žã€‚èƒ½ç”¨ï¼Œä½†ä¸å¥½ç”¨ã€‚è¯»è€…è¦è‡ªå·±åŽ»æ‰¾é‡ç‚¹ã€‚

**å±‚æ¬¡ 2ï¼šåˆ†ç±»æ±‡æ€»** â€” æŒ‰ä¸¥é‡ç¨‹åº¦æŽ’åºï¼Œcritical æ”¾æœ€å‰é¢ã€‚å¥½ä¸€äº›ï¼Œä½†ç¼ºå°‘å…¨å±€åˆ¤æ–­ã€‚

**å±‚æ¬¡ 3ï¼šæ™ºèƒ½èšåˆ** â€” ä¸ä»…æ±‡æ€»ï¼Œè¿˜ç»™å‡ºæ•´ä½“è¯„ä¼°ï¼š"è¿™ä¸ª PR æœ‰ 2 ä¸ªä¸¥é‡é—®é¢˜å¿…é¡»ä¿®å¤ï¼Œ3 ä¸ªå»ºè®®å¯ä»¥è€ƒè™‘ã€‚ç»“è®ºï¼šä¿®å¤åŽå†åˆå¹¶ã€‚"

è¦åšçš„æ˜¯å±‚æ¬¡ 3ã€‚

### 6.2.1 æ¡ä»¶é€»è¾‘ï¼šæ ¹æ®ç»“æžœåšå†³ç­–

æŠ¥å‘Šä¸åªæ˜¯å±•ç¤ºæ•°æ®ï¼Œè¿˜è¦ç»™å‡ºå»ºè®®ã€‚è¿™éœ€è¦æ¡ä»¶é€»è¾‘ï¼š

```
if æœ‰ critical é—®é¢˜:
    verdict = "âŒ ä¸å»ºè®®åˆå¹¶ï¼Œè¯·å…ˆä¿®å¤ä¸¥é‡é—®é¢˜"
elif æœ‰ warning:
    verdict = "âš ï¸ å¯ä»¥åˆå¹¶ï¼Œä½†å»ºè®®å…³æ³¨ä»¥ä¸‹è­¦å‘Š"
else:
    verdict = "âœ… å®¡æŸ¥é€šè¿‡ï¼Œå¯ä»¥åˆå¹¶"
```

è¿™ç§"æ ¹æ®ä¸Šæ¸¸ç»“æžœå†³å®šä¸‹æ¸¸è¡Œä¸º"çš„æ¨¡å¼ï¼Œåœ¨ workflow ç¼–æŽ’ä¸­éžå¸¸å¸¸è§ã€‚

---

## 6.3 å®žæ“å¤çŽ°ï¼šå®žçŽ°æŠ¥å‘Šç”Ÿæˆå™¨

### Step 1: å®šä¹‰æŠ¥å‘Šæ•°æ®ç»“æž„

**review_bot/reporter.py**:

```python
"""Report generator â€” aggregates review results."""
from dataclasses import dataclass, field
from enum import Enum

from .agents.base import ReviewIssue


class Verdict(Enum):
    PASS = "pass"
    WARN = "warn"
    FAIL = "fail"


@dataclass
class Report:
    """Structured review report."""

    issues: list[ReviewIssue] = field(default_factory=list)
    agent_errors: list[str] = field(default_factory=list)

    @property
    def verdict(self) -> Verdict:
        if any(i.severity == "critical" for i in self.issues):
            return Verdict.FAIL
        if any(i.severity == "warning" for i in self.issues):
            return Verdict.WARN
        return Verdict.PASS
```

### Step 2: å®žçŽ° Markdown æŠ¥å‘Šæ¸²æŸ“

```python
VERDICT_DISPLAY = {
    Verdict.PASS: "âœ… å®¡æŸ¥é€šè¿‡ï¼Œå¯ä»¥åˆå¹¶",
    Verdict.WARN: "âš ï¸ å¯ä»¥åˆå¹¶ï¼Œä½†è¯·å…³æ³¨ä»¥ä¸‹è­¦å‘Š",
    Verdict.FAIL: "âŒ ä¸å»ºè®®åˆå¹¶ï¼Œè¯·å…ˆä¿®å¤ä¸¥é‡é—®é¢˜",
}


def render_markdown(report: Report) -> str:
    """Render report as Markdown."""
    lines = ["# Code Review Report", ""]
    lines.append(f"**Verdict**: {VERDICT_DISPLAY[report.verdict]}")
    lines.append("")

    # Group issues by severity
    for severity in ("critical", "warning", "info"):
        matched = [i for i in report.issues if i.severity == severity]
        if not matched:
            continue
        lines.append(f"## {severity.upper()} ({len(matched)})")
        lines.append("")
        for issue in matched:
            loc = f"{issue.file_path}:{issue.line}" if issue.line else issue.file_path
            lines.append(f"- **{loc}**: {issue.description}")
            lines.append(f"  - Suggestion: {issue.suggestion}")
        lines.append("")

    if report.agent_errors:
        lines.append("## Agent Errors")
        for err in report.agent_errors:
            lines.append(f"- {err}")

    return "\n".join(lines)
```

### Step 3: æŽ¥å…¥ CLI â€” `report` å­å‘½ä»¤

æŠ¥å‘Šç”Ÿæˆå™¨éœ€è¦ä¸€ä¸ª CLI å…¥å£ï¼Œè®© `/review-bot` skill èƒ½é€šè¿‡ç®¡é“è°ƒç”¨ï¼š

```python
# review_bot/cli.py ä¸­æ–°å¢ž report å­å‘½ä»¤

@app.command()
def report(
    issues_json: str = typer.Option(
        None, "--issues", help="JSON array of issues (or read from stdin)",
    ),
) -> None:
    """Generate a Markdown review report from JSON issues."""
    if issues_json:
        raw = issues_json
    else:
        raw = sys.stdin.read()

    data = json.loads(raw)
    issues = [
        ReviewIssue(
            severity=item.get("severity", "info"),
            file_path=item.get("file", "unknown"),
            line=item.get("line"),
            description=item.get("description", ""),
            suggestion=item.get("suggestion", ""),
        )
        for item in data
    ]
    result = Report(issues=issues)
    typer.echo(render_markdown(result))
```

è¿™æ · `/review-bot` skill çš„æœ€åŽä¸€æ­¥å°±èƒ½ç›´æŽ¥è°ƒç”¨ï¼š

```bash
echo '[{"severity":"critical","file":"parser.c","line":42,...}]' | review-bot report
```

> âš ï¸ **æž¶æž„è¦ç‚¹**ï¼š`report` å­å‘½ä»¤ä»Ž stdin è¯»å– JSON æ•°ç»„ï¼Œè¾“å‡º Markdown æŠ¥å‘Šã€‚å®ƒæ˜¯çº¯å·¥å…·å±‚â€”â€”ä¸å…³å¿ƒ JSON ä»Žå“ªæ¥ï¼ˆå¯ä»¥æ˜¯ 4 ä¸ªå¹¶è¡Œ agent çš„åˆå¹¶ç»“æžœï¼Œä¹Ÿå¯ä»¥æ˜¯æ‰‹åŠ¨æž„é€ çš„æµ‹è¯•æ•°æ®ï¼‰ã€‚è¿™ç§è®¾è®¡è®©å®ƒå¯ç‹¬ç«‹æµ‹è¯•ã€å¯å¤ç”¨ã€‚

> âš ï¸ **æ³¨æ„ CLI ç”¨æ³•å˜åŒ–**ï¼šæ·»åŠ  `report` åŽï¼Œtyper ä»Žå•å‘½ä»¤è‡ªåŠ¨æå‡æ¨¡å¼åˆ‡æ¢ä¸ºå¤šå‘½ä»¤å­å‘½ä»¤æ¨¡å¼ã€‚ä¹‹å‰ `review-bot HEAD~1` çš„ç”¨æ³•çŽ°åœ¨å˜æˆäº† `review-bot diff HEAD~1`ã€‚è¿™æ˜¯ typer çš„é»˜è®¤è¡Œä¸ºâ€”â€”åªæœ‰ä¸€ä¸ªå‘½ä»¤æ—¶è‡ªåŠ¨æå‡ï¼Œä¸¤ä¸ªä»¥ä¸Šæ—¶æ˜¾ç¤ºå­å‘½ä»¤åˆ—è¡¨ã€‚

ç”Ÿæˆçš„æŠ¥å‘Šé•¿è¿™æ ·ï¼š

```markdown
# Code Review Report

**Verdict**: âŒ ä¸å»ºè®®åˆå¹¶ï¼Œè¯·å…ˆä¿®å¤ä¸¥é‡é—®é¢˜

## CRITICAL (1)

- **parser.c:42**: Buffer overflow â€” read() writes 256 bytes into 64-byte buffer
  - Suggestion: Use bounded read: read(sock, buf, sizeof(buf) - 1)

## WARNING (2)

- **conn_pool.c:15**: malloc in loop without free on error path
  - Suggestion: Add cleanup label with goto for error handling
- **http.c:88**: Unchecked return value from snprintf (possible truncation)
  - Suggestion: Check return value and handle truncation

## INFO (3)

- **config.h:5**: Magic number 8192
  - Suggestion: Use named constant MAX_BUFFER_SIZE
```

---

## 6.4 æç‚¼æ¨¡æ¿ï¼šç»“æžœèšåˆæ¨¡å¼

```
1. æ”¶é›†å¤šä¸ªæ¥æºçš„ç»“æžœ
   â†“
2. æ ‡å‡†åŒ–ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰
   â†“
3. åˆ†ç±»æŽ’åºï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
   â†“
4. æ¡ä»¶åˆ¤æ–­ï¼ˆç»™å‡ºæ•´ä½“è¯„ä¼°ï¼‰
   â†“
5. æ¸²æŸ“è¾“å‡ºï¼ˆMarkdown / JSON / HTMLï¼‰
```

å…³é”®è®¾è®¡å†³ç­–ï¼š**ç»Ÿä¸€è¾“å‡ºæ ¼å¼è¦åœ¨ agent è®¾è®¡é˜¶æ®µå°±å®šå¥½**ï¼ˆCh4 åšçš„ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨èšåˆé˜¶æ®µå†åŽ»é€‚é…ã€‚

### 6.4.1 ç»“æžœåŽ»é‡

å››ä¸ª agent ç‹¬ç«‹è¿è¡Œï¼ˆCh5 çš„è®¾è®¡å†³ç­–ï¼‰ï¼Œå¶å°”ä¼šå‘çŽ°åŒä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚å®‰å…¨ agent å’Œé€»è¾‘ agent éƒ½æ ‡è®°äº†"æœªå¤„ç†çš„å¼‚å¸¸"ã€‚

ç®€å•çš„åŽ»é‡ç­–ç•¥ï¼šå¦‚æžœä¸¤ä¸ª issue çš„ `file_path` å’Œ `line` ç›¸åŒï¼Œä¿ç•™ severity æ›´é«˜çš„é‚£ä¸ªã€‚

```python
def deduplicate(issues: list[ReviewIssue]) -> list[ReviewIssue]:
    """Remove duplicate issues, keeping the highest severity."""
    severity_rank = {"critical": 3, "warning": 2, "info": 1}
    seen: dict[tuple[str, int | None], ReviewIssue] = {}
    for issue in issues:
        key = (issue.file_path, issue.line)
        if key not in seen or severity_rank.get(issue.severity, 0) > severity_rank.get(seen[key].severity, 0):
            seen[key] = issue
    return list(seen.values())
```

> ðŸ’¡ **Tip**: åŽ»é‡ä¸æ˜¯å¿…é¡»çš„ã€‚æœ‰äº›å›¢é˜Ÿæ›´å–œæ¬¢ä¿ç•™æ‰€æœ‰ agent çš„åŽŸå§‹è¾“å‡ºï¼Œè®©äººæ¥åˆ¤æ–­æ˜¯å¦é‡å¤ã€‚æ ¹æ®ä½ çš„åœºæ™¯é€‰æ‹©ã€‚

### 6.4.2 JSON è¾“å‡º

Ch1 çš„è®¾è®¡å†³ç­–ä¸­é€‰äº†"Markdown ç»™äººçœ‹ï¼ŒJSON ç»™ç¨‹åºç”¨"ã€‚JSON è¾“å‡ºæ–¹ä¾¿ä¸‹æ¸¸å·¥å…·æ¶ˆè´¹ï¼ˆæ¯”å¦‚ CI/CD æµæ°´çº¿æ ¹æ® verdict å†³å®šæ˜¯å¦é˜»æ–­åˆå¹¶ï¼‰ï¼š

```python
import json

def render_json(report: Report) -> str:
    """Render report as JSON for programmatic consumption."""
    return json.dumps({
        "verdict": report.verdict.value,
        "issue_count": len(report.issues),
        "issues": [
            {
                "severity": i.severity,
                "file": i.file_path,
                "line": i.line,
                "description": i.description,
                "suggestion": i.suggestion,
            }
            for i in report.issues
        ],
    }, indent=2, ensure_ascii=False)
```

---

## 6.5 å°ç»“

- ç»“æžœèšåˆä¸åªæ˜¯æ‹¼æŽ¥ï¼Œè¦åˆ†ç±»ã€æŽ’åºã€ç»™å‡ºæ•´ä½“åˆ¤æ–­
- æ¡ä»¶é€»è¾‘è®© workflow èƒ½æ ¹æ®ç»“æžœåšå†³ç­–
- ç»Ÿä¸€çš„è¾“å‡ºæ ¼å¼æ˜¯èšåˆçš„å‰æâ€”â€”åœ¨ agent è®¾è®¡é˜¶æ®µå°±è¦å®šå¥½

---

# Ch7: Hooks ä¸Ž Skills â€” commit æ—¶è‡ªåŠ¨è§¦å‘å®¡æŸ¥

> æœ€å¥½çš„å·¥å…·æ˜¯ä½ æ„Ÿè§‰ä¸åˆ°å®ƒå­˜åœ¨çš„å·¥å…·ã€‚

**æœ¯è¯­**

- Hookï¼ˆé’©å­ï¼Œåœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨è§¦å‘çš„å›žè°ƒæœºåˆ¶ï¼‰
- Skillï¼ˆæŠ€èƒ½ï¼ŒClaude Code ä¸­å¯å¤ç”¨çš„ prompt æ¨¡æ¿ï¼Œç”¨ `/` è§¦å‘ï¼‰
- Lintï¼ˆä»£ç é™æ€æ£€æŸ¥ï¼Œè‡ªåŠ¨å‘çŽ°é£Žæ ¼å’Œæ½œåœ¨é”™è¯¯ï¼‰
- Regexï¼ˆRegular Expressionï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ–‡æœ¬æ¨¡å¼åŒ¹é…è¯­æ³•ï¼‰
- Matcherï¼ˆåŒ¹é…å™¨ï¼ŒHook ä¸­ç”¨äºŽç­›é€‰ç›®æ ‡å·¥å…·çš„è¿‡æ»¤æ¡ä»¶ï¼‰

**æœ¬ç« æ–°æ¦‚å¿µ**

| æ¦‚å¿µ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------------|
| Hook | æ¯æ¬¡æäº¤éƒ½è¦æ‰‹åŠ¨è·‘å®¡æŸ¥ï¼Œæ€»æ˜¯å¿˜â€”â€”äº‹ä»¶è§¦å‘ï¼Œcommit ä¸€æäº¤è‡ªåŠ¨æ‰§è¡Œ |
| Skill | åŒæ ·çš„å®¡æŸ¥æµç¨‹æ¯æ¬¡éƒ½è¦é‡æ–°æè¿°ä¸€éâ€”â€”å°è£…æˆ `/review-bot` ä¸€æ¡å‘½ä»¤æžå®š |

## 7.1 åœºæ™¯å¼•å…¥

åˆ°è¿™ä¸€æ­¥ï¼ŒReview Bot å·²ç»èƒ½è·‘äº†ã€‚ä½†æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨è¾“å…¥ `/review-bot`ï¼Œå°±åƒæœ‰äº†æ´—ç¢—æœºå´è¿˜è¦æ‰‹åŠ¨æŒ‰å¼€å…³â€”â€”èƒ½ç”¨ï¼Œä½†ä¸å¤Ÿçˆ½ã€‚

å¦‚æžœæ¯æ¬¡ `git commit` çš„æ—¶å€™ï¼Œå®¡æŸ¥è‡ªåŠ¨è·‘èµ·æ¥å‘¢ï¼Ÿä¸ç”¨ä½ è®°å¾—ï¼Œä¸ç”¨ä½ æ“å¿ƒï¼Œcommit ä¸€æäº¤ï¼ŒæŠ¥å‘Šå°±å‡ºæ¥äº†ã€‚

è¿™å°±æ˜¯ **Hooks** å’Œ **Skills** çš„ç”¨æ­¦ä¹‹åœ°ã€‚

---

## 7.2 è®¾è®¡æ€ç»´ï¼šHooks æ˜¯ä»€ä¹ˆï¼Ÿ

Claude Code çš„ Hooks æ˜¯ä¸€ç§**äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨åŒ–æœºåˆ¶**ã€‚ä½ å¯ä»¥é…ç½®ï¼šå½“æŸä¸ªå·¥å…·è¢«è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œä¸€æ®µ shell å‘½ä»¤ã€‚

æ‰“ä¸ªæ¯”æ–¹ï¼šHooks å°±åƒä½ å®¶çš„æ™ºèƒ½å®¶å±…è§„åˆ™â€”â€”"å½“é—¨æ‰“å¼€æ—¶ï¼Œè‡ªåŠ¨å¼€ç¯"ã€‚åœ¨ Claude Code é‡Œå°±æ˜¯"å½“æ–‡ä»¶è¢«ä¿å­˜æ—¶ï¼Œè‡ªåŠ¨è·‘ lint"æˆ–"å½“ commit å‘ç”Ÿæ—¶ï¼Œè‡ªåŠ¨è·‘å®¡æŸ¥"ã€‚

### 7.2.1 Hook çš„å››ç§è§¦å‘æ—¶æœº

| è§¦å‘æ—¶æœº | è¯´æ˜Ž | å…¸åž‹ç”¨é€” |
|---------|------|---------|
| PreToolUse | å·¥å…·è°ƒç”¨**ä¹‹å‰** | æ‹¦æˆªå±é™©æ“ä½œã€å‚æ•°æ ¡éªŒ |
| PostToolUse | å·¥å…·è°ƒç”¨**ä¹‹åŽ** | è‡ªåŠ¨æ ¼å¼åŒ–ã€è‡ªåŠ¨æµ‹è¯• |
| Notification | é€šçŸ¥äº‹ä»¶ | å‘é€æ¶ˆæ¯åˆ° Slack |
| Stop | Agent åœæ­¢æ—¶ | æ¸…ç†ä¸´æ—¶æ–‡ä»¶ |

### 7.2.2 matcher å’Œ pattern æ€Žä¹ˆåŒ¹é…ï¼Ÿ

æ¯æ¡ Hook è§„åˆ™æœ‰ä¸¤ä¸ªè¿‡æ»¤å­—æ®µï¼Œå¿…é¡»åŒæ—¶å‘½ä¸­æ‰ä¼šè§¦å‘ï¼š

| å­—æ®µ | åŒ¹é…å¯¹è±¡ | ç¤ºä¾‹ |
|------|---------|------|
| `matcher` | å·¥å…·åç§°ï¼ˆæ­£åˆ™ï¼‰ | `"Bash"`ã€`"Write\|Edit"` |
| `pattern` | å·¥å…·çš„å…³é”®å‚æ•°ï¼ˆæ­£åˆ™ï¼‰ | `"git commit"`ã€`"\\.py$"` |

`pattern` åŒ¹é…çš„å†…å®¹å–å†³äºŽå·¥å…·ç±»åž‹ï¼š

- **Bash** â†’ åŒ¹é… `command` å­—æ®µï¼ˆå³ shell å‘½ä»¤å­—ç¬¦ä¸²ï¼‰
- **Write / Edit** â†’ åŒ¹é… `file_path` å­—æ®µï¼ˆå³æ“ä½œçš„æ–‡ä»¶è·¯å¾„ï¼‰
- **Read / Glob / Grep** â†’ åŒæ ·åŒ¹é…è·¯å¾„æˆ– pattern å‚æ•°

ä¸¾ä¸ªä¾‹å­ï¼Œ`"matcher": "Bash", "pattern": "git commit"` çš„æ„æ€æ˜¯ï¼šå½“ Claude Code é€šè¿‡ Bash å·¥å…·æ‰§è¡Œçš„å‘½ä»¤ä¸­åŒ…å« `git commit` æ—¶è§¦å‘ã€‚è€Œ `"matcher": "Write|Edit", "pattern": "\\.py$"` çš„æ„æ€æ˜¯ï¼šå½“ Claude Code å†™å…¥æˆ–ç¼–è¾‘ `.py` æ–‡ä»¶æ—¶è§¦å‘ã€‚

### 7.2.3 Skills æ˜¯ä»€ä¹ˆï¼Ÿ

Skills æ˜¯ Claude Code çš„**å¯å¤ç”¨ prompt æ¨¡æ¿**ã€‚ä½ æŠŠä¸€æ®µæ“ä½œæŒ‡ä»¤å†™æˆ Markdown æ–‡ä»¶ï¼Œæ”¾åˆ° `.claude/skills/` ç›®å½•ä¸‹ï¼Œå°±èƒ½ç”¨ `/skill-name` ä¸€é”®è§¦å‘ã€‚

å®ƒçš„å·¥ä½œæœºåˆ¶å¾ˆç®€å•ï¼šå½“ä½ è¾“å…¥ `/review-bot HEAD~3` æ—¶ï¼ŒClaude Code è¯»å–å¯¹åº”çš„ `SKILL.md` æ–‡ä»¶ï¼ŒæŠŠå†…å®¹ä½œä¸º prompt æ³¨å…¥å½“å‰å¯¹è¯ï¼ŒåŒæ—¶æŠŠ `HEAD~3` æ›¿æ¢åˆ° `$ARGUMENTS` å˜é‡çš„ä½ç½®ã€‚æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¸¦å‚æ•°çš„ prompt å¿«æ·æ–¹å¼â€”â€”ä½†è¿™ä¸ª"å¿«æ·æ–¹å¼"å¯ä»¥ç¼–æŽ’å‡ºå®Œæ•´çš„å¤šæ­¥éª¤å·¥ä½œæµã€‚

### 7.2.4 Claude Code çš„ä¸‰ä¸ªè‡ªå®šä¹‰ç›®å½•

Claude Code æä¾›äº†ä¸‰ä¸ªç›®å½•æ¥æ‰©å±•èƒ½åŠ›ï¼Œå®¹æ˜“æ··æ·†ï¼š

| ç›®å½• | ç”¨é€” | è§¦å‘æ–¹å¼ |
|------|------|---------|
| `.claude/skills/` | ç”¨æˆ·å¯è°ƒç”¨çš„ Skillï¼ˆprompt æ¨¡æ¿ï¼‰ | ç”¨ `/skill-name` æ‰‹åŠ¨è§¦å‘ï¼Œæˆ– Claude åˆ¤æ–­ç›¸å…³æ—¶è‡ªåŠ¨åº”ç”¨ |
| `.claude/agents/` | è‡ªå®šä¹‰ Agent å®šä¹‰ | ä½œä¸º subagent è¢«è°ƒç”¨ |
| `.claude/rules/` | é¡¹ç›®è§„åˆ™ï¼ˆè‡ªåŠ¨åŠ è½½ï¼‰ | æ¯æ¬¡ä¼šè¯è‡ªåŠ¨ç”Ÿæ•ˆ |

- **skills/** é‡Œçš„ `SKILL.md` æ—¢å¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼ˆ`/review-bot`ï¼‰ï¼Œä¹Ÿå¯ä»¥è¢«åŠ¨ç”Ÿæ•ˆï¼ˆClaude å‘çŽ°å½“å‰ä»»åŠ¡ç›¸å…³æ—¶è‡ªåŠ¨åº”ç”¨ï¼‰ã€‚åŠ  `disable-model-invocation: true` å¯ä»¥é™åˆ¶ä¸ºä»…æ‰‹åŠ¨è§¦å‘
- **agents/** é‡Œçš„å®šä¹‰ç”¨äºŽåˆ›å»ºä¸“é—¨çš„ subagentï¼Œåœ¨ç‹¬ç«‹ä¸Šä¸‹æ–‡ä¸­è¿è¡Œ
- **rules/** é‡Œçš„è§„åˆ™æ¯æ¬¡ä¼šè¯è‡ªåŠ¨åŠ è½½ï¼Œé€‚åˆæ”¾ä»£ç é£Žæ ¼ã€æµ‹è¯•è¦æ±‚ç­‰çº¦æŸ

> ðŸ’¡ **Tip**: `/review-bot` åŠ äº† `disable-model-invocation: true`ï¼Œåªèƒ½æ‰‹åŠ¨è§¦å‘ã€‚å¦‚æžœä½ æœ‰ä¸€äº›"Claude å†™ä»£ç æ—¶åº”è¯¥è‡ªåŠ¨éµå®ˆçš„è§„èŒƒ"ï¼Œæ”¾åœ¨ `rules/` æ›´åˆé€‚ã€‚

---

## 7.3 å®žæ“å¤çŽ°ï¼šé…ç½®è‡ªåŠ¨å®¡æŸ¥æµæ°´çº¿

### Step 1: é…ç½® Hook â€” commit åŽè‡ªåŠ¨å®¡æŸ¥

åœ¨é¡¹ç›®çš„ `.claude/settings.json` ä¸­æ·»åŠ  hook é…ç½®ï¼š

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Bash",
        "pattern": "git commit",
        "command": "echo 'HOOK: Auto-review triggered after commit'"
      }
    ]
  }
}
```

è¿™ä¸ªé…ç½®çš„æ„æ€æ˜¯ï¼šå½“ Claude Code é€šè¿‡ Bash å·¥å…·æ‰§è¡Œäº†åŒ…å« `git commit` çš„å‘½ä»¤åŽï¼Œè‡ªåŠ¨æ‰“å°ä¸€æ¡æç¤ºã€‚

å®žé™…é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥æŠŠ `echo` æ¢æˆå·¥å…·å±‚çš„ diff æ‘˜è¦å‘½ä»¤ï¼Œè®© commit åŽç«‹åˆ»çœ‹åˆ°å˜æ›´æ¦‚è§ˆï¼š

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Bash",
        "pattern": "git commit",
        "command": "review-bot diff HEAD~1 2>/dev/null | head -1 || true"
      }
    ]
  }
}
```

æ³¨æ„ï¼šå®Œæ•´çš„å®¡æŸ¥æµç¨‹ï¼ˆå¹¶è¡Œ 4 ä¸ª agentï¼‰åº”è¯¥é€šè¿‡ `/review-bot` skill è§¦å‘ï¼Œè€Œä¸æ˜¯æ”¾åœ¨ Hook é‡Œã€‚Hook é€‚åˆè½»é‡çº§çš„è‡ªåŠ¨åŒ–ï¼ˆæ ¼å¼åŒ–ã€lintã€æ‘˜è¦ï¼‰ï¼Œé‡é‡çº§çš„ç¼–æŽ’äº¤ç»™ Skillã€‚

> âš ï¸ **è¸©å‘æé†’**: Hook çš„ command æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚å¦‚æžœå®¡æŸ¥è€—æ—¶è¾ƒé•¿ï¼Œä¼šé˜»å¡ž Claude Code çš„åŽç»­æ“ä½œã€‚å¯¹äºŽè€—æ—¶ä»»åŠ¡ï¼Œè€ƒè™‘åœ¨ command æœ«å°¾åŠ  `&` è®©å®ƒåŽå°è¿è¡Œã€‚

### Step 2: åˆ›å»ºè‡ªå®šä¹‰ Skill

Skill çš„åˆ›å»ºè§„åˆ™å¾ˆç®€å•ï¼š

1. åœ¨ `.claude/skills/` ä¸‹åˆ›å»ºä¸€ä¸ªä»¥ skill åå‘½åçš„ç›®å½•
2. ç›®å½•å†…æ”¾ä¸€ä¸ª `SKILL.md` æ–‡ä»¶â€”â€”`skills/review-bot/SKILL.md` å¯¹åº” `/review-bot`
3. æ–‡ä»¶å¼€å¤´åŠ  YAML frontmatterï¼ˆname, descriptionï¼‰ï¼Œæ­£æ–‡æ˜¯ promptï¼Œæ”¯æŒ `$ARGUMENTS` å˜é‡
4. åµŒå¥—ç›®å½•ä¹Ÿå¯ä»¥â€”â€”`skills/db/migrate/SKILL.md` å¯¹åº” `/db:migrate`

å†…ç½®å˜é‡ï¼š

| å˜é‡ | å«ä¹‰ |
|------|------|
| `$ARGUMENTS` | ç”¨æˆ·åœ¨ `/command` åŽé¢è¾“å…¥çš„æ‰€æœ‰å‚æ•° |

æ¥åˆ›å»º `/review-bot` skillï¼š

**`.claude/skills/review-bot/SKILL.md`**:

```markdown
Run a C/C++ code review workflow. Follow each step exactly.

## Step 1: Get the diff
review-bot diff $ARGUMENTS

Capture the FULL output. The raw diff after the `---` separator is what agents review.
If empty, stop and report "No changes to review."

## Step 2: Fan-out â€” 4 parallel review agents
Launch exactly 4 Task tool calls IN PARALLEL. Each Task must:
- Use subagent_type: "general-purpose"
- Include the COMPLETE agent prompt below (do NOT tell the agent to read a file)
- Append the full diff content at the end

**Task 1 â€” Security:**
> You are a C/C++ security expert. Focus ONLY on security and memory safety.
> Ignore style, performance, logic. Check for: buffer overflow, use-after-free,
> format string vulnerabilities, integer overflow, null pointer dereference.
> Output one JSON object per line (no code fences):
> {"severity":"critical|warning|info","file":"<path>","line":<n>,"description":"...","suggestion":"..."}

**Task 2 â€” Performance:**
> You are a C/C++ performance engineer. Focus ONLY on performance.
> Ignore security, style, logic. Check for: memory leaks, unnecessary heap allocations
> in loops, cache-unfriendly access, unnecessary copies, missing reserve(), blocking I/O.
> Output one JSON object per line (no code fences):
> {"severity":"critical|warning|info","file":"<path>","line":<n>,"description":"...","suggestion":"..."}

**Task 3 â€” Style:**
> You are a C/C++ style reviewer. Focus ONLY on style and readability.
> Ignore security, performance, logic. Check for: missing/inconsistent header guards,
> const correctness, raw new/delete vs RAII, naming conventions, include order, magic numbers.
> Output one JSON object per line (no code fences):
> {"severity":"critical|warning|info","file":"<path>","line":<n>,"description":"...","suggestion":"..."}

**Task 4 â€” Logic:**
> You are a C/C++ logic reviewer. Focus ONLY on correctness.
> Ignore security, performance, style. Check for: undefined behavior, signed/unsigned
> mismatch, off-by-one errors, resource leaks on error paths, unchecked return values,
> incorrect pointer arithmetic.
> Output one JSON object per line (no code fences):
> {"severity":"critical|warning|info","file":"<path>","line":<n>,"description":"...","suggestion":"..."}

## Step 3: Fan-in â€” collect and merge
Extract all lines starting with `{` from each agent's response. Merge into JSON array.

## Step 4: Generate report
echo '<merged_json_array>' | review-bot report
```

çŽ°åœ¨è¾“å…¥ `/review-bot HEAD~3`ï¼ŒClaude Code è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼ŒæŠŠ `$ARGUMENTS` æ›¿æ¢ä¸º `HEAD~3`ï¼Œç„¶åŽæŒ‰æ­¥éª¤æ‰§è¡Œâ€”â€”èŽ·å– diffã€å¹¶è¡Œæ´¾å‡º 4 ä¸ª agentã€æ”¶é›†ç»“æžœã€ç”ŸæˆæŠ¥å‘Šã€‚

> âš ï¸ **è¸©å‘æé†’ï¼šPrompt å¿…é¡»å†…è”**ï¼šæ³¨æ„ Step 2 ä¸­æ¯ä¸ª agent çš„ prompt æ˜¯å®Œæ•´å†™åœ¨ skill æ–‡ä»¶é‡Œçš„ï¼Œè€Œä¸æ˜¯"è¯»å– `.claude/agents/security-reviewer.md`"ã€‚å› ä¸ºæ¯ä¸ª subagent æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œçœ‹ä¸åˆ°ä¸» agent è¯»è¿‡çš„æ–‡ä»¶ã€‚è¿™æ˜¯å®žè·µä¸­æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯â€”â€”å¦‚æžœä½ å†™"å‚è€ƒä¹‹å‰çš„ prompt"ï¼Œsubagent ä¼šä¸€è„¸èŒ«ç„¶ã€‚

å†æ¥å‡ ä¸ªå®žç”¨ç¤ºä¾‹ï¼š

**`.claude/skills/test/SKILL.md`** â€” æ™ºèƒ½è·‘æµ‹è¯•ï¼š

```markdown
Run tests related to the current changes.

1. Check git diff to identify changed files
2. Find test files that cover the changed code
3. Run only the relevant tests: pytest $ARGUMENTS -x -q
4. If any test fails, analyze the failure and suggest a fix
```

**`.claude/skills/audit/SKILL.md`** â€” å®‰å…¨å®¡è®¡ï¼š

```markdown
Perform a security audit on $ARGUMENTS (default: the entire project).

Focus on:
- Input validation and sanitization
- Authentication and authorization checks
- SQL injection, XSS, command injection
- Hardcoded secrets or credentials
- Insecure dependencies

Output a markdown report sorted by severity.
```

**Skill ç¼–å†™æœ€ä½³å®žè·µ**ï¼š

- ç”¨è‹±æ–‡å†™ promptï¼ˆClaude å¯¹è‹±æ–‡æŒ‡ä»¤çš„éµå¾ªåº¦æ›´é«˜ï¼‰ï¼Œæ³¨é‡Šå¯ä»¥ç”¨ä¸­æ–‡
- ç¬¬ä¸€è¡Œå†™æ¸…æ¥šè¿™ä¸ª skill åšä»€ä¹ˆâ€”â€”Claude ä¼šæŠŠå®ƒå½“ä½œä»»åŠ¡ç›®æ ‡
- æ­¥éª¤è¦å…·ä½“ã€‚"review the code" å¤ªæ¨¡ç³Šï¼Œ"launch 4 parallel review agents" æ‰æœ‰å¯æ“ä½œæ€§
- ç”¨ `$ARGUMENTS` æä¾›çµæ´»æ€§ï¼ŒåŒæ—¶å†™æ˜Žé»˜è®¤å€¼ï¼ˆå¦‚ `default: HEAD~1`ï¼‰
- ä¸è¦åœ¨ skill é‡Œç¡¬ç¼–ç è·¯å¾„æˆ–é¡¹ç›®åâ€”â€”è®©å®ƒä¿æŒé€šç”¨ï¼Œé¡¹ç›®ç‰¹å®šçš„é…ç½®æ”¾ CLAUDE.md

### Step 3: æ›´å¤šå®žç”¨ Hook ç¤ºä¾‹

**è‡ªåŠ¨æ ¼å¼åŒ–ï¼šå†™å®Œæ–‡ä»¶è‡ªåŠ¨è·‘ black**

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "pattern": "\\.py$",
        "command": "file_path=$(cat | jq -r '.tool_input.file_path // empty') && [ -n \"$file_path\" ] && black \"$file_path\" 2>/dev/null || true"
      }
    ]
  }
}
```

Hook é€šè¿‡ stdin æŽ¥æ”¶ JSON ä¸Šä¸‹æ–‡ï¼ˆè§ Step 4ï¼‰ï¼Œç”¨ `jq` æå– `file_path` åŽä¼ ç»™ `black`ã€‚

**åˆ†æ”¯ä¿æŠ¤ï¼šé˜»æ­¢ç›´æŽ¥ commit åˆ° main**

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "pattern": "git commit",
        "command": "branch=$(git branch --show-current) && [ \"$branch\" != 'main' ] || (echo 'BLOCKED: Do not commit to main' && exit 1)"
      }
    ]
  }
}
```

PreToolUse hook è¿”å›žéžé›¶é€€å‡ºç æ—¶ï¼Œä¼š**é˜»æ­¢**å·¥å…·è°ƒç”¨ã€‚è¿™å°±å®žçŽ°äº†"åœ¨ main åˆ†æ”¯ä¸Šç¦æ­¢ commit"çš„ä¿æŠ¤ã€‚

### Step 4: Hook è°ƒè¯•æŠ€å·§

Hook å‡ºé—®é¢˜æ—¶ä¸å¤ªå¥½æŽ’æŸ¥â€”â€”å®ƒåœ¨åŽå°é™é»˜æ‰§è¡Œï¼Œæ²¡æœ‰æ˜Žæ˜¾çš„é”™è¯¯æç¤ºã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå®žç”¨çš„è°ƒè¯•æ–¹æ³•ï¼š

**1. ç”¨æ—¥å¿—æ–‡ä»¶è®°å½• Hook æ‰§è¡Œ**

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "pattern": "\\.py$",
        "command": "input=$(cat) && file_path=$(echo "$input" | jq -r '.tool_input.file_path // empty') && echo \"$(date): Hook triggered for $file_path\" >> /tmp/hook-debug.log && black \"$file_path\" 2>&1 | tee -a /tmp/hook-debug.log"
      }
    ]
  }
}
```

è·‘å®ŒåŽæŸ¥çœ‹ `/tmp/hook-debug.log`ï¼Œå°±èƒ½çœ‹åˆ° Hook æ˜¯å¦è¢«è§¦å‘ã€æ‰§è¡Œäº†ä»€ä¹ˆã€æœ‰æ²¡æœ‰æŠ¥é”™ã€‚

**2. Hook çš„è¾“å…¥æœºåˆ¶ï¼šstdin JSON**

Claude Code æ‰§è¡Œ Hook æ—¶ï¼Œä¼šé€šè¿‡ **stdin** ä¼ å…¥ä¸€ä¸ª JSON å¯¹è±¡ï¼ŒåŒ…å«å·¥å…·è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä½ çš„ Hook è„šæœ¬éœ€è¦ä»Ž stdin è¯»å–è¿™ä¸ª JSON æ¥èŽ·å–è¯¦ç»†ä¿¡æ¯ï¼š

```bash
#!/bin/bash
# ä»Ž stdin è¯»å– JSON è¾“å…¥
input=$(cat)
tool_name=$(echo "$input" | jq -r '.tool_name')
file_path=$(echo "$input" | jq -r '.tool_input.file_path // empty')
echo "Hook triggered: $tool_name on $file_path"
```

stdin JSON çš„å…¸åž‹ç»“æž„ï¼š

```json
{
  "tool_name": "Write",
  "tool_input": {
    "file_path": "/home/user/project/app.py",
    "content": "..."
  }
}
```

> âš ï¸ **è¸©å‘æé†’**: Hook çš„ command æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œä¼šé˜»å¡ž Claude Code çš„åŽç»­æ“ä½œã€‚å¦‚æžœä½ çš„ Hook å‘½ä»¤è€—æ—¶è¾ƒé•¿ï¼ˆæ¯”å¦‚è·‘å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼‰ï¼Œè€ƒè™‘åœ¨æœ«å°¾åŠ  `&` è®©å®ƒåŽå°è¿è¡Œï¼Œæˆ–è€…ç”¨ `timeout 10s` é™åˆ¶æ‰§è¡Œæ—¶é—´ã€‚

**3. å…ˆç”¨ echo æµ‹è¯• matcher å’Œ pattern**

ä¸ç¡®å®š Hook èƒ½ä¸èƒ½åŒ¹é…åˆ°ï¼Ÿå…ˆæŠŠ command æ¢æˆ `echo`ï¼š

```json
{
  "command": "cat | jq . && echo 'HOOK FIRED'"
}
```

çœ‹åˆ° JSON è¾“å‡ºäº†ï¼Œè¯´æ˜Ž Hook åŒ¹é…æˆåŠŸï¼Œå†æ¢æˆçœŸæ­£çš„å‘½ä»¤ã€‚

---

## 7.4 æç‚¼æ¨¡æ¿ï¼šè‡ªåŠ¨åŒ–æµæ°´çº¿æ¨¡å¼

```
äº‹ä»¶è§¦å‘ï¼ˆHookï¼‰
   â†“
é¢„å¤„ç†ï¼ˆPreToolUse: æ ¡éªŒã€æ‹¦æˆªï¼‰
   â†“
æ ¸å¿ƒæ“ä½œï¼ˆå·¥å…·è°ƒç”¨ï¼‰
   â†“
åŽå¤„ç†ï¼ˆPostToolUse: æ ¼å¼åŒ–ã€æµ‹è¯•ã€å®¡æŸ¥ï¼‰
```

### 7.4.1 Skill å¿«é€Ÿå‚è€ƒ

```
åˆ›å»º:  .claude/skills/<name>/SKILL.md  â†’  /<name> è§¦å‘
å­ç›®å½•: .claude/skills/db/migrate/SKILL.md  â†’  /db:migrate è§¦å‘
å˜é‡:  $ARGUMENTS â€” ç”¨æˆ·è¾“å…¥çš„å‚æ•°
æ ¼å¼:  YAML frontmatterï¼ˆname, descriptionï¼‰+ æ­£æ–‡å†™æ­¥éª¤
```

### 7.4.2 å°† Skill å®‰è£…åˆ°å…¶ä»–é¡¹ç›®

é¡¹ç›®æä¾›äº†å®‰è£…è„šæœ¬ï¼ˆ`install.sh` / `install.bat`ï¼‰ï¼Œå¯ä»¥æŠŠ skill æ¨¡æ¿æ‰¹é‡å®‰è£…åˆ°ç›®æ ‡é¡¹ç›®ï¼š

```bash
# macOS / Linux
./examples/commands/install.sh ~/projects/my-app

# Windows
examples\commands\install.bat C:\projects\my-app
```

è„šæœ¬ä¼šæŠŠ `SKILL.md` æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡é¡¹ç›®çš„ `.claude/skills/` ç›®å½•ä¸‹ï¼Œå·²å­˜åœ¨çš„æ–‡ä»¶ä¼šè·³è¿‡ã€‚

---

## 7.5 å°ç»“

- Hooks æ˜¯äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨åŒ–ï¼šå·¥å…·è°ƒç”¨å‰åŽè‡ªåŠ¨æ‰§è¡Œ shell å‘½ä»¤
- Hook é€šè¿‡ stdin JSON æŽ¥æ”¶å·¥å…·è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- PreToolUse å¯ä»¥æ‹¦æˆªå±é™©æ“ä½œï¼ŒPostToolUse å¯ä»¥è‡ªåŠ¨åŽå¤„ç†
- Skills æ˜¯å¯å¤ç”¨çš„ prompt æ¨¡æ¿ï¼š`.claude/skills/<name>/SKILL.md` åˆ›å»ºï¼Œç”¨ `/name` è§¦å‘
- Skill ç”¨ `$ARGUMENTS` æŽ¥æ”¶å‚æ•°ï¼Œç¬¬ä¸€è¡Œå†™ç›®æ ‡ï¼ŒåŽé¢åˆ—å…·ä½“æ­¥éª¤
- ä¸‰ä¸ªè‡ªå®šä¹‰ç›®å½•å„æœ‰åˆ†å·¥ï¼š`commands/`ï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰ã€`skills/`ï¼ˆè‡ªåŠ¨åº”ç”¨ï¼‰ã€`agents/`ï¼ˆsubagent å®šä¹‰ï¼‰

---

# Ch8: æµ‹è¯•é©±åŠ¨ â€” è°æ¥å®¡æŸ¥å®¡æŸ¥è€…ï¼Ÿ

> ä½ å†™äº†ä¸€ä¸ªå®¡æŸ¥ä»£ç çš„å·¥å…·ï¼Œä½†è¿™ä¸ªå·¥å…·æœ¬èº«çš„ä»£ç è°æ¥å®¡æŸ¥ï¼Ÿ

**æœ¯è¯­**

- TDDï¼ˆTest-Driven Developmentï¼Œæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ŒRedâ†’Greenâ†’Refactor å¾ªçŽ¯ï¼‰
- Pytestï¼ˆPython ä¸»æµæµ‹è¯•æ¡†æž¶ï¼‰
- Fixtureï¼ˆæµ‹è¯•å¤¹å…·ï¼Œé¢„ç½®çš„æµ‹è¯•æ•°æ®æˆ–çŽ¯å¢ƒï¼‰
- Mockï¼ˆæ¨¡æ‹Ÿå¯¹è±¡ï¼Œæ›¿ä»£çœŸå®žä¾èµ–çš„å‡å®žçŽ°ï¼‰
- Regressionï¼ˆå›žå½’ï¼Œä¿®æ”¹ä»£ç åŽæ—§åŠŸèƒ½æ„å¤–æŸåï¼‰
- CIï¼ˆContinuous Integrationï¼ŒæŒç»­é›†æˆï¼‰

**æœ¬ç« æ–°æ¦‚å¿µ**

| æ¦‚å¿µ | è§£å†³ä»€ä¹ˆé—®é¢˜ |
|------|------------|
| TDD with AI | è®© AI æ”¹ä»£ç æ€»æ€•æ”¹åä¸œè¥¿â€”â€”å…ˆå†™æµ‹è¯•å½“å®‰å…¨ç½‘ï¼Œæ”¹åäº†æµ‹è¯•ä¼šå‘Šè¯‰ä½  |
| Verification Loop | AI è¯´"æžå®šäº†"ä½†ä½ ä¸æ•¢ä¿¡â€”â€”ç»™å®ƒéªŒè¯æ‰‹æ®µï¼Œè®©å®ƒè‡ªå·±ç¡®è®¤åšå¯¹äº† |

## 8.1 åœºæ™¯å¼•å…¥

Review Bot å·²ç»èƒ½è‡ªåŠ¨å®¡æŸ¥ä»£ç äº†ã€‚ä½†æœ‰ä¸ªå°´å°¬çš„é—®é¢˜ï¼šå¦‚æžœ diff è§£æžå™¨æœ‰ bugï¼ŒæŠŠæ–°å¢žè¡Œå½“æˆåˆ é™¤è¡Œå‘¢ï¼Ÿå¦‚æžœæŠ¥å‘Šç”Ÿæˆå™¨æ¼æŽ‰äº† critical çº§åˆ«çš„é—®é¢˜å‘¢ï¼Ÿ

å·¥å…·æœ¬èº«çš„è´¨é‡ï¼Œå†³å®šäº†å®¡æŸ¥ç»“æžœçš„å¯ä¿¡åº¦ã€‚è¿™ä¸€ç« ç»™ Review Bot åŠ ä¸Šæµ‹è¯•ï¼Œå¹¶ç”¨ Claude Code çš„ agent ç¼–æŽ’æ¥è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹ã€‚

---

## 8.2 è®¾è®¡æ€ç»´ï¼šéªŒè¯ä¼˜å…ˆ â€” æœ€é«˜æ æ†çš„å®žè·µ

å®˜æ–¹æ–‡æ¡£æŠŠ"ç»™ Claude ä¸€ç§éªŒè¯è‡ªå·±å·¥ä½œçš„æ–¹å¼"åˆ—ä¸º**æœ€é«˜æ æ†**çš„æ“ä½œã€‚æ„æ€æ˜¯ï¼šä¸è¦åªå‘Šè¯‰ Claude åšä»€ä¹ˆï¼Œè¿˜è¦å‘Šè¯‰å®ƒæ€Žä¹ˆç¡®è®¤åšå¯¹äº†ã€‚

### 8.2.1 åœ¨ Prompt ä¸­æä¾›éªŒè¯æ ‡å‡†

**âŒ æ²¡æœ‰éªŒè¯æ ‡å‡†**ï¼š
```
å¸®æˆ‘å®žçŽ° diff è§£æžå™¨ã€‚
```

**âœ… å¸¦éªŒè¯æ ‡å‡†**ï¼š
```
å¸®æˆ‘å®žçŽ° diff è§£æžå™¨ã€‚
éªŒè¯æ ‡å‡†ï¼š
1. è¿è¡Œ pytest tests/test_diff_parser.py -x å…¨éƒ¨é€šè¿‡
2. ç©º diff è¾“å…¥è¿”å›žç©º DiffResultï¼ˆfiles åˆ—è¡¨ä¸ºç©ºï¼‰
3. å¤šæ–‡ä»¶ diff èƒ½æ­£ç¡®æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ FileChange
```

å¸¦éªŒè¯æ ‡å‡†çš„ prompt è®© Claude èƒ½è‡ªæˆ‘æ£€æŸ¥â€”â€”å®žçŽ°å®ŒåŽå®ƒä¼šä¸»åŠ¨è·‘æµ‹è¯•ã€éªŒè¯è¾¹ç•Œæƒ…å†µï¼Œè€Œä¸æ˜¯å†™å®Œå°±äº¤å·®ã€‚

### 8.2.2 éªŒè¯çš„ä¸‰ä¸ªå±‚æ¬¡

| å±‚æ¬¡ | æ–¹å¼ | ç¤ºä¾‹ |
|------|------|------|
| è‡ªåŠ¨åŒ–éªŒè¯ | æµ‹è¯•å¥—ä»¶ã€linterã€ç±»åž‹æ£€æŸ¥ | `pytest`ã€`ruff check`ã€`mypy` |
| ç»“æž„åŒ–éªŒè¯ | åœ¨ prompt ä¸­å†™æ˜Žé¢„æœŸè¾“å‡º | "è¾“å…¥ X åº”è¯¥è¿”å›ž Y" |
| äººå·¥éªŒè¯ | å®¡æŸ¥ Claude çš„è¾“å‡º | æ£€æŸ¥ç”Ÿæˆçš„æŠ¥å‘Šæ˜¯å¦åˆç† |

> ðŸ’¡ **Tip**: åœ¨ CLAUDE.md çš„ Rules ä¸­åŠ å…¥éªŒè¯ç›¸å…³æŒ‡ä»¤ï¼Œè®© Claude å…»æˆ"åšå®Œå°±éªŒè¯"çš„ä¹ æƒ¯ï¼š
> ```markdown
> ## Rules
> - After implementing any function, run its tests immediately
> - Before committing, run `pytest tests/ -x -q` and `ruff check .`
> ```

---

## 8.3 è®¾è®¡æ€ç»´ï¼šæµ‹è¯•ç­–ç•¥

### 8.3.1 è¯¥æµ‹ä»€ä¹ˆï¼Ÿ

Review Bot æœ‰å››ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—çš„æµ‹è¯•é‡ç‚¹ä¸åŒï¼š

| æ¨¡å— | æµ‹è¯•é‡ç‚¹ | æµ‹è¯•ç±»åž‹ |
|------|---------|---------|
| diff_parser | èƒ½æ­£ç¡®è§£æžå„ç§ diff æ ¼å¼ | å•å…ƒæµ‹è¯• |
| agents | prompt ç”Ÿæˆæ­£ç¡®ã€è¾“å‡ºæ ¼å¼ç¬¦åˆé¢„æœŸ | å•å…ƒæµ‹è¯• |
| scheduler | `parse_agent_output` èƒ½ä»Žè‡ªç”±æ–‡æœ¬ä¸­æå– JSON issue | å•å…ƒæµ‹è¯• |
| reporter | èšåˆé€»è¾‘æ­£ç¡®ã€verdict åˆ¤æ–­å‡†ç¡® | å•å…ƒæµ‹è¯• |
| æ•´ä½“æµç¨‹ | ä»Ž diff åˆ°æŠ¥å‘Šçš„å®Œæ•´é“¾è·¯ | é›†æˆæµ‹è¯• |

### 8.3.2 ç”¨ Agent å†™æµ‹è¯•

è¿˜è®°å¾— Ch0 ä»‹ç»çš„ **TDD with AI** å¼€å‘æ¨¡å¼å—ï¼Ÿæ ¸å¿ƒå¾ªçŽ¯æ˜¯ Red â†’ Green â†’ Refactorï¼ŒAI åœ¨æ¯ä¸ªé˜¶æ®µéƒ½èƒ½å¸®å¿™ã€‚åœ¨ Review Bot çš„åœºæ™¯é‡Œå¯ä»¥è¿™æ ·ç”¨ï¼š

```
1. Red:   ä½ æè¿°æœŸæœ›è¡Œä¸º â†’ Claude Code ç”Ÿæˆæµ‹è¯•ï¼ˆæ­¤æ—¶æµ‹è¯•åº”è¯¥å¤±è´¥ï¼‰
2. Green: Claude Code å†™æœ€å°å®žçŽ°è®©æµ‹è¯•é€šè¿‡
3. Refactor: Claude Code é‡æž„ä»£ç ï¼Œæµ‹è¯•ä¿è¯ä¸ç ´ååŠŸèƒ½
```

å…·ä½“æ€Žä¹ˆè®© Claude Code å†™æµ‹è¯•ï¼Ÿprompt çš„è´¨é‡å†³å®šæµ‹è¯•çš„è´¨é‡ï¼š

**âŒ å¤ªæ¨¡ç³Šçš„ prompt**ï¼š
```
å¸®æˆ‘å†™ diff_parser çš„æµ‹è¯•ã€‚
```

**âœ… å¥½çš„ prompt**ï¼š
```
å¸®æˆ‘ä¸º review_bot/diff_parser.py å†™å•å…ƒæµ‹è¯•ã€‚
è¦æ±‚ï¼š
1. ç”¨ pytestï¼Œæµ‹è¯•æ•°æ®ç”¨ fixture
2. è¦†ç›–ä»¥ä¸‹åœºæ™¯ï¼š
   - æ­£å¸¸çš„å•æ–‡ä»¶ diffï¼ˆæœ‰å¢žæœ‰åˆ ï¼‰
   - å¤šæ–‡ä»¶ diff
   - ç©º diff
   - åªæœ‰æ–°å¢žã€åªæœ‰åˆ é™¤
   - äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆåº”è·³è¿‡ï¼‰
3. æ¯ä¸ªæµ‹è¯•å‡½æ•°åªæµ‹ä¸€ä»¶äº‹
4. æµ‹è¯•å‘½åç”¨ test_<åŠŸèƒ½>_<åœºæ™¯> æ ¼å¼
```

Claude Code ä¼šå…ˆç”¨ Explore agent è¯»å–æºä»£ç ï¼Œç†è§£é€»è¾‘ï¼Œç„¶åŽç”Ÿæˆæµ‹è¯•ã€‚å®ƒå¾€å¾€èƒ½æƒ³åˆ°ä½ å¿½ç•¥çš„è¾¹ç•Œæƒ…å†µâ€”â€”å› ä¸ºå®ƒä¼šç³»ç»Ÿæ€§åœ°éåŽ†ä»£ç è·¯å¾„ï¼Œè€Œäººå®¹æ˜“åªæµ‹ happy pathã€‚

> ðŸ’¡ **Tip**: è®© AI å†™æµ‹è¯•æ—¶ï¼Œå…ˆè·‘ä¸€éçœ‹çœ‹æ˜¯å¦å…¨éƒ¨é€šè¿‡ã€‚å¦‚æžœå…¨éƒ¨é€šè¿‡ï¼Œåè€Œè¦è­¦æƒ•â€”â€”å¯èƒ½æµ‹è¯•å†™å¾—å¤ªå®½æ¾äº†ã€‚å¥½çš„æµ‹è¯•åº”è¯¥åœ¨ä»£ç æœ‰ bug æ—¶èƒ½å¤±è´¥ã€‚

---

## 8.4 å®žæ“å¤çŽ°ï¼šä¸º Review Bot æ·»åŠ æµ‹è¯•

### Step 1: diff_parser å•å…ƒæµ‹è¯•

**tests/test_diff_parser.py**:

```python
"""Tests for diff parser."""
import pytest

from review_bot.diff_parser import FileChange, DiffResult, parse_diff


SAMPLE_DIFF = """\
diff --git a/parser.c b/parser.c
index abc1234..def5678 100644
--- a/parser.c
+++ b/parser.c
@@ -1,3 +1,5 @@
 #include <stdio.h>
+#include <stdlib.h>
+#include <string.h>

 void parse()
-    return;
+    printf("parsing");
"""


def test_parse_diff_file_count():
    result = parse_diff(SAMPLE_DIFF)
    assert len(result.files) == 1
    assert result.files[0].path == "parser.c"


def test_parse_diff_additions():
    result = parse_diff(SAMPLE_DIFF)
    assert result.files[0].additions == 3  # sys, json, print


def test_parse_diff_deletions():
    result = parse_diff(SAMPLE_DIFF)
    assert result.files[0].deletions == 1  # pass


def test_parse_diff_empty():
    result = parse_diff("")
    assert len(result.files) == 0
    assert result.total_additions == 0


def test_summary():
    result = parse_diff(SAMPLE_DIFF)
    assert "1 files changed" in result.summary
```

### Step 2: reporter å•å…ƒæµ‹è¯•

**tests/test_reporter.py**:

```python
"""Tests for report generator."""
from review_bot.agents.base import ReviewIssue
from review_bot.reporter import Report, Verdict, render_markdown


def _make_issue(severity: str = "warning") -> ReviewIssue:
    return ReviewIssue(
        severity=severity,
        file_path="parser.c",
        line=10,
        description="test issue",
        suggestion="fix it",
    )


def test_verdict_pass():
    report = Report(issues=[])
    assert report.verdict == Verdict.PASS


def test_verdict_warn():
    report = Report(issues=[_make_issue("warning")])
    assert report.verdict == Verdict.WARN


def test_verdict_fail():
    report = Report(issues=[_make_issue("critical")])
    assert report.verdict == Verdict.FAIL


def test_render_markdown_contains_verdict():
    report = Report(issues=[_make_issue("critical")])
    md = render_markdown(report)
    assert "CRITICAL" in md
    assert "parser.c:10" in md
```

### Step 3: æµ‹è¯• Agent Prompt çš„è¾“å‡º

Agent çš„ prompt æ˜¯ Review Bot çš„æ ¸å¿ƒèµ„äº§ã€‚æ€Žä¹ˆæµ‹è¯• prompt ç”Ÿæˆæ˜¯å¦æ­£ç¡®ï¼Ÿ

**tests/test_agents.py**:

```python
"""Tests for review agents."""
from review_bot.agents.registry import (
    SECURITY_AGENT,
    PERFORMANCE_AGENT,
    STYLE_AGENT,
    LOGIC_AGENT,
    ALL_AGENTS,
)


FAKE_DIFF = "diff --git a/parser.c b/parser.c\n+#include <stdlib.h>\n"


def test_all_agents_registered():
    assert len(ALL_AGENTS) == 4


def test_agent_names_unique():
    names = [a.name for a in ALL_AGENTS]
    assert len(names) == len(set(names))


def test_build_prompt_injects_diff():
    prompt = SECURITY_AGENT.build_prompt(FAKE_DIFF)
    assert FAKE_DIFF in prompt
    assert "security" in prompt.lower()


def test_each_agent_has_output_format():
    """Every agent prompt must specify the output format."""
    for agent in ALL_AGENTS:
        prompt = agent.build_prompt(FAKE_DIFF)
        assert "severity" in prompt, f"{agent.name} missing severity format"
        assert "suggestion" in prompt, f"{agent.name} missing suggestion format"


def test_each_agent_has_boundary():
    """Every agent prompt must have a 'Focus ONLY' boundary."""
    for agent in ALL_AGENTS:
        prompt = agent.build_prompt(FAKE_DIFF)
        assert "Focus ONLY" in prompt, f"{agent.name} missing focus boundary"
```

æ³¨æ„æœ€åŽä¸¤ä¸ªæµ‹è¯•â€”â€”å®ƒä»¬ä¸æ˜¯æµ‹ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯æµ‹ **prompt çš„ç»“æž„çº¦æŸ**ã€‚Ch4 ä¸­è¯´è¿‡ï¼Œå¥½çš„ agent prompt å¿…é¡»æœ‰ç»Ÿä¸€è¾“å‡ºæ ¼å¼å’Œæ˜Žç¡®è¾¹ç•Œã€‚è¿™ä¸¤ä¸ªæµ‹è¯•å°±æ˜¯æŠŠè¿™äº›è®¾è®¡åŽŸåˆ™å˜æˆäº†å¯æ‰§è¡Œçš„æ–­è¨€ã€‚

> âš ï¸ **è¸©å‘æé†’**: ä¸è¦è¯•å›¾æµ‹è¯• LLM çš„è¾“å‡ºå†…å®¹ï¼ˆæ¯”å¦‚"å®‰å…¨ agent åº”è¯¥èƒ½å‘çŽ° buffer overflow"ï¼‰ã€‚LLM è¾“å‡ºæ˜¯éžç¡®å®šæ€§çš„ï¼Œè¿™ç±»æµ‹è¯•ä¼šæ—¶è¿‡æ—¶ä¸è¿‡ã€‚åªæµ‹ä½ èƒ½æŽ§åˆ¶çš„éƒ¨åˆ†ï¼šprompt ç”Ÿæˆã€æ•°æ®ç»“æž„ã€èšåˆé€»è¾‘ã€‚

### Step 4: æµ‹è¯• Agent è¾“å‡ºè§£æž

`parse_agent_output` æ˜¯è¿žæŽ¥ LLM è¾“å‡ºå’Œç»“æž„åŒ–æ•°æ®çš„æ¡¥æ¢â€”â€”å®ƒä»Ž agent çš„è‡ªç”±æ–‡æœ¬ä¸­æå– JSON issueã€‚è¿™ä¸ªå‡½æ•°å¿…é¡»è¶³å¤Ÿå¥å£®ï¼Œå› ä¸º LLM è¾“å‡ºä¸æ€»æ˜¯å®Œç¾Žçš„ã€‚

**tests/test_scheduler.py**:

```python
"""Tests for agent output parsing and result aggregation."""
from review_bot.scheduler import parse_agent_output, ReviewSession


def test_parse_valid_json_lines():
    """Extract JSON issues from mixed text output."""
    raw = """Reviewing the code for security issues...
{"severity":"critical","file":"parser.c","line":42,"description":"buffer overflow","suggestion":"use bounded read"}
Some explanation text here.
{"severity":"warning","file":"conn.c","line":10,"description":"unchecked return","suggestion":"check retval"}
No more issues found."""
    result = parse_agent_output("security", raw)
    assert result.agent_name == "security"
    assert len(result.issues) == 2
    assert result.issues[0].severity == "critical"
    assert result.issues[1].file_path == "conn.c"


def test_parse_no_issues():
    """Agent found nothing â€” should return empty list."""
    raw = "No security issues detected."
    result = parse_agent_output("security", raw)
    assert len(result.issues) == 0
    assert result.error is None


def test_parse_invalid_json_skipped():
    """Malformed JSON lines should be silently skipped."""
    raw = '{"severity":"critical","file":"a.c"\n{"broken json\nnot json at all'
    result = parse_agent_output("security", raw)
    # Both lines starting with { are invalid, should be skipped
    assert len(result.issues) == 0


def test_review_session_has_critical():
    """ReviewSession.has_critical aggregates across agents."""
    r1 = parse_agent_output("security", '{"severity":"critical","file":"a.c","line":1,"description":"x","suggestion":"y"}')
    r2 = parse_agent_output("style", "No style issues detected.")
    session = ReviewSession(results=[r1, r2])
    assert session.has_critical is True
    assert len(session.all_issues) == 1
```

è¿™ç»„æµ‹è¯•è¦†ç›–äº†ä¸‰ä¸ªå…³é”®åœºæ™¯ï¼šæ­£å¸¸æå–ã€ç©ºè¾“å‡ºã€ç•¸å½¢ JSONã€‚æ³¨æ„ `test_parse_invalid_json_skipped` â€”â€”LLM æœ‰æ—¶ä¼šè¾“å‡ºä¸å®Œæ•´çš„ JSONï¼Œè§£æžå™¨å¿…é¡»å®¹é”™è€Œä¸æ˜¯å´©æºƒã€‚

### Step 5: é›†æˆæµ‹è¯• â€” ä»Ž diff åˆ°æŠ¥å‘Šçš„å®Œæ•´é“¾è·¯

å•å…ƒæµ‹è¯•éªŒè¯æ¯ä¸ªé›¶ä»¶ï¼Œé›†æˆæµ‹è¯•éªŒè¯é›¶ä»¶ç»„è£…åŽèƒ½ä¸èƒ½è·‘ã€‚

**tests/test_integration.py**:

```python
"""Integration tests â€” full pipeline from diff to report."""
from review_bot.agents.base import ReviewIssue
from review_bot.diff_parser import parse_diff
from review_bot.reporter import Report, Verdict, render_markdown


MULTI_FILE_DIFF = """\
diff --git a/parser.c b/parser.c
--- a/parser.c
+++ b/parser.c
@@ -1,2 +1,3 @@
 #include <stdio.h>
+#include <stdlib.h>
diff --git a/conn_pool.c b/conn_pool.c
--- a/conn_pool.c
+++ b/conn_pool.c
@@ -5,3 +5,2 @@
-old_alloc()
+new_alloc()
"""


def test_full_pipeline_pass():
    """No issues â†’ PASS verdict."""
    diff = parse_diff(MULTI_FILE_DIFF)
    assert len(diff.files) == 2

    report = Report(issues=[])
    assert report.verdict == Verdict.PASS
    md = render_markdown(report)
    assert "é€šè¿‡" in md


def test_full_pipeline_fail():
    """Critical issue â†’ FAIL verdict with details in report."""
    diff = parse_diff(MULTI_FILE_DIFF)

    issues = [
        ReviewIssue(
            severity="critical",
            file_path=diff.files[0].path,
            line=2,
            description="Buffer overflow â€” read() exceeds buffer size",
            suggestion="Use bounded read with sizeof(buf)",
        )
    ]
    report = Report(issues=issues)
    assert report.verdict == Verdict.FAIL

    md = render_markdown(report)
    assert "CRITICAL" in md
    assert "parser.c:2" in md
    assert "Buffer overflow" in md
```

é›†æˆæµ‹è¯•çš„å…³é”®ï¼šç”¨çœŸå®žçš„æ•°æ®ç»“æž„èµ°å®Œæ•´æ¡é“¾è·¯ï¼Œè€Œä¸æ˜¯ mock æŽ‰ä¸­é—´çŽ¯èŠ‚ã€‚

### Step 6: ç”¨ Hook è‡ªåŠ¨è·‘æµ‹è¯•

åœ¨ `.claude/settings.json` ä¸­æ·»åŠ æµ‹è¯• hookï¼š

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "pattern": "review_bot/.*\\.py$",
        "command": "pytest tests/ -x -q 2>&1 | tail -5"
      }
    ]
  }
}
```

æ¯æ¬¡ Claude Code ä¿®æ”¹äº† `review_bot/` ä¸‹çš„ Python æ–‡ä»¶ï¼Œè‡ªåŠ¨è·‘æµ‹è¯•ã€‚`-x` é‡åˆ°ç¬¬ä¸€ä¸ªå¤±è´¥å°±åœï¼Œ`-q` ç²¾ç®€è¾“å‡ºï¼Œ`tail -5` åªæ˜¾ç¤ºæœ€åŽå‡ è¡Œç»“æžœã€‚

### 8.4.7 AI å†™æµ‹è¯•çš„å¸¸è§é™·é˜±

è®© Claude Code å†™æµ‹è¯•å¾ˆæ–¹ä¾¿ï¼Œä½†æœ‰å‡ ä¸ªå‘è¦æ³¨æ„ï¼š

**é™·é˜± 1ï¼šæµ‹è¯•åªéªŒè¯å½“å‰å®žçŽ°ï¼Œä¸éªŒè¯é¢„æœŸè¡Œä¸º**

```python
# âŒ è¿™ä¸ªæµ‹è¯•åªæ˜¯"æ‹äº†ä¸ªå¿«ç…§"ï¼Œä¸æ˜¯åœ¨éªŒè¯è¡Œä¸º
def test_summary():
    result = parse_diff(SAMPLE_DIFF)
    assert result.summary == "1 files changed, 3 additions, 1 deletions"
```

å¦‚æžœ summary æ ¼å¼æ”¹äº†ï¼ˆæ¯”å¦‚ "1 file changed" åŽ»æŽ‰å¤æ•° sï¼‰ï¼Œè¿™ä¸ªæµ‹è¯•å°±ä¼šå¤±è´¥â€”â€”ä½†åŠŸèƒ½å…¶å®žæ²¡é—®é¢˜ã€‚æ›´å¥½çš„å†™æ³•ï¼š

```python
# âœ… éªŒè¯å…³é”®ä¿¡æ¯å­˜åœ¨ï¼Œä¸ç»‘å®šå…·ä½“æ ¼å¼
def test_summary_contains_key_info():
    result = parse_diff(SAMPLE_DIFF)
    assert "1" in result.summary  # file count
    assert "3" in result.summary  # additions
```

**é™·é˜± 2ï¼šè¿‡åº¦ mock å¯¼è‡´æµ‹è¯•æ²¡æœ‰æ„ä¹‰**

```python
# âŒ mock æŽ‰äº†æ‰€æœ‰ä¸œè¥¿ï¼Œæµ‹è¯•ç­‰äºŽä»€ä¹ˆéƒ½æ²¡æµ‹
def test_review(mocker):
    mocker.patch("review_bot.diff_parser.get_diff", return_value="")
    mocker.patch("review_bot.diff_parser.parse_diff", return_value=DiffResult())
    # ... è¿™æµ‹çš„æ˜¯ä»€ä¹ˆï¼Ÿ
```

åŽŸåˆ™ï¼šåª mock å¤–éƒ¨ä¾èµ–ï¼ˆgit å‘½ä»¤ã€ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œä¸ mock è‡ªå·±çš„ä»£ç ã€‚

**é™·é˜± 3ï¼šAI ç”Ÿæˆçš„æµ‹è¯•æ•°æ®å¤ª"å®Œç¾Ž"**

AI å€¾å‘äºŽç”Ÿæˆæ ¼å¼å®Œç¾Žçš„æµ‹è¯•æ•°æ®ã€‚ä½†çœŸå®žä¸–ç•Œçš„ diff å¯èƒ½æœ‰ä¹±ç ã€è¶…é•¿è¡Œã€æ··åˆç¼–ç ã€‚æ‰‹åŠ¨åŠ å‡ ä¸ª"è„æ•°æ®"æµ‹è¯•ç”¨ä¾‹ï¼š

```python
def test_parse_diff_with_unicode():
    """Real diffs may contain non-ASCII characters."""
    diff = 'diff --git a/ä¸­æ–‡.py b/ä¸­æ–‡.py\n+print("ä½ å¥½")\n'
    result = parse_diff(diff)
    assert result.files[0].path == "ä¸­æ–‡.py"
```

### 8.4.8 æµ‹è¯•é©±åŠ¨çš„ Bug ä¿®å¤æµç¨‹

å½“ç”¨æˆ·æŠ¥å‘Š Review Bot æœ‰ bug æ—¶ï¼Œç”¨ TDD æµç¨‹ä¿®å¤ï¼š

```
1. å¤çŽ°ï¼šå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç²¾ç¡®æè¿° bug
   â†“
2. ç¡®è®¤çº¢ç¯ï¼šè·‘æµ‹è¯•ï¼Œç¡®è®¤æ–°æµ‹è¯•ç¡®å®žå¤±è´¥
   â†“
3. ä¿®å¤ï¼šè®© Claude Code ä¿®å¤ä»£ç ï¼Œç›´åˆ°æµ‹è¯•é€šè¿‡
   â†“
4. å›žå½’ï¼šè·‘å…¨é‡æµ‹è¯•ï¼Œç¡®è®¤æ²¡æœ‰ç ´åå…¶ä»–åŠŸèƒ½
```

åœ¨ Claude Code ä¸­çš„å®žé™…æ“ä½œï¼š

```
ç”¨æˆ·æŠ¥å‘Šï¼šå½“ diff ä¸­æœ‰æ–‡ä»¶é‡å‘½åæ—¶ï¼Œparse_diff ä¼šå´©æºƒã€‚

è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤ä¿®å¤ï¼š
1. å…ˆåœ¨ tests/test_diff_parser.py ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ
   ç”¨åŒ…å« rename çš„ diff æ•°æ®ï¼ŒéªŒè¯ parse_diff ä¸ä¼šå´©æºƒ
2. è·‘æµ‹è¯•ç¡®è®¤å®ƒå¤±è´¥
3. ä¿®æ”¹ parse_diff è®©æµ‹è¯•é€šè¿‡
4. è·‘å…¨é‡æµ‹è¯•ç¡®è®¤æ²¡æœ‰å›žå½’
```

è¿™ä¸ªæµç¨‹çš„å¥½å¤„ï¼šbug ä¿®å¤åŽï¼Œæµ‹è¯•ç”¨ä¾‹æ°¸è¿œç•™åœ¨é‚£é‡Œï¼Œé˜²æ­¢åŒä¸€ä¸ª bug å†æ¬¡å‡ºçŽ°ã€‚

---

## 8.5 æç‚¼æ¨¡æ¿ï¼šæµ‹è¯•å·¥ä½œæµæ¨¡å¼

```
1. å†™ä»£ç 
   â†“
2. Hook è‡ªåŠ¨è§¦å‘æµ‹è¯•
   â†“
3. æµ‹è¯•å¤±è´¥ â†’ Agent è‡ªåŠ¨ä¿®å¤ â†’ é‡æ–°æµ‹è¯•
   æµ‹è¯•é€šè¿‡ â†’ ç»§ç»­ä¸‹ä¸€æ­¥
```

åœ¨ CLAUDE.md ä¸­åŠ å…¥æµ‹è¯•ç›¸å…³æŒ‡ä»¤ï¼š

```markdown
## Testing Rules
- Run `pytest tests/ -x -q` after any code change
- All tests must pass before committing
- New features must include tests
- Test edge cases: empty input, null values, boundary conditions
```

---

## 8.6 å°ç»“

- **éªŒè¯ä¼˜å…ˆ**æ˜¯æœ€é«˜æ æ†çš„å®žè·µâ€”â€”åœ¨ prompt ä¸­æä¾›éªŒè¯æ ‡å‡†ï¼Œè®© Claude èƒ½è‡ªæˆ‘æ£€æŸ¥
- æµ‹è¯•æ˜¯å·¥å…·å¯ä¿¡åº¦çš„åŸºç¡€â€”â€”å®¡æŸ¥åˆ«äººä»£ç çš„å·¥å…·ï¼Œè‡ªå·±çš„ä»£ç æ›´è¦ç»å¾—èµ·å®¡æŸ¥
- TDD with AIï¼šç”¨ Red â†’ Green â†’ Refactor å¾ªçŽ¯ï¼ŒAI åœ¨æ¯ä¸ªé˜¶æ®µéƒ½èƒ½åŠ é€Ÿ
- æµ‹è¯•åˆ†å±‚ï¼šå•å…ƒæµ‹è¯•éªŒè¯é›¶ä»¶ï¼Œé›†æˆæµ‹è¯•éªŒè¯ç»„è£…ï¼Œprompt æµ‹è¯•éªŒè¯è®¾è®¡çº¦æŸ
- åªæµ‹ä½ èƒ½æŽ§åˆ¶çš„ï¼šæ•°æ®ç»“æž„ã€èšåˆé€»è¾‘ã€prompt ç»“æž„ã€‚ä¸è¦æµ‹ LLM çš„è¾“å‡ºå†…å®¹
- Hook è‡ªåŠ¨è·‘æµ‹è¯• + CLAUDE.md æµ‹è¯•è§„åˆ™ = æ”¹å®Œä»£ç ç«‹åˆ»çŸ¥é“æœ‰æ²¡æœ‰ç ´åä»€ä¹ˆ
- AI å†™æµ‹è¯•çš„ä¸‰ä¸ªé™·é˜±ï¼šå¿«ç…§å¼æ–­è¨€ã€è¿‡åº¦ mockã€å®Œç¾Žæµ‹è¯•æ•°æ®

---

# Ch9: å…­ç§ç¼–æŽ’æ¨¡å¼ â€” ä»Žä¸€ä¸ªé¡¹ç›®åˆ°ä¸€å¥—æ–¹æ³•è®º

> åšå®Œä¸€ä¸ªé¡¹ç›®ä¸ç®—æœ¬äº‹ï¼Œèƒ½æŠŠç»éªŒå˜æˆå¯å¤ç”¨çš„æ¨¡æ¿æ‰æ˜¯çœŸåŠŸå¤«ã€‚

**æœ¯è¯­**

- Orchestrationï¼ˆç¼–æŽ’ï¼ŒæŒ‰é€»è¾‘ç»„ç»‡å¤šä¸ª Agent ååŒå·¥ä½œï¼‰
- CI/CDï¼ˆContinuous Integration/Continuous Deliveryï¼ŒæŒç»­é›†æˆ/æŒç»­äº¤ä»˜ï¼‰
- PRDï¼ˆProduct Requirements Documentï¼Œäº§å“éœ€æ±‚æ–‡æ¡£ï¼‰
- CRUDï¼ˆCreate/Read/Update/Deleteï¼Œå¢žåˆ æ”¹æŸ¥ï¼‰
- Pipelineï¼ˆæµæ°´çº¿ï¼Œæ•°æ®ä¾æ¬¡æµç»å¤šä¸ªå¤„ç†é˜¶æ®µçš„æ¨¡å¼ï¼‰

## 9.1 åœºæ™¯å¼•å…¥

Review Bot å®Œå·¥äº†ã€‚å›žå¤´çœ‹çœ‹ï¼Œæž„å»ºè¿‡ç¨‹ä¸­ç”¨åˆ°äº†è¿™äº›ç¼–æŽ’æ¨¡å¼ï¼š

- é¡ºåºå·¥ä½œæµï¼ˆCh2: æ­è„šæ‰‹æž¶ï¼‰
- Explore Agentï¼ˆCh3: ç†è§£å˜æ›´ï¼‰
- Agent è®¾è®¡ï¼ˆCh4: ä¸“ä¸šåŒ–åˆ†å·¥ï¼‰
- Fan-out / Fan-inï¼ˆCh5: å¹¶è¡Œå®¡æŸ¥ï¼‰
- ç»“æžœèšåˆï¼ˆCh6: æŠ¥å‘Šç”Ÿæˆï¼‰
- Hooks + Skillsï¼ˆCh7: è‡ªåŠ¨åŒ–ï¼‰
- æµ‹è¯•å·¥ä½œæµï¼ˆCh8: è´¨é‡ä¿éšœï¼‰

è¿™äº›æ¨¡å¼ä¸åªé€‚ç”¨äºŽ Code Reviewã€‚å®ƒä»¬æ˜¯é€šç”¨çš„ workflow ç¼–æŽ’æ¨¡å¼ï¼Œå¯ä»¥å¥—ç”¨åˆ°ä»»ä½•åœºæ™¯ã€‚

---

## 9.2 æ¨¡å¼æ€»ç»“

### æ¨¡å¼ 1: Sequentialï¼ˆé¡ºåºæ‰§è¡Œï¼‰

```
A â†’ B â†’ C â†’ D
```

**é€‚ç”¨åœºæ™¯**: æ­¥éª¤ä¹‹é—´æœ‰ä¸¥æ ¼ä¾èµ–ï¼ŒåŽä¸€æ­¥éœ€è¦å‰ä¸€æ­¥çš„è¾“å‡ºã€‚

**Review Bot ä¸­çš„åº”ç”¨**: æ­å»ºè„šæ‰‹æž¶ï¼ˆåˆ›å»ºé…ç½® â†’ ç”Ÿæˆä»£ç  â†’ å®‰è£…ä¾èµ– â†’ éªŒè¯ï¼‰

**æ¨¡æ¿**:
```
Step 1: [å‡†å¤‡] â†’ éªŒè¯ âœ“
Step 2: [æ‰§è¡Œ] â†’ éªŒè¯ âœ“
Step 3: [æ”¶å°¾] â†’ éªŒè¯ âœ“
```

### æ¨¡å¼ 2: Fan-out / Fan-inï¼ˆåˆ†å‘-æ”¶é›†ï¼‰

```
        â”Œâ”€â”€ Agent A â”€â”€â”
Input â”€â”€â”¼â”€â”€ Agent B â”€â”€â”¼â”€â”€ Aggregate
        â””â”€â”€ Agent C â”€â”€â”˜
```

**é€‚ç”¨åœºæ™¯**: å¤šä¸ªç‹¬ç«‹ä»»åŠ¡å¯ä»¥å¹¶è¡Œï¼Œæœ€åŽæ±‡æ€»ç»“æžœã€‚

**Review Bot ä¸­çš„åº”ç”¨**: 4 ä¸ªå®¡æŸ¥ agent å¹¶è¡Œæ‰§è¡Œï¼Œæ±‡æ€»æŠ¥å‘Šã€‚

**æ¨¡æ¿**:
```
1. å‡†å¤‡å…±äº«è¾“å…¥
2. åŒæ—¶æ´¾å‡º N ä¸ª agentï¼ˆå„è‡ªç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼‰
3. ç­‰å¾…æ‰€æœ‰ agent å®Œæˆ
4. èšåˆç»“æžœ + æ¡ä»¶åˆ¤æ–­
```

### æ¨¡å¼ 3: Exploreï¼ˆæŽ¢ç´¢-ç†è§£ï¼‰

```
ç›®æ ‡ â†’ Explore Agent â†’ ç»“æž„åŒ–ç†è§£ â†’ ä¸‹ä¸€æ­¥å†³ç­–
```

**é€‚ç”¨åœºæ™¯**: é¢å¯¹ä¸ç†Ÿæ‚‰çš„ä»£ç /æ•°æ®ï¼Œéœ€è¦å…ˆç†è§£å†è¡ŒåŠ¨ã€‚

**Review Bot ä¸­çš„åº”ç”¨**: ç”¨ Explore agent ç†è§£ git diff çš„ç»“æž„å’Œå˜æ›´èŒƒå›´ã€‚

**æ¨¡æ¿**:
```
1. æ˜Žç¡®æŽ¢ç´¢ç›®æ ‡ï¼ˆ"ç†è§£ X çš„ç»“æž„"ï¼‰
2. æ´¾å‡º Explore agentï¼ˆåªè¯»ï¼Œä¸ä¿®æ”¹ï¼‰
3. æ”¶é›†æŽ¢ç´¢ç»“æžœ
4. åŸºäºŽç†è§£åšå‡ºå†³ç­–
```

**å…¶ä»–åº”ç”¨**:
- æŽ¥æ‰‹æ–°é¡¹ç›®æ—¶ï¼Œå…ˆæŽ¢ç´¢ä»£ç åº“ç»“æž„
- è°ƒè¯• bug æ—¶ï¼Œå…ˆç†è§£ç›¸å…³æ¨¡å—çš„è°ƒç”¨é“¾
- åšæŠ€æœ¯é€‰åž‹æ—¶ï¼Œå…ˆæŽ¢ç´¢çŽ°æœ‰ä¾èµ–å’Œçº¦æŸ

### æ¨¡å¼ 4: Event-Drivenï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰

```
äº‹ä»¶ â†’ Hook è§¦å‘ â†’ è‡ªåŠ¨æ‰§è¡Œ â†’ åé¦ˆ
```

**é€‚ç”¨åœºæ™¯**: æŸäº›æ“ä½œåº”è¯¥åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ã€‚

**Review Bot ä¸­çš„åº”ç”¨**: commit åŽè‡ªåŠ¨è§¦å‘å®¡æŸ¥ï¼Œä»£ç ä¿®æ”¹åŽè‡ªåŠ¨æ ¼å¼åŒ–ã€‚

**æ¨¡æ¿**:
```
1. å®šä¹‰è§¦å‘äº‹ä»¶ï¼ˆå“ªä¸ªå·¥å…·ã€ä»€ä¹ˆæ¨¡å¼ï¼‰
2. PreToolUse: å‰ç½®æ ¡éªŒï¼ˆå¯é€‰ï¼Œå¯æ‹¦æˆªï¼‰
3. æ ¸å¿ƒæ“ä½œæ‰§è¡Œ
4. PostToolUse: åŽç½®å¤„ç†ï¼ˆæ ¼å¼åŒ–ã€æµ‹è¯•ã€é€šçŸ¥ï¼‰
```

**å…¶ä»–åº”ç”¨**:
- å†™å®Œä»£ç è‡ªåŠ¨è·‘ linter
- åˆ›å»ºæ–‡ä»¶æ—¶è‡ªåŠ¨æ·»åŠ  license header
- æ‰§è¡Œå±é™©å‘½ä»¤å‰è‡ªåŠ¨ç¡®è®¤

### æ¨¡å¼ 5: Test-Drivenï¼ˆæµ‹è¯•é©±åŠ¨ï¼‰

```
å†™ä»£ç  â†’ è‡ªåŠ¨æµ‹è¯• â†’ å¤±è´¥ â†’ ä¿®å¤ â†’ é‡æ–°æµ‹è¯• â†’ é€šè¿‡ âœ“
```

**é€‚ç”¨åœºæ™¯**: éœ€è¦æŒç»­éªŒè¯ä»£ç è´¨é‡ï¼Œç¡®ä¿ä¿®æ”¹ä¸ä¼šç ´åå·²æœ‰åŠŸèƒ½ã€‚

**Review Bot ä¸­çš„åº”ç”¨**: Hook è‡ªåŠ¨è·‘ pytestï¼Œå¤±è´¥æ—¶ agent è‡ªåŠ¨ä¿®å¤ã€‚

**æ¨¡æ¿**:
```
1. ç¼–å†™/ä¿®æ”¹ä»£ç 
2. Hook è‡ªåŠ¨è§¦å‘æµ‹è¯•
3. æµ‹è¯•å¤±è´¥ â†’ Agent åˆ†æžé”™è¯¯ â†’ ä¿®å¤ â†’ å›žåˆ° 2
   æµ‹è¯•é€šè¿‡ â†’ ç»§ç»­ä¸‹ä¸€æ­¥
```

### æ¨¡å¼ 6: Specialized Agentï¼ˆä¸“ä¸šåŒ–åˆ†å·¥ï¼‰

```
é€šç”¨ä»»åŠ¡ â†’ æ‹†åˆ†ä¸ºä¸“ä¸šç»´åº¦ â†’ æ¯ä¸ªç»´åº¦ä¸€ä¸ªä¸“å®¶ agent
```

**é€‚ç”¨åœºæ™¯**: ä»»åŠ¡æ¶‰åŠå¤šä¸ªä¸“ä¸šé¢†åŸŸï¼Œå•ä¸ª agent éš¾ä»¥é¢é¢ä¿±åˆ°ã€‚

**Review Bot ä¸­çš„åº”ç”¨**: å®‰å…¨ã€æ€§èƒ½ã€é£Žæ ¼ã€é€»è¾‘å››ä¸ªä¸“ä¸š agentã€‚

**æ¨¡æ¿**:
```
1. è¯†åˆ«ä»»åŠ¡çš„ä¸“ä¸šç»´åº¦
2. ä¸ºæ¯ä¸ªç»´åº¦è®¾è®¡ agentï¼ˆè§’è‰² + èƒ½åŠ› + çº¦æŸï¼‰
3. ç»Ÿä¸€è¾“å‡ºæ ¼å¼ï¼ˆåœ¨è®¾è®¡é˜¶æ®µå°±å®šå¥½ï¼‰
4. ç¼–æŽ’æ‰§è¡Œï¼ˆä¸²è¡Œæˆ–å¹¶è¡Œï¼‰
```

---

## 9.3 æ¨¡å¼ç»„åˆï¼šReview Bot çš„å®Œæ•´ç¼–æŽ’

å›žé¡¾ Review Bot çš„å®Œæ•´æµç¨‹ï¼Œä½ ä¼šå‘çŽ°å®ƒä¸æ˜¯å•ä¸€æ¨¡å¼ï¼Œè€Œæ˜¯å¤šç§æ¨¡å¼çš„ç»„åˆï¼š

```
Planï¼ˆè§„åˆ’ï¼‰
  â†“
Sequentialï¼ˆæ­å»ºè„šæ‰‹æž¶ï¼‰
  â†“
Exploreï¼ˆç†è§£ git diffï¼‰
  â†“
Specialized Agentï¼ˆè®¾è®¡ 4 ä¸ªä¸“å®¶ï¼‰
  â†“
Fan-out / Fan-inï¼ˆå¹¶è¡Œå®¡æŸ¥ + æ±‡æ€»ï¼‰
  â†“
Event-Drivenï¼ˆHook è‡ªåŠ¨è§¦å‘ï¼‰
  â†“
Test-Drivenï¼ˆæŒç»­éªŒè¯è´¨é‡ï¼‰
```

è¿™å°±æ˜¯ workflow ç¼–æŽ’çš„æœ¬è´¨ï¼š**æŠŠç®€å•æ¨¡å¼åƒä¹é«˜ä¸€æ ·æ‹¼èµ·æ¥ï¼Œè§£å†³å¤æ‚é—®é¢˜**ã€‚

### 9.3.1 å¥—ç”¨åˆ°å…¶ä»–åœºæ™¯

| åœºæ™¯ | å¯èƒ½ç”¨åˆ°çš„æ¨¡å¼ç»„åˆ |
|------|--------------------|
| åŠŸèƒ½å¼€å‘ | Explore â†’ Specialized Agent â†’ Sequential â†’ Test-Driven |
| æµ‹è¯•ç”Ÿæˆ | Explore â†’ Fan-out/Fan-in â†’ Test-Driven â†’ Event-Driven |
| å®‰å…¨å®¡è®¡ | Explore â†’ Specialized Agent â†’ Fan-out/Fan-in â†’ Sequential |
| åˆè§„æ£€æµ‹ | Explore â†’ Specialized Agent â†’ Fan-out/Fan-in â†’ Event-Driven |

---

## 9.4 å°ç»“

- 6 ç§æ ¸å¿ƒæ¨¡å¼ï¼šSequentialã€Fan-out/Fan-inã€Exploreã€Event-Drivenã€Test-Drivenã€Specialized Agent
- æ¨¡å¼ä¸æ˜¯å­¤ç«‹çš„ï¼ŒçœŸå®žé¡¹ç›®å¾€å¾€æ˜¯å¤šç§æ¨¡å¼çš„ç»„åˆ
- å…ˆç†è§£æ¯ç§æ¨¡å¼çš„é€‚ç”¨åœºæ™¯ï¼Œå†æ ¹æ®éœ€æ±‚è‡ªç”±ç»„åˆ
- æ¨¡æ¿æ˜¯èµ·ç‚¹ï¼Œä¸æ˜¯ç»ˆç‚¹â€”â€”æ ¹æ®å®žé™…æƒ…å†µè°ƒæ•´

---

# é™„å½•: è¯¾åŽä½œä¸š â€” Workflow å®žæˆ˜

> å­¦å®Œäº†å…¨éƒ¨ç« èŠ‚ï¼Œæ˜¯æ—¶å€™è‡ªå·±åŠ¨æ‰‹äº†ã€‚è¿™æ¬¡æ²¡æœ‰æ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼Œåªæœ‰éœ€æ±‚ã€‚

---

## ä½œä¸šåˆ—è¡¨

4 ä¸ªä½œä¸šè¦†ç›–è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µï¼Œæ¯ä¸ªä½œä¸šä¾§é‡ä¸åŒçš„æ¨¡å¼ç»„åˆï¼š

| # | ä½œä¸š | åœºæ™¯ | æ ¸å¿ƒæ¨¡å¼ |
|---|------|------|----------|
| 1 | Develop Workflow | ä»Žéœ€æ±‚åˆ°å¯è¿è¡Œä»£ç çš„å…¨æµç¨‹ | Explore â†’ Specialized Agent â†’ Sequential â†’ Test-Driven |
| 2 | Test Workflow | è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•å¥—ä»¶å¹¶é©±åŠ¨è´¨é‡é—­çŽ¯ | Explore â†’ Fan-out/Fan-in â†’ Test-Driven â†’ Event-Driven |
| 3 | Security Audit Workflow | æ‰«æé¡¹ç›®å®‰å…¨éšæ‚£å¹¶ç”Ÿæˆå®¡è®¡æŠ¥å‘Š | Explore â†’ Specialized Agent â†’ Fan-out/Fan-in â†’ Sequential |
| 4 | Compliance Test Workflow | æ£€æŸ¥ç»ˆç«¯è®¾å¤‡/ç§»åŠ¨ OS æ˜¯å¦ç¬¦åˆå·¥ä¿¡éƒ¨åŠç½‘ç»œå®‰å…¨æ³•è§„ | Explore â†’ Specialized Agent â†’ Fan-out/Fan-in â†’ Event-Driven |

---

## å…±åŒèƒŒæ™¯

ä½œä¸š 1-3 å…±äº«åŒä¸€ä¸ªç›®æ ‡é¡¹ç›®ï¼šä¸€ä¸ª C/C++ ç½‘ç»œåº“ï¼ŒåŒ…å« HTTP åè®®è§£æžå™¨å’Œ TCP è¿žæŽ¥æ± ï¼Œçº¦ 60 ä¸ªæ–‡ä»¶ï¼Œ12000 è¡Œä»£ç ã€‚ä½œä¸š 4 çš„ç›®æ ‡é¡¹ç›®æ˜¯ä¸€ä¸ªå›½äº§ç§»åŠ¨æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿçº§ç»„ä»¶ï¼ˆåŒæ ·æ˜¯ C/C++ å®žçŽ°ï¼‰ã€‚

ä½ å¯ä»¥ç”¨ä»»ä½•çŽ°æœ‰çš„å¼€æºé¡¹ç›®ä½œä¸ºç»ƒä¹ å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ­ä¸€ä¸ªæœ€å°éª¨æž¶ã€‚

---

## å»ºè®®é¡ºåº

1. å…ˆåš **Develop Workflow**â€”â€”æœ€åŸºç¡€çš„ Sequential ç¼–æŽ’ï¼Œæµç¨‹å›ºå®šï¼Œå¸®ä½ çƒ­èº«
2. å†åš **Test Workflow**â€”â€”åŠ å…¥ Fan-out å’Œ Test-Driven å¾ªçŽ¯ï¼Œéœ€è¦è‡ªå·±å†³å®šæµ‹è¯•ç”Ÿæˆçš„æ‹†åˆ†ç­–ç•¥
3. ç„¶åŽåš **Security Audit Workflow**â€”â€”çº¯åˆ†æžåž‹ä»»åŠ¡ï¼Œagent æž¶æž„ã€è¯¯æŠ¥æŽ§åˆ¶ã€è¯„çº§ä½“ç³»å…¨éƒ¨è‡ªå·±è®¾è®¡
4. æœ€åŽåš **Compliance Test Workflow**â€”â€”æœ€ç»¼åˆï¼Œéœ€è¦æŠŠæ³•è§„é¢†åŸŸçŸ¥è¯†æ˜ å°„åˆ° agent æž¶æž„ï¼Œè¿˜æ¶‰åŠè‡ªåŠ¨æ•´æ”¹

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‰è‡ªå·±çš„å…´è¶£éšæ„æŒ‘é€‰ã€‚

> æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆã€‚ç”¨ä½ åœ¨è¿™æœ¬æ•™ç¨‹ä¸­å­¦åˆ°çš„æ¨¡å¼ï¼Œè®¾è®¡ä½ è‡ªå·±çš„æ–¹æ¡ˆã€‚ç¥ä½ ç¼–æŽ’æ„‰å¿«ã€‚

---

## ä½œä¸š 1ï¼šDevelop Workflow

> æž„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–åŠŸèƒ½å¼€å‘å·¥å…·ï¼Œä»Žéœ€æ±‚æè¿°åˆ°å¯è¿è¡Œä»£ç çš„å…¨æµç¨‹ç¼–æŽ’ã€‚

**æ ¸å¿ƒæ¨¡å¼**ï¼šExplore â†’ Specialized Agent â†’ Sequential â†’ Test-Driven

**æœ¯è¯­**

- Scaffoldï¼ˆè„šæ‰‹æž¶ï¼Œè‡ªåŠ¨ç”Ÿæˆé¡¹ç›®éª¨æž¶ä»£ç ï¼‰
- Code Generationï¼ˆä»£ç ç”Ÿæˆï¼Œç”± AI æ ¹æ®è§„æ ¼äº§å‡ºæºä»£ç ï¼‰
- Integration Testï¼ˆé›†æˆæµ‹è¯•ï¼ŒéªŒè¯å¤šä¸ªæ¨¡å—ååŒå·¥ä½œçš„æµ‹è¯•ï¼‰
- Stubï¼ˆæ¡©ï¼Œå ä½å®žçŽ°ï¼Œç”¨äºŽå…ˆæ­ç»“æž„åŽå¡«é€»è¾‘ï¼‰

### 9.4.1 èƒŒæ™¯

ä½ çš„å›¢é˜Ÿç»´æŠ¤ä¸€ä¸ª C/C++ ç½‘ç»œåº“ã€‚äº§å“ç»ç†æäº†ä¸€ä¸ªéœ€æ±‚ï¼š"ç»™è¿žæŽ¥æ± åŠ ä¸Šå¥åº·æ£€æŸ¥åŠŸèƒ½â€”â€”å®šæœŸ ping æ± ä¸­çš„ç©ºé—²è¿žæŽ¥ï¼Œå‰”é™¤å·²æ–­å¼€çš„è¿žæŽ¥ã€‚"

æ‰‹åŠ¨å¼€å‘æµç¨‹ï¼šè¯»éœ€æ±‚ â†’ çœ‹çŽ°æœ‰ä»£ç  â†’ è®¾è®¡æŽ¥å£ â†’ å†™å®žçŽ° â†’ å†™æµ‹è¯• â†’ è·‘æµ‹è¯• â†’ ä¿® bugã€‚æ¯ä¸€æ­¥éƒ½è¦äººç›¯ç€ã€‚

ä½ æƒ³ç”¨ Claude Code çš„ workflow ç¼–æŽ’ï¼ŒæŠŠè¿™ä¸ªæµç¨‹è‡ªåŠ¨åŒ–æˆä¸€æ¡å‘½ä»¤ã€‚

### 9.4.2 éœ€æ±‚æè¿°

**è¾“å…¥**:
- ä¸€ä¸ªæœ¬åœ° C/C++ é¡¹ç›®çš„è·¯å¾„
- ä¸€æ®µè‡ªç„¶è¯­è¨€çš„åŠŸèƒ½éœ€æ±‚æè¿°

**è¾“å‡º**:
- æ–°å¢ž/ä¿®æ”¹çš„æºæ–‡ä»¶ï¼ˆ.c/.hï¼‰
- å¯¹åº”çš„å•å…ƒæµ‹è¯•æ–‡ä»¶
- ä¸€ä»½å˜æ›´æ‘˜è¦ï¼ˆæ”¹äº†å“ªäº›æ–‡ä»¶ã€æ–°å¢žäº†å“ªäº›æŽ¥å£ï¼‰

**å¼€å‘é˜¶æ®µ**

å·¥å…·éœ€è¦æŒ‰é¡ºåºå®Œæˆä»¥ä¸‹ 4 ä¸ªé˜¶æ®µï¼š

| é˜¶æ®µ | ä»»åŠ¡ | å¯¹åº”æ¨¡å¼ |
|------|------|---------|
| ç†è§£ | æŽ¢ç´¢çŽ°æœ‰ä»£ç ç»“æž„ï¼Œè¯†åˆ«éœ€è¦ä¿®æ”¹çš„æ¨¡å—å’ŒæŽ¥å£ | Explore |
| è®¾è®¡ | ç”ŸæˆæŽ¥å£å®šä¹‰ï¼ˆ.h æ–‡ä»¶ï¼‰ï¼Œç¡®å®šå‡½æ•°ç­¾åå’Œæ•°æ®ç»“æž„ | Specialized Agent |
| å®žçŽ° | æ ¹æ®æŽ¥å£å®šä¹‰ç”Ÿæˆå®žçŽ°ä»£ç ï¼ˆ.c æ–‡ä»¶ï¼‰ | Sequential |
| éªŒè¯ | ç”Ÿæˆæµ‹è¯•ã€ç¼–è¯‘ã€è¿è¡Œæµ‹è¯•ã€ä¿®å¤å¤±è´¥ | Test-Driven |

**æŠ€æœ¯è¦æ±‚**

1. ç”¨ CLI å°è£…ï¼ˆtyperï¼‰ï¼Œæ”¯æŒ `dev implement <project-path> --requirement "éœ€æ±‚æè¿°"` å‘½ä»¤
2. ç†è§£é˜¶æ®µç”¨ Explore agent åªè¯»æŽ¢ç´¢ï¼Œä¸ä¿®æ”¹ä»»ä½•æ–‡ä»¶
3. è®¾è®¡é˜¶æ®µå…ˆç”Ÿæˆ .h æ–‡ä»¶ï¼Œç»ç”¨æˆ·ç¡®è®¤åŽå†è¿›å…¥å®žçŽ°é˜¶æ®µ
4. å®žçŽ°é˜¶æ®µç”Ÿæˆçš„ä»£ç å¿…é¡»éµå¾ªé¡¹ç›®çŽ°æœ‰çš„å‘½åè§„èŒƒå’Œä»£ç é£Žæ ¼
5. éªŒè¯é˜¶æ®µï¼šç¼–è¯‘ â†’ è¿è¡Œæµ‹è¯• â†’ å¤±è´¥åˆ™è‡ªåŠ¨ä¿®å¤ â†’ é‡æ–°éªŒè¯ï¼ˆæœ€å¤š 3 è½®ï¼‰
6. æ”¯æŒ `--dry-run` å‚æ•°ï¼Œåªè¾“å‡ºè®¾è®¡æ–¹æ¡ˆä¸å†™æ–‡ä»¶

### 9.4.3 æç¤ºï¼šä½ ä¼šç”¨åˆ°å“ªäº›æ¨¡å¼ï¼Ÿ

- [ ] **Explore** â€” ç†è§£çŽ°æœ‰ä»£ç ç»“æž„å’ŒæŽ¥å£
- [ ] **Specialized Agent** â€” æŽ¥å£è®¾è®¡ agentã€å®žçŽ° agentã€æµ‹è¯• agent å„å¸å…¶èŒ
- [ ] **Sequential** â€” ç†è§£ â†’ è®¾è®¡ â†’ å®žçŽ° â†’ éªŒè¯çš„ä¸¥æ ¼é¡ºåº
- [ ] **Test-Driven** â€” ç”Ÿæˆæµ‹è¯• â†’ ç¼–è¯‘è¿è¡Œ â†’ è‡ªåŠ¨ä¿®å¤å¾ªçŽ¯

### 9.4.4 å‚è€ƒæž¶æž„

```
dev implement <path> --requirement "..."
    â”‚
    â”œâ”€â”€ 1. Explore: ç†è§£çŽ°æœ‰ä»£ç 
    â”‚   â””â”€â”€ è¾“å‡º: æ¨¡å—ä¾èµ–å›¾ã€ç›¸å…³æŽ¥å£ã€å‘½åè§„èŒƒ
    â”‚
    â”œâ”€â”€ 2. Design: ç”ŸæˆæŽ¥å£å®šä¹‰
    â”‚   â””â”€â”€ è¾“å‡º: æ–°å¢žçš„ .h æ–‡ä»¶ï¼ˆå‡½æ•°ç­¾å + æ•°æ®ç»“æž„ï¼‰
    â”‚   â””â”€â”€ ç­‰å¾…ç”¨æˆ·ç¡®è®¤
    â”‚
    â”œâ”€â”€ 3. Implement: ç”Ÿæˆå®žçŽ°ä»£ç 
    â”‚   â””â”€â”€ è¾“å‡º: æ–°å¢ž/ä¿®æ”¹çš„ .c æ–‡ä»¶
    â”‚
    â””â”€â”€ 4. Verify: æµ‹è¯•å¾ªçŽ¯
        â”œâ”€â”€ ç”Ÿæˆæµ‹è¯•æ–‡ä»¶
        â”œâ”€â”€ ç¼–è¯‘å…¨éƒ¨ä»£ç 
        â”œâ”€â”€ è¿è¡Œæµ‹è¯•
        â””â”€â”€ å¤±è´¥ â†’ è‡ªåŠ¨ä¿®å¤ â†’ é‡æ–°ç¼–è¯‘è¿è¡Œï¼ˆæœ€å¤š 3 è½®ï¼‰
```

### 9.4.5 éªŒæ”¶æ ‡å‡†

1. `dev implement ./my-network-lib --requirement "éœ€æ±‚æè¿°"` ä¸€æ¡å‘½ä»¤å®Œæˆå¼€å‘
2. ç”Ÿæˆçš„ .h æ–‡ä»¶åŒ…å«æ¸…æ™°çš„å‡½æ•°ç­¾åå’Œæ³¨é‡Š
3. ç”Ÿæˆçš„ .c æ–‡ä»¶èƒ½é€šè¿‡ç¼–è¯‘ï¼ˆgcc -Wall -Werrorï¼‰
4. è‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘ä¸”å…¨éƒ¨é€šè¿‡
5. ç”Ÿæˆçš„ä»£ç é£Žæ ¼ä¸Žé¡¹ç›®çŽ°æœ‰ä»£ç ä¸€è‡´

### 9.4.6 è¿›é˜¶æŒ‘æˆ˜

- æ”¯æŒå¤šæ–‡ä»¶å˜æ›´ï¼šä¸€ä¸ªéœ€æ±‚æ¶‰åŠå¤šä¸ªæ¨¡å—æ—¶ï¼Œè‡ªåŠ¨è¯†åˆ«æ‰€æœ‰éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
- ç”Ÿæˆ git commit messageï¼Œè‡ªåŠ¨æäº¤å˜æ›´
- ç”¨ Hook å®žçŽ°"æ¯æ¬¡ç”Ÿæˆä»£ç åŽè‡ªåŠ¨è·‘ clang-format"
- æ”¯æŒ `--lang c++` å‚æ•°ï¼Œç”Ÿæˆ C++ é£Žæ ¼çš„ä»£ç ï¼ˆç±»ã€RAIIã€æ™ºèƒ½æŒ‡é’ˆï¼‰

---

## ä½œä¸š 2ï¼šTest Workflow

> æž„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆå·¥å…·ï¼Œä¸º C/C++ é¡¹ç›®ç”Ÿæˆæµ‹è¯•å¥—ä»¶å¹¶é©±åŠ¨è´¨é‡é—­çŽ¯ã€‚

**æ ¸å¿ƒæ¨¡å¼**ï¼šExplore â†’ Fan-out/Fan-in â†’ Test-Driven â†’ Event-Driven

**æœ¯è¯­**

- Coverageï¼ˆè¦†ç›–çŽ‡ï¼Œæµ‹è¯•æ‰§è¡Œåˆ°çš„ä»£ç å æ€»ä»£ç çš„æ¯”ä¾‹ï¼‰
- gcovï¼ˆGCC è‡ªå¸¦çš„ä»£ç è¦†ç›–çŽ‡å·¥å…·ï¼‰
- Boundary Testï¼ˆè¾¹ç•Œæµ‹è¯•ï¼Œé’ˆå¯¹è¾“å…¥è¾¹ç•Œå€¼çš„æµ‹è¯•ç”¨ä¾‹ï¼‰
- Fuzz Testingï¼ˆæ¨¡ç³Šæµ‹è¯•ï¼Œç”¨éšæœº/åŠéšæœºæ•°æ®æŽ¢æµ‹ç¨‹åºå´©æºƒï¼‰
- Regression Suiteï¼ˆå›žå½’æµ‹è¯•å¥—ä»¶ï¼Œé˜²æ­¢æ—§åŠŸèƒ½è¢«æ–°æ”¹åŠ¨ç ´åï¼‰

### 9.4.7 èƒŒæ™¯

ä½ çš„ C/C++ ç½‘ç»œåº“æœ‰ 12000 è¡Œä»£ç ï¼Œä½†æµ‹è¯•è¦†ç›–çŽ‡åªæœ‰ 23%ã€‚è€æ¿è¯´ï¼š"ä¸‹ä¸ªè¿­ä»£ä¹‹å‰ï¼Œæ ¸å¿ƒæ¨¡å—çš„è¦†ç›–çŽ‡è¦åˆ° 80%ã€‚"

æ‰‹åŠ¨å†™æµ‹è¯•å¤ªæ…¢ï¼Œè€Œä¸”å®¹æ˜“æ¼æŽ‰è¾¹ç•Œæƒ…å†µã€‚ä½ å†³å®šç”¨ Claude Code çš„ workflow ç¼–æŽ’ï¼Œæž„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆå·¥å…·â€”â€”å®ƒèƒ½è¯»æ‡‚ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ï¼Œè·‘æµ‹è¯•ï¼Œå‘çŽ°å¤±è´¥åŽè‡ªåŠ¨ä¿®å¤ï¼Œç›´åˆ°å…¨éƒ¨é€šè¿‡ã€‚

### 9.4.8 éœ€æ±‚æè¿°

**è¾“å…¥**: ä¸€ä¸ªæœ¬åœ° C/C++ é¡¹ç›®çš„è·¯å¾„ï¼Œå¯é€‰æŒ‡å®šæ¨¡å—

**è¾“å‡º**:
- ç”Ÿæˆçš„æµ‹è¯•æ–‡ä»¶ï¼ˆæ¯ä¸ªæºæ–‡ä»¶å¯¹åº”ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼‰
- æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Šï¼ˆé€šè¿‡/å¤±è´¥/è·³è¿‡ï¼‰
- è¦†ç›–çŽ‡æŠ¥å‘Šï¼ˆè¡Œè¦†ç›–çŽ‡ã€åˆ†æ”¯è¦†ç›–çŽ‡ï¼‰

### 9.4.9 ä½ éœ€è¦è‡ªå·±å†³å®šçš„äº‹

æ•™ç¨‹ä¸­çš„ Review Bot æŠŠå®¡æŸ¥æ‹†æˆ 4 ä¸ªå›ºå®šç»´åº¦å¹¶è¡Œè·‘ï¼Œå› ä¸ºå®¡æŸ¥ç»´åº¦ä¹‹é—´å‡ ä¹Žæ²¡æœ‰ä¾èµ–ã€‚ä½†æµ‹è¯•ç”Ÿæˆä¸ä¸€å®šé€‚åˆåŒæ ·çš„æ‹†æ³•ã€‚

**Q1: æŒ‰ä»€ä¹ˆç»´åº¦æ‹†åˆ†æµ‹è¯•ç”Ÿæˆ agentï¼Ÿ**

è‡³å°‘æœ‰ä¸‰ç§æ‹†æ³•ï¼š

- **æŒ‰æµ‹è¯•ç±»åž‹æ‹†**ï¼ˆæ­£å¸¸è·¯å¾„ / è¾¹ç•Œæ¡ä»¶ / é”™è¯¯å¤„ç† / å¹¶å‘å®‰å…¨ / ...ï¼‰ï¼šæ¯ä¸ª agent ä¸“æ³¨ä¸€ç§æµ‹è¯•ç­–ç•¥ï¼Œå®¹æ˜“å¹¶è¡Œã€‚ä½†åŒä¸€ä¸ªå‡½æ•°ä¼šè¢«å¤šä¸ª agent é‡å¤åˆ†æžï¼Œä¸” agent ä¹‹é—´å¯èƒ½ç”Ÿæˆé‡å¤çš„æµ‹è¯•ç”¨ä¾‹ã€‚
- **æŒ‰æ¨¡å—æ‹†**ï¼ˆparser / conn_pool / http_handler / ...ï¼‰ï¼šæ¯ä¸ª agent è´Ÿè´£ä¸€ä¸ªæ¨¡å—çš„å®Œæ•´æµ‹è¯•ï¼Œä¸Šä¸‹æ–‡æ›´é›†ä¸­ã€‚ä½†ä¸åŒæ¨¡å—çš„å¤æ‚åº¦å·®å¼‚å¤§ï¼Œagent è´Ÿè½½ä¸å‡è¡¡ã€‚
- **æŒ‰è¦†ç›–çŽ‡ç¼ºå£æ‹†**ï¼šå…ˆè·‘ä¸€è½®åŸºç¡€æµ‹è¯•æ‹¿åˆ°è¦†ç›–çŽ‡æ•°æ®ï¼Œå†æŒ‰æœªè¦†ç›–çš„ä»£ç è·¯å¾„åˆ†é…ç»™ä¸åŒ agent å®šå‘è¡¥å……ã€‚ç²¾å‡†åº¦æœ€é«˜ï¼Œä½†å˜æˆäº†ä¸¤é˜¶æ®µä¸²è¡Œã€‚

ä½ é€‰å“ªç§ï¼Ÿè¿˜æ˜¯æ··åˆä½¿ç”¨ï¼Ÿ

**Q2: å¤šä¸ª agent çš„æµ‹è¯•æ€Žä¹ˆåˆå¹¶ï¼Ÿ**

å¦‚æžœå¤šä¸ª agent å¹¶è¡Œç”Ÿæˆæµ‹è¯•ï¼Œåˆå¹¶æ—¶ä¼šé‡åˆ°å®žé™…é—®é¢˜ï¼š
- é‡å¤çš„æµ‹è¯•ç”¨ä¾‹æ€Žä¹ˆåŽ»é‡ï¼Ÿ
- å†²çªçš„ mock æˆ–å…¨å±€çŠ¶æ€è®¾ç½®æ€Žä¹ˆå¤„ç†ï¼Ÿ
- æµ‹è¯•æ–‡ä»¶çš„ç»„ç»‡ç»“æž„æ€Žä¹ˆå®šâ€”â€”æŒ‰ç»´åº¦åˆ†æ–‡ä»¶ï¼Œè¿˜æ˜¯æŒ‰æ¨¡å—åˆ†æ–‡ä»¶ï¼Ÿ

**Q3: ä¿®å¤å¾ªçŽ¯çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ**

"æœ€å¤š 3 è½®"æ˜¯æœ€ç®€å•çš„ç­–ç•¥ã€‚ä½†ä½ å¯ä»¥è®¾è®¡æ›´èªæ˜Žçš„æ–¹æ¡ˆï¼š
- ç¼–è¯‘å¤±è´¥å’Œè¿è¡Œå¤±è´¥æ˜¯å¦åº”è¯¥ç”¨ä¸åŒçš„ä¿®å¤ç­–ç•¥ï¼Ÿ
- å¦‚æžœç¬¬ 2 è½®ä¿®å¤å¼•å…¥äº†æ–°çš„å¤±è´¥ï¼Œæ˜¯ç»§ç»­ä¿®è¿˜æ˜¯å›žé€€ï¼Ÿ
- è¦†ç›–çŽ‡æœªè¾¾æ ‡ç®—"å¤±è´¥"å—ï¼Ÿè¦ä¸è¦è§¦å‘é¢å¤–çš„æµ‹è¯•ç”Ÿæˆï¼Ÿ

**æŠ€æœ¯è¦æ±‚**

1. ç”¨ CLI å°è£…ï¼ˆtyperï¼‰ï¼Œæ”¯æŒ `testgen run <project-path>` å‘½ä»¤
2. å¯é€‰ `--module <name>` å‚æ•°ï¼Œåªä¸ºæŒ‡å®šæ¨¡å—ç”Ÿæˆæµ‹è¯•
3. agent çš„æ•°é‡å’Œåˆ†å·¥ç”±ä½ è‡ªå·±è®¾è®¡â€”â€”ä¸ä¸€å®šæŒ‰æµ‹è¯•ç±»åž‹æ‹†ï¼Œä¸ä¸€å®šå…¨éƒ¨å¹¶è¡Œ
4. ç”Ÿæˆå‰å…ˆç”¨ Explore agent ç†è§£é¡¹ç›®ç»“æž„å’Œå·²æœ‰æµ‹è¯•
5. ç”Ÿæˆçš„æµ‹è¯•å¿…é¡»èƒ½é€šè¿‡ `gcc -Wall -Werror` ç¼–è¯‘
6. è‡ªåŠ¨è¿è¡Œæµ‹è¯•ï¼Œå¤±è´¥åˆ™åˆ†æžåŽŸå› å¹¶ä¿®å¤ï¼ˆä¿®å¤ç­–ç•¥ç”±ä½ è®¾è®¡ï¼‰
7. æœ€ç»ˆç”¨ gcov ç”Ÿæˆè¦†ç›–çŽ‡æŠ¥å‘Šï¼Œè¾“å‡ºè¡Œè¦†ç›–çŽ‡å’Œåˆ†æ”¯è¦†ç›–çŽ‡
8. æ”¯æŒ `--coverage-target 80` å‚æ•°è®¾å®šç›®æ ‡è¦†ç›–çŽ‡ï¼Œæœªè¾¾æ ‡æ—¶ç»™å‡ºå»ºè®®

### 9.4.10 æç¤ºï¼šä½ ä¼šç”¨åˆ°å“ªäº›æ¨¡å¼ï¼Ÿ

- [ ] **Explore** â€” ç†è§£é¡¹ç›®ç»“æž„ã€å·²æœ‰æµ‹è¯•ã€ä¾èµ–å…³ç³»
- [ ] **Specialized Agent** â€” æŒ‰ä½ é€‰æ‹©çš„ç»´åº¦æ‹†åˆ†æµ‹è¯•ç”Ÿæˆä¸“å®¶
- [ ] **Fan-out / Fan-in** â€” å¹¶è¡Œç”Ÿæˆæµ‹è¯•ï¼ˆå¦‚æžœä½ çš„è®¾è®¡å…è®¸å¹¶è¡Œï¼‰
- [ ] **Test-Driven** â€” ç¼–è¯‘ â†’ è¿è¡Œ â†’ å¤±è´¥ä¿®å¤å¾ªçŽ¯
- [ ] **Event-Driven** â€” å¯é€‰ï¼šHook åœ¨ä»£ç å˜æ›´åŽè‡ªåŠ¨é‡æ–°ç”Ÿæˆæµ‹è¯•

### 9.4.11 å‚è€ƒæž¶æž„

ä¸‹é¢æ˜¯ä¸€ç§å¯èƒ½çš„æž¶æž„ï¼ˆæŒ‰æµ‹è¯•ç±»åž‹æ‹†åˆ†ï¼‰ã€‚ä½ å®Œå…¨å¯ä»¥æŒ‰æ¨¡å—æ‹†ã€æŒ‰è¦†ç›–çŽ‡ç¼ºå£æ‹†ã€æˆ–è€…æ··åˆä½¿ç”¨ã€‚

```
testgen run <path> [--module parser] [--coverage-target 80]
    â”‚
    â”œâ”€â”€ 1. Explore: ç†è§£é¡¹ç›®ç»“æž„
    â”‚   â””â”€â”€ è¾“å‡º: æºæ–‡ä»¶åˆ—è¡¨ã€å·²æœ‰æµ‹è¯•ã€å…¬å¼€æŽ¥å£ã€ä¾èµ–å…³ç³»
    â”‚
    â”œâ”€â”€ 2. ä½ çš„ agent ç¼–æŽ’ï¼ˆè®¾è®¡ç”±ä½ å†³å®šï¼‰
    â”‚   â”œâ”€â”€ å‡ ä¸ª agentï¼ŸæŒ‰ä»€ä¹ˆç»´åº¦æ‹†ï¼Ÿ
    â”‚   â”œâ”€â”€ å¹¶è¡Œè¿˜æ˜¯ä¸²è¡Œï¼Ÿ
    â”‚   â””â”€â”€ ç”Ÿæˆçš„æµ‹è¯•æ–‡ä»¶æ€Žä¹ˆç»„ç»‡ï¼Ÿ
    â”‚
    â”œâ”€â”€ 3. åˆå¹¶: ç»Ÿä¸€æµ‹è¯•å¥—ä»¶
    â”‚   â””â”€â”€ åŽ»é‡ã€è§£å†³å†²çªã€ç”Ÿæˆ Makefile/CMake è§„åˆ™
    â”‚
    â”œâ”€â”€ 4. Test-Driven: ç¼–è¯‘è¿è¡Œå¾ªçŽ¯
    â”‚   â”œâ”€â”€ gcc -Wall -Werror ç¼–è¯‘
    â”‚   â”œâ”€â”€ è¿è¡Œæµ‹è¯•
    â”‚   â””â”€â”€ å¤±è´¥ â†’ ä½ çš„ä¿®å¤ç­–ç•¥ â†’ é‡æ–°ç¼–è¯‘è¿è¡Œ
    â”‚
    â””â”€â”€ 5. Coverage: è¦†ç›–çŽ‡æŠ¥å‘Š
        â”œâ”€â”€ gcov ç”Ÿæˆè¦†ç›–çŽ‡æ•°æ®
        â”œâ”€â”€ å¯¹æ¯”ç›®æ ‡è¦†ç›–çŽ‡
        â””â”€â”€ æœªè¾¾æ ‡ â†’ å»ºè®®è¡¥å……æµ‹è¯•çš„å‡½æ•°åˆ—è¡¨
```

### 9.4.12 éªŒæ”¶æ ‡å‡†

1. `testgen run ./my-network-lib` ä¸€æ¡å‘½ä»¤ç”Ÿæˆå®Œæ•´æµ‹è¯•å¥—ä»¶
2. æŠ¥å‘Šè¦†ç›–äº†ä½ è®¾è®¡çš„æ‰€æœ‰æµ‹è¯•ç»´åº¦ï¼Œä¸”èƒ½è¯´æ¸…æ‹†åˆ†ç†ç”±
3. ç”Ÿæˆçš„æµ‹è¯•æ–‡ä»¶èƒ½é€šè¿‡ç¼–è¯‘ä¸”è¿è¡Œç»“æžœæœ‰é€šè¿‡/å¤±è´¥/è·³è¿‡çš„ç»Ÿè®¡
4. è¦†ç›–çŽ‡æŠ¥å‘ŠåŒ…å«è¡Œè¦†ç›–çŽ‡å’Œåˆ†æ”¯è¦†ç›–çŽ‡
5. å•ä¸ª agent ç”Ÿæˆå¤±è´¥ä¸å½±å“å…¶ä»–æµ‹è¯•çš„ç”Ÿæˆ

### 9.4.13 è¿›é˜¶æŒ‘æˆ˜

- æ”¯æŒå¢žé‡æµ‹è¯•ç”Ÿæˆï¼šåªä¸º git diff ä¸­å˜æ›´çš„å‡½æ•°ç”Ÿæˆæ–°æµ‹è¯•
- é›†æˆ ASanï¼ˆAddressSanitizerï¼‰ï¼šç¼–è¯‘æ—¶åŠ  `-fsanitize=address`ï¼Œæ•èŽ·è¿è¡Œæ—¶å†…å­˜é”™è¯¯
- æ”¯æŒ Fuzz Testingï¼šä¸ºå…³é”®è§£æžå‡½æ•°ç”Ÿæˆ libFuzzer harness
- ç”¨ Hook å®žçŽ°"æ¯æ¬¡ä¿®æ”¹ .c æ–‡ä»¶åŽè‡ªåŠ¨é‡è·‘ç›¸å…³æµ‹è¯•"

---

## ä½œä¸š 3ï¼šSecurity Audit Workflow

> æž„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–å®‰å…¨å®¡è®¡å·¥å…·ï¼Œæ‰«æ C/C++ é¡¹ç›®å¹¶ç”Ÿæˆå®¡è®¡æŠ¥å‘Šã€‚

**æ ¸å¿ƒæ¨¡å¼**ï¼šExplore â†’ Specialized Agent â†’ Fan-out/Fan-in â†’ Sequential

**æœ¯è¯­**

- CWEï¼ˆCommon Weakness Enumerationï¼Œé€šç”¨ç¼ºé™·æžšä¸¾ï¼‰
- CVSSï¼ˆCommon Vulnerability Scoring Systemï¼Œé€šç”¨æ¼æ´žè¯„åˆ†ç³»ç»Ÿï¼‰
- Taint Analysisï¼ˆæ±¡ç‚¹åˆ†æžï¼Œè¿½è¸ªä¸å¯ä¿¡æ•°æ®åœ¨ç¨‹åºä¸­çš„ä¼ æ’­è·¯å¾„ï¼‰
- Attack Surfaceï¼ˆæ”»å‡»é¢ï¼Œç³»ç»Ÿä¸­å¯è¢«æ”»å‡»è€…åˆ©ç”¨çš„å…¥å£é›†åˆï¼‰
- False Positiveï¼ˆè¯¯æŠ¥ï¼Œå°†æ­£å¸¸ä»£ç é”™è¯¯æ ‡è®°ä¸ºæ¼æ´žï¼‰

### 9.4.14 èƒŒæ™¯

ä½ çš„å›¢é˜Ÿè¦å¯¹ä¸€ä¸ª C/C++ ç½‘ç»œåº“åšå®‰å…¨å®¡è®¡ã€‚é¡¹ç›®åŒ…å« HTTP åè®®è§£æžå™¨å’Œ TCP è¿žæŽ¥æ± ï¼Œçº¦ 60 ä¸ªæ–‡ä»¶ï¼Œ12000 è¡Œä»£ç ã€‚

å’Œ Review Bot ä¸åŒçš„æ˜¯ï¼Œå®‰å…¨å®¡è®¡é¢ä¸´å‡ ä¸ªç‹¬ç‰¹çš„æŒ‘æˆ˜ï¼š

1. **æ¼æ´žæœ‰ä¸Šä¸‹æ–‡ä¾èµ–**ã€‚åŒä¸€ä¸ª `memcpy()` è°ƒç”¨ï¼Œå¦‚æžœ size å‚æ•°æ¥è‡ªç¡¬ç¼–ç å¸¸é‡å°±æ˜¯å®‰å…¨çš„ï¼Œå¦‚æžœæ¥è‡ªç½‘ç»œè¾“å…¥å°±å¯èƒ½æ˜¯ buffer overflowã€‚å®¡è®¡ä¸èƒ½åªåšæ¨¡å¼åŒ¹é…ï¼Œéœ€è¦è¿½è¸ªæ•°æ®æµã€‚

2. **è¯¯æŠ¥æ¯”æ¼æŠ¥æ›´å±é™©**ã€‚ä¸€ä»½å……æ»¡è¯¯æŠ¥çš„å®¡è®¡æŠ¥å‘Šä¼šè®©å¼€å‘å›¢é˜Ÿå¤±åŽ»ä¿¡ä»»ï¼Œä¹‹åŽçœŸæ­£çš„æ¼æ´žä¹Ÿä¼šè¢«å¿½ç•¥ã€‚ä½ éœ€è¦åœ¨è¦†ç›–é¢å’Œç²¾åº¦ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚

3. **ä¸æ˜¯æ‰€æœ‰ç»´åº¦éƒ½é€‚åˆå¹¶è¡Œ**ã€‚æœ‰äº›å®¡è®¡å‘çŽ°ä¹‹é—´å­˜åœ¨å…³è”â€”â€”æ¯”å¦‚"è¾“å…¥æœªæ ¡éªŒ"å’Œ"buffer overflow"å¾€å¾€æ˜¯åŒä¸€æ¡æ”»å‡»é“¾çš„ä¸Šä¸‹æ¸¸ã€‚ç›²ç›®æ‹†æˆç‹¬ç«‹ agent å¯èƒ½ä¸¢å¤±è¿™ç§å…³è”ã€‚

### 9.4.15 éœ€æ±‚æè¿°

**è¾“å…¥**: ä¸€ä¸ªæœ¬åœ° C/C++ é¡¹ç›®çš„è·¯å¾„

**è¾“å‡º**: ä¸€ä»½å®‰å…¨å®¡è®¡æŠ¥å‘Šï¼ˆMarkdown æ ¼å¼ï¼‰ï¼Œè‡³å°‘åŒ…å«ï¼š
- å®¡è®¡æ¦‚è§ˆï¼ˆé¡¹ç›®è§„æ¨¡ã€æ”»å‡»é¢åˆ†æžã€å‘çŽ°æ•°é‡ï¼‰
- æŒ‰é£Žé™©æŽ’åºçš„å®‰å…¨é—®é¢˜åˆ—è¡¨
- æ¯ä¸ªé—®é¢˜çš„æ”»å‡»åœºæ™¯æè¿°ï¼ˆä¸åªæ˜¯"è¿™é‡Œæœ‰ bug"ï¼Œè€Œæ˜¯"æ”»å‡»è€…å¯ä»¥æ€Žæ ·åˆ©ç”¨"ï¼‰
- æ•´ä½“å®‰å…¨è¯„çº§

### 9.4.16 ä½ éœ€è¦è‡ªå·±å†³å®šçš„äº‹

æ•™ç¨‹ä¸­çš„ Review Bot æŠŠå®¡æŸ¥æ‹†æˆäº† 4 ä¸ªå›ºå®šç»´åº¦ï¼ˆå®‰å…¨/æ€§èƒ½/é£Žæ ¼/é€»è¾‘ï¼‰ï¼Œè¿™å¯¹ code review æ˜¯åˆç†çš„â€”â€”å››ä¸ªç»´åº¦ä¹‹é—´å‡ ä¹Žæ²¡æœ‰ä¾èµ–ã€‚ä½†å®‰å…¨å®¡è®¡ä¸ä¸€å®šé€‚åˆè¿™ç§æ‹†æ³•ã€‚

åœ¨åŠ¨æ‰‹ä¹‹å‰ï¼Œå…ˆæƒ³æ¸…æ¥šè¿™å‡ ä¸ªè®¾è®¡é—®é¢˜ï¼š

**Q1: æŒ‰ä»€ä¹ˆç»´åº¦æ‹†åˆ† agentï¼Ÿ**

è‡³å°‘æœ‰ä¸‰ç§æ‹†æ³•ï¼Œå„æœ‰åˆ©å¼Šï¼š

- **æŒ‰æ¼æ´žç±»åž‹æ‹†**ï¼ˆå†…å­˜å®‰å…¨ / è¾“å…¥éªŒè¯ / èµ„æºç®¡ç† / ...ï¼‰ï¼šå’Œ Review Bot æœ€åƒï¼Œå®¹æ˜“å®žçŽ°ã€‚ä½†ä¼šä¸¢å¤±è·¨ç±»åž‹çš„æ”»å‡»é“¾â€”â€”æ¯”å¦‚"æœªæ ¡éªŒçš„ç½‘ç»œè¾“å…¥ â†’ æ•´æ•°æº¢å‡º â†’ buffer overflow"æ¨ªè·¨äº†è¾“å…¥éªŒè¯å’Œå†…å­˜å®‰å…¨ä¸¤ä¸ª agentã€‚
- **æŒ‰æ”»å‡»é¢æ‹†**ï¼ˆç½‘ç»œå…¥å£ / æ–‡ä»¶è§£æž / é…ç½®åŠ è½½ / ...ï¼‰ï¼šæ¯ä¸ª agent è´Ÿè´£ä¸€ä¸ªå…¥å£ç‚¹çš„ç«¯åˆ°ç«¯å®¡è®¡ï¼Œèƒ½æ•æ‰å®Œæ•´æ”»å‡»é“¾ã€‚ä½†ä¸åŒå…¥å£å¯èƒ½æœ‰ç›¸åŒçš„åº•å±‚æ¼æ´žæ¨¡å¼ï¼Œä¼šé‡å¤æ‰«æã€‚
- **æŒ‰å®¡è®¡é˜¶æ®µæ‹†**ï¼ˆæ”»å‡»é¢è¯†åˆ« â†’ æ•°æ®æµè¿½è¸ª â†’ æ¼æ´žç¡®è®¤ â†’ é£Žé™©è¯„ä¼°ï¼‰ï¼špipeline æ¨¡å¼ï¼Œå‰ä¸€é˜¶æ®µçš„è¾“å‡ºæ˜¯åŽä¸€é˜¶æ®µçš„è¾“å…¥ã€‚ç²¾åº¦æœ€é«˜ï¼Œä½†å˜æˆäº†ä¸²è¡Œï¼Œå¤±åŽ»äº†å¹¶è¡Œä¼˜åŠ¿ã€‚

ä½ é€‰å“ªç§ï¼Ÿè¿˜æ˜¯æ··åˆä½¿ç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

**Q2: æ€Žä¹ˆå¤„ç†è¯¯æŠ¥ï¼Ÿ**

Ch4 ä¸­ç”¨"æ¸…å•é”šå®š + å¼€æ”¾å…œåº•"æ¥å¹³è¡¡ç²¾åº¦å’Œè¦†ç›–é¢ã€‚ä½†å®‰å…¨å®¡è®¡çš„è¯¯æŠ¥æˆæœ¬æ›´é«˜â€”â€”ä¸€ä»½ 50 æ¡å‘çŽ°ä¸­æœ‰ 30 æ¡è¯¯æŠ¥çš„æŠ¥å‘Šï¼Œæ²¡äººä¼šè®¤çœŸçœ‹ã€‚

ä½ æ‰“ç®—æ€Žä¹ˆæŽ§åˆ¶è¯¯æŠ¥çŽ‡ï¼Ÿå‡ ä¸ªæ€è·¯ä¾›å‚è€ƒï¼š
- è®© agent å¯¹æ¯æ¡å‘çŽ°æ ‡æ³¨ç½®ä¿¡åº¦ï¼Œä½Žç½®ä¿¡åº¦çš„æ”¾åˆ°é™„å½•è€Œéžæ­£æ–‡
- å¢žåŠ ä¸€ä¸ª"éªŒè¯ agent"ï¼Œä¸“é—¨å¤å®¡å…¶ä»– agent çš„å‘çŽ°ï¼Œè¿‡æ»¤æŽ‰æ˜Žæ˜¾çš„è¯¯æŠ¥
- åœ¨ prompt ä¸­è¦æ±‚ agent æè¿°æ”»å‡»åœºæ™¯â€”â€”å¦‚æžœå®ƒè¯´ä¸æ¸…"æ”»å‡»è€…æ€Žä¹ˆåˆ©ç”¨"ï¼Œå¤§æ¦‚çŽ‡æ˜¯è¯¯æŠ¥

**Q3: è¯„çº§æ€Žä¹ˆå®šï¼Ÿ**

Review Bot çš„è¯„çº§å¾ˆç®€å•ï¼ˆæœ‰ critical å°± FAILï¼‰ã€‚ä½†å®‰å…¨å®¡è®¡çš„è¯„çº§æ›´å¤æ‚ï¼š
- ä¸€ä¸ªéœ€è¦ç‰©ç†æŽ¥è§¦æ‰èƒ½åˆ©ç”¨çš„ critical æ¼æ´žï¼Œå’Œä¸€ä¸ªå¯è¿œç¨‹åˆ©ç”¨çš„ warning æ¼æ´žï¼Œå“ªä¸ªæ›´ä¸¥é‡ï¼Ÿ
- è¯„çº§åº”è¯¥åŸºäºŽæ¼æ´žæ•°é‡ï¼Œè¿˜æ˜¯åŸºäºŽæœ€ä¸¥é‡çš„å•ä¸ªæ¼æ´žï¼Œè¿˜æ˜¯åŸºäºŽæ•´ä½“æ”»å‡»é¢æš´éœ²ç¨‹åº¦ï¼Ÿ

ä½ éœ€è¦è®¾è®¡è‡ªå·±çš„è¯„çº§ä½“ç³»ï¼Œå¹¶è¯´æ˜Žç†ç”±ã€‚

**æŠ€æœ¯è¦æ±‚**

1. ç”¨ CLI å°è£…ï¼ˆtyperï¼‰ï¼Œæ”¯æŒ `audit run <project-path>` å‘½ä»¤
2. å®¡è®¡å‰å…ˆç”¨ Explore agent åšæ”»å‡»é¢åˆ†æžï¼ˆè¯†åˆ«ç½‘ç»œå…¥å£ã€æ–‡ä»¶è§£æžå…¥å£ã€å¤–éƒ¨è¾“å…¥ç‚¹ï¼‰
3. agent çš„æ•°é‡å’Œåˆ†å·¥ç”±ä½ è‡ªå·±è®¾è®¡â€”â€”ä¸ä¸€å®šæ˜¯ 5 ä¸ªï¼Œä¸ä¸€å®šè¦å…¨éƒ¨å¹¶è¡Œ
4. æ¯æ¡å‘çŽ°å¿…é¡»åŒ…å«ï¼šCWE ç¼–å·ã€æ”»å‡»åœºæ™¯æè¿°ã€ç½®ä¿¡åº¦ã€ä¿®å¤å»ºè®®
5. æ”¯æŒ `--output` å‚æ•°é€‰æ‹©è¾“å‡ºæ ¼å¼ï¼ˆmarkdown / jsonï¼‰
6. å•ä¸ª agent å¤±è´¥ä¸å½±å“æ•´ä½“å®¡è®¡æµç¨‹

### 9.4.17 æç¤ºï¼šä½ ä¼šç”¨åˆ°å“ªäº›æ¨¡å¼ï¼Ÿ

- [ ] **Sequential** â€” å®¡è®¡æµç¨‹çš„æ•´ä½“ç¼–æŽ’
- [ ] **Explore** â€” ç†è§£ç›®æ ‡é¡¹ç›®çš„ç»“æž„
- [ ] **Specialized Agent** â€” æŒ‰ä½ é€‰æ‹©çš„ç»´åº¦æ‹†åˆ†ä¸“å®¶
- [ ] **Fan-out / Fan-in** â€” å¹¶è¡Œæ‰«æï¼ˆå¦‚æžœä½ çš„è®¾è®¡å…è®¸å¹¶è¡Œï¼‰
- [ ] **Event-Driven** â€” å¯é€‰ï¼šHook è‡ªåŠ¨è§¦å‘å®¡è®¡
- [ ] **Test-Driven** â€” ä¸ºå®¡è®¡å·¥å…·æœ¬èº«å†™æµ‹è¯•

### 9.4.18 å‚è€ƒæž¶æž„

ä¸‹é¢æ˜¯ä¸€ç§å¯èƒ½çš„æž¶æž„ï¼ˆæŒ‰æ¼æ´žç±»åž‹æ‹†åˆ†ï¼‰ã€‚ä½ å®Œå…¨å¯ä»¥è®¾è®¡ä¸åŒçš„æ–¹æ¡ˆâ€”â€”æŒ‰æ”»å‡»é¢æ‹†ã€æŒ‰é˜¶æ®µä¸²è¡Œã€æˆ–è€…æ··åˆä½¿ç”¨ã€‚

```
audit run <path>
    â”‚
    â”œâ”€â”€ 1. Explore: æ”»å‡»é¢åˆ†æž
    â”‚   â””â”€â”€ è¾“å‡º: å…¥å£ç‚¹æ¸…å•ã€æ•°æ®æµå…¥å£ã€å¤–éƒ¨ä¾èµ–
    â”‚
    â”œâ”€â”€ 2. ä½ çš„ agent ç¼–æŽ’ï¼ˆè®¾è®¡ç”±ä½ å†³å®šï¼‰
    â”‚   â”œâ”€â”€ å¹¶è¡Œï¼Ÿä¸²è¡Œï¼Ÿæ··åˆï¼Ÿ
    â”‚   â”œâ”€â”€ å‡ ä¸ª agentï¼Ÿæ€Žä¹ˆåˆ†å·¥ï¼Ÿ
    â”‚   â””â”€â”€ agent ä¹‹é—´éœ€è¦å…±äº«ä»€ä¹ˆä¸Šä¸‹æ–‡ï¼Ÿ
    â”‚
    â”œâ”€â”€ 3. ç»“æžœæ”¶é›† + åŽ»é‡ + å…³è”åˆ†æž
    â”‚   â””â”€â”€ åŒä¸€æ¡æ”»å‡»é“¾çš„å¤šä¸ªå‘çŽ°æ˜¯å¦éœ€è¦åˆå¹¶ï¼Ÿ
    â”‚
    â””â”€â”€ 4. Report: èšåˆ + è¯„çº§ + æ¸²æŸ“
```

### 9.4.19 éªŒæ”¶æ ‡å‡†

1. `audit run ./my-network-lib` ä¸€æ¡å‘½ä»¤è·‘å®Œæ•´ä¸ªå®¡è®¡
2. æŠ¥å‘Šè¦†ç›–äº†ä½ è®¾è®¡çš„æ‰€æœ‰å®¡è®¡ç»´åº¦ï¼Œä¸”èƒ½è¯´æ¸…æ¯ä¸ªç»´åº¦çš„æ‹†åˆ†ç†ç”±
3. æ¯æ¡å‘çŽ°åŒ…å« CWE ç¼–å·ã€æ”»å‡»åœºæ™¯ã€ç½®ä¿¡åº¦ã€ä¿®å¤å»ºè®®â€”â€”ç¼ºä¸€ä¸å¯
4. æŠ¥å‘Šæœ‰ä½ è‡ªå·±è®¾è®¡çš„è¯„çº§ä½“ç³»ï¼Œå¹¶åœ¨æŠ¥å‘Šä¸­è¯´æ˜Žè¯„çº§ä¾æ®
5. å•ä¸ª agent å¤±è´¥ä¸å½±å“æ•´ä½“å®¡è®¡æµç¨‹
6. æœ‰åŸºæœ¬çš„å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘ï¼ˆèšåˆã€è¯„çº§ã€è¾“å‡ºæ ¼å¼ï¼‰

### 9.4.20 è¿›é˜¶æŒ‘æˆ˜

- æ”¯æŒå¢žé‡å®¡è®¡ï¼šåªå®¡è®¡ git diff ä¸­å˜æ›´çš„æ–‡ä»¶ï¼Œä½†ä»ç„¶è¿½è¸ªè·¨æ–‡ä»¶çš„æ•°æ®æµ
- æ·»åŠ  CLAUDE.md é…ç½®ï¼Œè®© Claude Code è‡ªåŠ¨éµå¾ªå®¡è®¡è§„èŒƒ
- ç”¨ Hook å®žçŽ°"æ¯æ¬¡ push å‰è‡ªåŠ¨å®¡è®¡"
- å¯¹æ¯”ä¸¤æ¬¡å®¡è®¡ç»“æžœï¼Œç”Ÿæˆå·®å¼‚æŠ¥å‘Šï¼ˆæ–°å¢žäº†å“ªäº›æ¼æ´žã€ä¿®å¤äº†å“ªäº›ã€å“ªäº›æ¶åŒ–äº†ï¼‰
- å®žçŽ°æ”»å‡»é“¾å¯è§†åŒ–ï¼šæŠŠå…³è”çš„å‘çŽ°ä¸²æˆå®Œæ•´çš„æ”»å‡»è·¯å¾„ï¼Œè€Œä¸æ˜¯å­¤ç«‹çš„ç‚¹
- è®©å®¡è®¡å·¥å…·å®¡è®¡è‡ªå·±ï¼šç”¨ä½ çš„å·¥å…·æ‰«æä½ çš„å·¥å…·ä»£ç ï¼Œçœ‹çœ‹èƒ½å‘çŽ°ä»€ä¹ˆ

---

## ä½œä¸š 4ï¼šCompliance Test Workflow

> æž„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–åˆè§„æ£€æµ‹å·¥å…·ï¼Œæ£€æŸ¥ç»ˆç«¯è®¾å¤‡ / ç§»åŠ¨æ“ä½œç³»ç»Ÿä»£ç æ˜¯å¦ç¬¦åˆå·¥ä¿¡éƒ¨åŠç½‘ç»œå®‰å…¨æ³•å¾‹æ³•è§„è¦æ±‚ã€‚

**æ ¸å¿ƒæ¨¡å¼**ï¼šExplore â†’ Specialized Agent â†’ Fan-out/Fan-in â†’ Sequential â†’ Event-Driven

**æœ¯è¯­**

- ç½‘ç»œå®‰å…¨æ³•ï¼ˆ2017 å¹´æ–½è¡Œï¼Œç½‘ç»œè¿è¥è€…å®‰å…¨ä¿æŠ¤ä¹‰åŠ¡çš„åŸºæœ¬æ³•ï¼‰
- ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³• / PIPLï¼ˆ2021 å¹´æ–½è¡Œï¼Œä¸ªäººä¿¡æ¯å¤„ç†è§„åˆ™ï¼‰
- æ•°æ®å®‰å…¨æ³•ï¼ˆ2021 å¹´æ–½è¡Œï¼Œæ•°æ®å¤„ç†æ´»åŠ¨çš„å®‰å…¨ä¸Žç›‘ç®¡æ¡†æž¶ï¼‰
- å·¥ä¿¡éƒ¨ 164 å·æ–‡ï¼ˆã€Šå…³äºŽè¿›ä¸€æ­¥è§„èŒƒç§»åŠ¨æ™ºèƒ½ç»ˆç«¯åº”ç”¨è½¯ä»¶é¢„ç½®è¡Œä¸ºçš„é€šå‘Šã€‹ï¼Œé¢„ç½® App å¯å¸è½½è¦æ±‚ï¼‰
- GB/T 41391-2022ï¼ˆã€Šç§»åŠ¨äº’è”ç½‘åº”ç”¨ç¨‹åºï¼ˆAppï¼‰æ”¶é›†ä¸ªäººä¿¡æ¯åŸºæœ¬è¦æ±‚ã€‹ï¼Œæœ€å°å¿…è¦åŽŸåˆ™ï¼‰
- ç­‰ä¿ 2.0 ç§»åŠ¨äº’è”å®‰å…¨æ‰©å±•ï¼ˆGB/T 22239-2019 é™„å½• Fï¼Œç§»åŠ¨ç»ˆç«¯å®‰å…¨è®¡ç®—çŽ¯å¢ƒè¦æ±‚ï¼‰
- å¯†ç æ³•ï¼ˆ2020 å¹´æ–½è¡Œï¼Œå•†ç”¨å¯†ç åº”ç”¨ä¸Žç®¡ç†è§„èŒƒï¼‰
- å·¥ä¿¡éƒ¨ App ä¾µå®³ç”¨æˆ·æƒç›Šä¸“é¡¹æ•´æ²»ï¼ˆè‡ª 2019 å¹´èµ·æŒç»­å¼€å±•ï¼Œè¦†ç›–è¿è§„æ”¶é›†ä¿¡æ¯ã€å¼ºåˆ¶æ†ç»‘ã€å¼¹çª—éªšæ‰°ç­‰ï¼‰

### 9.4.21 èƒŒæ™¯

ä½ çš„å›¢é˜Ÿè´Ÿè´£ä¸€æ¬¾å›½äº§ç§»åŠ¨æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿçº§ç»„ä»¶å¼€å‘ï¼ˆC/C++ å®žçŽ°ï¼‰ã€‚äº§å“å³å°†é€æ£€å…¥ç½‘ï¼Œå·¥ä¿¡éƒ¨å’Œå®‰å…¨åˆè§„å›¢é˜ŸåŒæ—¶æå‡ºè¦æ±‚ï¼šç³»ç»Ÿä»£ç å¿…é¡»é€šè¿‡åˆè§„å®¡æŸ¥ï¼Œè¦†ç›–é¢„ç½®åº”ç”¨ç®¡ç†ã€ä¸ªäººä¿¡æ¯æ”¶é›†ã€æ•°æ®å­˜å‚¨ä¼ è¾“ã€ç”¨æˆ·æƒç›Šä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ã€‚

æ‰‹åŠ¨é€æ¡å¯¹ç…§æ³•è§„å¤ªç—›è‹¦äº†â€”â€”ä»… GB/T 41391 å°±å®šä¹‰äº† 39 ç±»ä¸ªäººä¿¡æ¯çš„æœ€å°å¿…è¦æ”¶é›†è§„åˆ™ï¼Œå·¥ä¿¡éƒ¨åŽ†æ¬¡ä¸“é¡¹æ•´æ²»é€šæŠ¥æ¶‰åŠçš„è¿è§„ç±»åž‹è¶…è¿‡ 20 ç§ï¼Œç­‰ä¿ 2.0 ç§»åŠ¨äº’è”æ‰©å±•è¦æ±‚åˆæœ‰æ•°åæ¡æŠ€æœ¯ç»†åˆ™ã€‚ä½ å†³å®šç”¨ Claude Code çš„ workflow ç¼–æŽ’ï¼Œæž„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–åˆè§„æ£€æµ‹å·¥å…·ï¼ŒæŒ‰æ³•è§„ç»´åº¦åˆ†ç±»æ‰«æä»£ç ï¼Œè¾“å‡ºåˆè§„æŠ¥å‘Šå’Œæ•´æ”¹å»ºè®®ã€‚

### 9.4.22 éœ€æ±‚æè¿°

**è¾“å…¥**: ä¸€ä¸ªæœ¬åœ°ç»ˆç«¯è®¾å¤‡ / ç§»åŠ¨ OS é¡¹ç›®çš„è·¯å¾„ï¼Œå¯é€‰æŒ‡å®šæ³•è§„ç»´åº¦

**è¾“å‡º**:
- åˆè§„æ£€æµ‹æŠ¥å‘Šï¼ˆMarkdown æ ¼å¼ï¼‰
- æŒ‰æ³•è§„ç»´åº¦åˆ†ç±»çš„è¿è§„åˆ—è¡¨ï¼ˆæ³•è§„æ¡æ¬¾ã€è¿è§„ä½ç½®ã€é£Žé™©ç­‰çº§ï¼‰
- æ¯æ¡è¿è§„çš„æ•´æ”¹å»ºè®®å’Œä»£ç ç¤ºä¾‹
- æ•´ä½“åˆè§„è¯„çº§å’Œå…¥ç½‘é€æ£€é£Žé™©è¯„ä¼°

**æ£€æµ‹èŒƒå›´**

åˆè§„æ£€æµ‹è‡³å°‘éœ€è¦è¦†ç›–ä»¥ä¸‹æ³•è§„é¢†åŸŸï¼ˆä¾›å‚è€ƒï¼Œä¸æ˜¯ agent æ‹†åˆ†æ–¹æ¡ˆï¼‰ï¼š

| æ³•è§„é¢†åŸŸ | å¯¹åº”æ³•è§„ | å…³æ³¨ç‚¹ |
|---------|---------|--------|
| ä¸ªäººä¿¡æ¯æ”¶é›† | ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€GB/T 41391-2022 | æœ€å°å¿…è¦åŽŸåˆ™ã€æƒé™ä¸ŽåŠŸèƒ½åŒ¹é…ã€ç”¨æˆ·åŒæ„å‰ç½®ã€é™é»˜é‡‡é›†è®¾å¤‡æ ‡è¯†/ä½ç½®/é€šè®¯å½• |
| é¢„ç½®åº”ç”¨ä¸Žåˆ†å‘ | å·¥ä¿¡éƒ¨ 164 å·æ–‡ | é¢„ç½® App å¯å¸è½½ã€ç¬¬ä¸‰æ–¹åº”ç”¨ç®¡ç†ã€OTA æŽ¨é€æ˜Žç¤ºã€åˆ†å‘æ¸ é“ç­¾åæ ¡éªŒ |
| æ•°æ®å­˜å‚¨ä¸Žä¼ è¾“ | æ•°æ®å®‰å…¨æ³•ã€å¯†ç æ³•ã€ç­‰ä¿ 2.0 ç§»åŠ¨æ‰©å±• | æ•æ„Ÿæ•°æ®æ˜Žæ–‡è½ç›˜ã€å¯†é’¥ç¡¬ç¼–ç ã€TLS 1.2+ã€å›½å¯†ç®—æ³•ï¼ˆSM2/SM3/SM4ï¼‰ã€è¯ä¹¦æ ¡éªŒ |
| ç”¨æˆ·æƒç›Šä¿æŠ¤ | å·¥ä¿¡éƒ¨ä¸“é¡¹æ•´æ²»ã€ç½‘ç»œå®‰å…¨æ³• | å¼€å±å¼¹çª—å¼ºåˆ¶è·³è½¬ã€å¼ºåˆ¶æ†ç»‘ä¸‹è½½ã€é¢‘ç¹è‡ªå¯åŠ¨/å…³è”å¯åŠ¨ã€æ¬ºéª—è¯¯å¯¼ç‚¹å‡»ã€é€šçŸ¥æƒé™ |
| ç»ˆç«¯å®‰å…¨èƒ½åŠ› | ç­‰ä¿ 2.0 ç§»åŠ¨äº’è”æ‰©å±•ï¼ˆé™„å½• Fï¼‰ | å®‰å…¨å¯åŠ¨é“¾ã€åº”ç”¨æ²™ç®±éš”ç¦»ã€æ¶æ„ä»£ç é˜²æŠ¤ã€å®‰å…¨å®¡è®¡æ—¥å¿—ã€è¿œç¨‹é”å®šä¸Žæ“¦é™¤ |

### 9.4.23 ä½ éœ€è¦è‡ªå·±å†³å®šçš„äº‹

æ³•è§„ç»´åº¦æ˜¯å®¢è§‚å­˜åœ¨çš„ï¼Œä½†"æ³•è§„ç»´åº¦"ä¸ç­‰äºŽ"agent æž¶æž„"ã€‚åœ¨åŠ¨æ‰‹ä¹‹å‰ï¼Œå…ˆæƒ³æ¸…æ¥šè¿™å‡ ä¸ªè®¾è®¡é—®é¢˜ï¼š

**Q1: æ³•è§„ç»´åº¦æ€Žä¹ˆæ˜ å°„åˆ° agentï¼Ÿ**

5 ä¸ªæ³•è§„é¢†åŸŸä¸ä¸€å®šè¦ç”¨ 5 ä¸ª agentã€‚å‡ ç§æ€è·¯ï¼š

- **ä¸€å¯¹ä¸€æ˜ å°„**ï¼šæ¯ä¸ªæ³•è§„é¢†åŸŸä¸€ä¸ª agentï¼Œæœ€ç›´è§‚ã€‚ä½†æœ‰äº›æ³•è§„ä¹‹é—´æœ‰äº¤å‰â€”â€”æ¯”å¦‚"æ•°æ®å­˜å‚¨ä¸Žä¼ è¾“"å’Œ"ä¸ªäººä¿¡æ¯æ”¶é›†"éƒ½å…³å¿ƒæ•æ„Ÿæ•°æ®çš„å¤„ç†æ–¹å¼ï¼Œä¼šé‡å¤æ‰«æã€‚
- **æŒ‰ä»£ç åŒºåŸŸæ‹†**ï¼šæ¯ä¸ª agent è´Ÿè´£ä¸€ç»„ç›¸å…³æ¨¡å—ï¼ˆå¦‚ç½‘ç»œå±‚ã€å­˜å‚¨å±‚ã€æƒé™ç®¡ç†å±‚ï¼‰ï¼Œåœ¨è‡ªå·±çš„åŒºåŸŸå†…æ£€æŸ¥æ‰€æœ‰ç›¸å…³æ³•è§„ã€‚å‡å°‘é‡å¤æ‰«æï¼Œä½† agent éœ€è¦ç†è§£å¤šéƒ¨æ³•è§„ã€‚
- **ä¸¤é˜¶æ®µæ··åˆ**ï¼šå…ˆå¹¶è¡Œåšå„æ³•è§„ç»´åº¦çš„åˆç­›ï¼Œå†ä¸²è¡Œåšè·¨ç»´åº¦çš„å…³è”åˆ†æžï¼ˆæ¯”å¦‚"æ”¶é›†äº†ä¸ªäººä¿¡æ¯ä½†ä¼ è¾“æ—¶æœªåŠ å¯†"æ¨ªè·¨ä¸¤ä¸ªç»´åº¦ï¼‰ã€‚

**Q2: è¯„çº§ä½“ç³»æ€Žä¹ˆè®¾è®¡ï¼Ÿ**

åˆè§„è¯„çº§æ¯”å®‰å…¨å®¡è®¡æ›´å¤æ‚ï¼Œå› ä¸ºä¸åŒè¿è§„çš„æ³•å¾‹åŽæžœå·®å¼‚å·¨å¤§ï¼š
- é™é»˜æ”¶é›†ä¸ªäººä¿¡æ¯å¯èƒ½å¯¼è‡´ App ä¸‹æž¶ç”šè‡³è¡Œæ”¿å¤„ç½š
- é¢„ç½®åº”ç”¨ä¸å¯å¸è½½å¯èƒ½è¢«å·¥ä¿¡éƒ¨é€šæŠ¥
- ç¼ºå°‘å›½å¯†ç®—æ³•æ”¯æŒå¯èƒ½å½±å“å…¥ç½‘é€æ£€ä½†ä¸ä¼šè¢«å¤„ç½š

ä½ çš„è¯„çº§åº”è¯¥åŸºäºŽä»€ä¹ˆï¼Ÿè¿è§„æ•°é‡ï¼Ÿæ³•å¾‹åŽæžœä¸¥é‡ç¨‹åº¦ï¼Ÿå…¥ç½‘é€æ£€é€šè¿‡æ¦‚çŽ‡ï¼Ÿè¿˜æ˜¯ç»¼åˆè€ƒè™‘ï¼Ÿ

**Q3: `--fix` è‡ªåŠ¨æ•´æ”¹çš„è¾¹ç•Œåœ¨å“ªï¼Ÿ**

æœ‰äº›è¿è§„å¯ä»¥è‡ªåŠ¨ä¿®å¤ï¼ˆå¦‚è¡¥å……å®¡è®¡æ—¥å¿—å­—æ®µã€æ›¿æ¢æ˜Žæ–‡å­˜å‚¨ä¸ºåŠ å¯†å­˜å‚¨ï¼‰ï¼Œæœ‰äº›ä¸èƒ½ï¼ˆå¦‚é‡æ–°è®¾è®¡æƒé™ç”³è¯·æµç¨‹ã€è°ƒæ•´é¢„ç½®åº”ç”¨ç­–ç•¥ï¼‰ã€‚ä½ éœ€è¦å†³å®šï¼š
- å“ªäº›ç±»åž‹çš„è¿è§„å°è¯•è‡ªåŠ¨ä¿®å¤ï¼Œå“ªäº›åªç»™å»ºè®®ï¼Ÿ
- è‡ªåŠ¨ç”Ÿæˆçš„è¡¥ä¸æ€Žä¹ˆéªŒè¯â€”â€”ç¼–è¯‘é€šè¿‡å°±è¡Œï¼Œè¿˜æ˜¯éœ€è¦è·‘æµ‹è¯•ï¼Ÿ
- ä¿®å¤å¤±è´¥æ€Žä¹ˆå¤„ç†â€”â€”å›žé€€å¹¶æ ‡è®°ï¼Œè¿˜æ˜¯ä¿ç•™éƒ¨åˆ†ä¿®å¤ï¼Ÿ

**æŠ€æœ¯è¦æ±‚**

1. ç”¨ CLI å°è£…ï¼ˆtyperï¼‰ï¼Œæ”¯æŒ `comply check <project-path>` å‘½ä»¤
2. æ”¯æŒ `--standard` å‚æ•°é€‰æ‹©æ³•è§„ç»´åº¦ï¼ˆ`pipl` ä¸ªä¿æ³• / `miit` å·¥ä¿¡éƒ¨è§„å®š / `mlps2` ç­‰ä¿ 2.0 / `all` å…¨éƒ¨ï¼‰
3. agent çš„æ•°é‡å’Œåˆ†å·¥ç”±ä½ è‡ªå·±è®¾è®¡â€”â€”ä¸ä¸€å®šå’Œæ³•è§„ç»´åº¦ä¸€ä¸€å¯¹åº”
4. æ£€æµ‹å‰å…ˆç”¨ Explore agent ç†è§£é¡¹ç›®ç»“æž„ã€æƒé™å£°æ˜Žæ–‡ä»¶ã€ç³»ç»ŸæœåŠ¡æ¸…å•ã€é¢„ç½®åº”ç”¨åˆ—è¡¨
5. æ¯æ¡è¿è§„æ ‡æ³¨å¯¹åº”çš„æ³•è§„æ¡æ¬¾ï¼ˆå¦‚"PIPL ç¬¬ 6 æ¡ â€” æœ€å°å¿…è¦åŽŸåˆ™"ã€"å·¥ä¿¡éƒ¨ 164 å·æ–‡ â€” é¢„ç½®åº”ç”¨å¯å¸è½½"ï¼‰
6. æ”¯æŒ `--fix` å‚æ•°ï¼Œè‡ªåŠ¨ç”Ÿæˆæ•´æ”¹è¡¥ä¸ï¼ˆæ•´æ”¹è¾¹ç•Œç”±ä½ è®¾è®¡ï¼‰
7. æ”¯æŒ `--output` å‚æ•°é€‰æ‹©è¾“å‡ºæ ¼å¼ï¼ˆmarkdown / jsonï¼‰

### 9.4.24 æç¤ºï¼šä½ ä¼šç”¨åˆ°å“ªäº›æ¨¡å¼ï¼Ÿ

- [ ] **Sequential** â€” åˆè§„æ£€æµ‹æµç¨‹çš„æ•´ä½“ç¼–æŽ’
- [ ] **Explore** â€” ç†è§£é¡¹ç›®ç»“æž„ã€æƒé™å£°æ˜Žã€ç³»ç»ŸæœåŠ¡æ¸…å•ã€é¢„ç½®åº”ç”¨åˆ—è¡¨ã€å·²æœ‰å®‰å…¨æŽªæ–½
- [ ] **Specialized Agent** â€” æŒ‰ä½ é€‰æ‹©çš„ç»´åº¦æ‹†åˆ†æ£€æµ‹ä¸“å®¶
- [ ] **Fan-out / Fan-in** â€” å¹¶è¡Œæ‰«æï¼ˆå¦‚æžœä½ çš„è®¾è®¡å…è®¸å¹¶è¡Œï¼‰
- [ ] **Event-Driven** â€” å¯é€‰ï¼šHook åœ¨æäº¤å‰è‡ªåŠ¨æ£€æµ‹åˆè§„æ€§
- [ ] **Test-Driven** â€” å¯é€‰ï¼šä¸ºè‡ªåŠ¨æ•´æ”¹ç”Ÿæˆçš„è¡¥ä¸è·‘ç¼–è¯‘éªŒè¯

### 9.4.25 å‚è€ƒæž¶æž„

ä¸‹é¢æ˜¯ä¸€ç§å¯èƒ½çš„æž¶æž„ï¼ˆæŒ‰æ³•è§„ç»´åº¦ä¸€å¯¹ä¸€æ˜ å°„ï¼‰ã€‚ä½ å®Œå…¨å¯ä»¥æŒ‰ä»£ç åŒºåŸŸæ‹†ã€ä¸¤é˜¶æ®µæ··åˆã€æˆ–è€…è®¾è®¡å…¶ä»–æ–¹æ¡ˆã€‚

```
comply check <path> [--standard all] [--fix] [--output markdown]
    â”‚
    â”œâ”€â”€ 1. Explore: ç†è§£é¡¹ç›®ç»“æž„
    â”‚   â””â”€â”€ è¾“å‡º: æºç ç›®å½•ã€æƒé™å£°æ˜Žæ–‡ä»¶ã€é¢„ç½®åº”ç”¨æ¸…å•ã€ç³»ç»ŸæœåŠ¡åˆ—è¡¨ã€åŠ å¯†åº“ä¾èµ–
    â”‚
    â”œâ”€â”€ 2. ä½ çš„ agent ç¼–æŽ’ï¼ˆè®¾è®¡ç”±ä½ å†³å®šï¼‰
    â”‚   â”œâ”€â”€ å‡ ä¸ª agentï¼Ÿå’Œæ³•è§„ç»´åº¦ä¸€ä¸€å¯¹åº”è¿˜æ˜¯é‡æ–°ç»„ç»‡ï¼Ÿ
    â”‚   â”œâ”€â”€ è·¨æ³•è§„çš„å…³è”è¿è§„æ€Žä¹ˆæ•æ‰ï¼Ÿ
    â”‚   â””â”€â”€ --standard å‚æ•°å¦‚ä½•å½±å“ agent çš„å¯åŠ¨ï¼Ÿ
    â”‚
    â”œâ”€â”€ 3. æ”¶é›† + å…³è”åˆ†æž
    â”‚   â””â”€â”€ åŽ»é‡ã€æŒ‰æ³•è§„æ¡æ¬¾æŽ’åºã€è¯†åˆ«è·¨ç»´åº¦çš„å…³è”è¿è§„
    â”‚
    â”œâ”€â”€ 4. Report: èšåˆ + è¯„çº§ + æ¸²æŸ“
    â”‚   â””â”€â”€ è¾“å‡º: åˆè§„æŠ¥å‘Š + æ•´æ”¹å»ºè®® + å…¥ç½‘é€æ£€é£Žé™©è¯„ä¼°
    â”‚
    â””â”€â”€ 5. Fixï¼ˆå¯é€‰ï¼‰: è‡ªåŠ¨æ•´æ”¹
        â”œâ”€â”€ å¯è‡ªåŠ¨ä¿®å¤çš„è¿è§„ â†’ ç”Ÿæˆè¡¥ä¸ â†’ éªŒè¯
        â””â”€â”€ ä¸å¯è‡ªåŠ¨ä¿®å¤çš„ â†’ æ ‡è®°ä¸ºéœ€äººå·¥å¤„ç†
```

### 9.4.26 éªŒæ”¶æ ‡å‡†

1. `comply check ./my-mobile-os --standard all` ä¸€æ¡å‘½ä»¤è·‘å®Œåˆè§„æ£€æµ‹
2. æŠ¥å‘Šè¦†ç›–äº†æ‰€æœ‰æ³•è§„é¢†åŸŸï¼Œä¸”èƒ½è¯´æ¸… agent æž¶æž„çš„è®¾è®¡ç†ç”±
3. æ¯æ¡è¿è§„æ ‡æ³¨æ³•è§„æ¡æ¬¾ã€æ–‡ä»¶ä½ç½®ã€é£Žé™©ç­‰çº§
4. æŠ¥å‘ŠåŒ…å«ä½ è‡ªå·±è®¾è®¡çš„è¯„çº§ä½“ç³»å’Œå…¥ç½‘é€æ£€é£Žé™©è¯„ä¼°
5. å•ä¸ª agent å¤±è´¥ä¸å½±å“å…¶ä»–æ£€æµ‹ç»“æžœ

### 9.4.27 è¿›é˜¶æŒ‘æˆ˜

- æ”¯æŒè‡ªå®šä¹‰æ³•è§„æ˜ å°„ï¼šä»Žé…ç½®æ–‡ä»¶åŠ è½½ä¼ä¸šå†…éƒ¨åˆè§„è§„åˆ™ï¼Œä¸Žå›½å®¶æ ‡å‡†å åŠ 
- æ”¯æŒå¢žé‡æ£€æµ‹ï¼šåªæ£€æŸ¥ git diff ä¸­å˜æ›´çš„æ–‡ä»¶ï¼Œé¿å…å…¨é‡æ‰«æ
- å¯¹æ¯”ä¸¤æ¬¡æ£€æµ‹ç»“æžœï¼Œç”Ÿæˆåˆè§„è¶‹åŠ¿æŠ¥å‘Šï¼ˆæ•´æ”¹å‰ vs æ•´æ”¹åŽï¼‰
- ç”¨ Hook å®žçŽ°"æ¯æ¬¡ commit å‰è‡ªåŠ¨æ£€æµ‹ï¼Œå­˜åœ¨é«˜å±è¿è§„åˆ™é˜»æ­¢æäº¤"
- ç”Ÿæˆå·¥ä¿¡éƒ¨é€æ£€è‡ªæŸ¥è¡¨ï¼šæŒ‰å…¥ç½‘æ£€æµ‹è§„èŒƒçš„æ¡æ¬¾ç»“æž„è¾“å‡ºè‡ªæŸ¥ç»“æžœï¼Œæ–¹ä¾¿æäº¤ç»™æ£€æµ‹æœºæž„
- å¯¹æŽ¥ Android CTS / VTS æµ‹è¯•ç»“æžœï¼Œä¸Ž AI æ£€æµ‹ç»“æžœäº¤å‰éªŒè¯
- æ”¯æŒæ‰«æ APK/HAP åŒ…ï¼šè§£æžå·²ç¼–è¯‘çš„åº”ç”¨åŒ…ï¼Œæ£€æµ‹æƒé™å£°æ˜Žä¸Žå®žé™…è¡Œä¸ºæ˜¯å¦ä¸€è‡´
