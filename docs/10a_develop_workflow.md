# 作业 1：Develop Workflow

> 构建一个自动化功能开发工具，从需求描述到可运行代码的全流程编排。

**核心模式**：Explore → Specialized Agent → Sequential → Test-Driven

**术语**

- Scaffold（脚手架，自动生成项目骨架代码）
- Code Generation（代码生成，由 AI 根据规格产出源代码）
- Integration Test（集成测试，验证多个模块协同工作的测试）
- Stub（桩，占位实现，用于先搭结构后填逻辑）

### 背景

你的团队维护一个 C/C++ 网络库。产品经理提了一个需求："给连接池加上健康检查功能——定期 ping 池中的空闲连接，剔除已断开的连接。"

手动开发流程：读需求 → 看现有代码 → 设计接口 → 写实现 → 写测试 → 跑测试 → 修 bug。每一步都要人盯着。

你想用 Claude Code 的 workflow 编排，把这个流程自动化成一条命令。

### 需求描述

**输入**:
- 一个本地 C/C++ 项目的路径
- 一段自然语言的功能需求描述

**输出**:
- 新增/修改的源文件（.c/.h）
- 对应的单元测试文件
- 一份变更摘要（改了哪些文件、新增了哪些接口）

**开发阶段**

工具需要按顺序完成以下 4 个阶段：

| 阶段 | 任务 | 对应模式 |
|------|------|---------|
| 理解 | 探索现有代码结构，识别需要修改的模块和接口 | Explore |
| 设计 | 生成接口定义（.h 文件），确定函数签名和数据结构 | Specialized Agent |
| 实现 | 根据接口定义生成实现代码（.c 文件） | Sequential |
| 验证 | 生成测试、编译、运行测试、修复失败 | Test-Driven |

**技术要求**

1. 用 CLI 封装（typer），支持 `dev implement <project-path> --requirement "需求描述"` 命令
2. 理解阶段用 Explore agent 只读探索，不修改任何文件
3. 设计阶段先生成 .h 文件，经用户确认后再进入实现阶段
4. 实现阶段生成的代码必须遵循项目现有的命名规范和代码风格
5. 验证阶段：编译 → 运行测试 → 失败则自动修复 → 重新验证（最多 3 轮）
6. 支持 `--dry-run` 参数，只输出设计方案不写文件

### 提示：你会用到哪些模式？

- [ ] **Explore** — 理解现有代码结构和接口
- [ ] **Specialized Agent** — 接口设计 agent、实现 agent、测试 agent 各司其职
- [ ] **Sequential** — 理解 → 设计 → 实现 → 验证的严格顺序
- [ ] **Test-Driven** — 生成测试 → 编译运行 → 自动修复循环

### 参考架构

```
dev implement <path> --requirement "..."
    │
    ├── 1. Explore: 理解现有代码
    │   └── 输出: 模块依赖图、相关接口、命名规范
    │
    ├── 2. Design: 生成接口定义
    │   └── 输出: 新增的 .h 文件（函数签名 + 数据结构）
    │   └── 等待用户确认
    │
    ├── 3. Implement: 生成实现代码
    │   └── 输出: 新增/修改的 .c 文件
    │
    └── 4. Verify: 测试循环
        ├── 生成测试文件
        ├── 编译全部代码
        ├── 运行测试
        └── 失败 → 自动修复 → 重新编译运行（最多 3 轮）
```

### 验收标准

1. `dev implement ./my-network-lib --requirement "需求描述"` 一条命令完成开发
2. 生成的 .h 文件包含清晰的函数签名和注释
3. 生成的 .c 文件能通过编译（gcc -Wall -Werror）
4. 自动生成的测试覆盖核心逻辑且全部通过
5. 生成的代码风格与项目现有代码一致

### 进阶挑战

- 支持多文件变更：一个需求涉及多个模块时，自动识别所有需要修改的文件
- 生成 git commit message，自动提交变更
- 用 Hook 实现"每次生成代码后自动跑 clang-format"
- 支持 `--lang c++` 参数，生成 C++ 风格的代码（类、RAII、智能指针）

---

